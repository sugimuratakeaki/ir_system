{% extends 'base-three-column.html' %}

{% block title %}{{ meeting_data.title }} - è­°äº‹éŒ²ç·¨é›†{% endblock %}

{% block left_sidebar_title %}æŠ•è³‡å®¶ãƒ»å±¥æ­´æƒ…å ±{% endblock %}
{% block right_panel_title %}ğŸ¤– AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ{% endblock %}
{% block right_panel_toggle_text %}AIåˆ†æ{% endblock %}

{% block main_title %}{{ meeting_data.title }}{% endblock %}
{% block main_subtitle %}çµ±åˆè­°äº‹éŒ²ç·¨é›†ã‚·ã‚¹ãƒ†ãƒ {% endblock %}

{% block three_column_extra_css %}
<style>
/* çµ±åˆè­°äº‹éŒ²ç·¨é›†ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */

/* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é€²æ—ãƒãƒ¼ï¼ˆä¸Šéƒ¨å›ºå®šï¼‰*/
.pipeline-progress {
    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    color: white;
    border-radius: 8px;
    padding: 1rem 1.5rem;
    margin-bottom: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 10;
}

.pipeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.meeting-info h1 {
    font-size: 1.25rem;
    font-weight: bold;
    margin-bottom: 0.25rem;
    line-height: 1.2;
}

.meeting-meta {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    font-size: 0.875rem;
    opacity: 0.9;
}

.meeting-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.action-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
}

.priority-high {
    background: rgba(239, 68, 68, 0.2);
    color: #dc2626;
}

.days-elapsed {
    background: rgba(245, 158, 11, 0.2);
    color: #d97706;
}

/* æ®µéšã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
.stage-pipeline {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.75rem;
}

.stages-container {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.stages-container::-webkit-scrollbar {
    display: none;
}

.stage-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.75rem 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    min-width: 100px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    flex-shrink: 0;
}

.stage-item:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.stage-item.active {
    background: rgba(34, 197, 94, 0.3);
    box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.5);
}

.stage-item.completed {
    background: rgba(34, 197, 94, 0.2);
}

.stage-icon {
    font-size: 1.25rem;
    margin-bottom: 0.25rem;
}

.stage-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-align: center;
    line-height: 1.2;
    margin-bottom: 0.25rem;
    white-space: pre-line;
}

.stage-desc {
    font-size: 0.625rem;
    opacity: 0.8;
    text-align: center;
    line-height: 1.2;
}

/* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.investor-profile {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.investor-avatar {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.25rem;
}

.investor-info h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.investor-info p {
    font-size: 0.875rem;
    color: #6b7280;
}

.investor-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.stat-item {
    text-align: center;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.stat-value {
    font-size: 1.25rem;
    font-weight: bold;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.75rem;
    color: #6b7280;
}

.past-meetings, .related-docs {
    space-y: 0.5rem;
}

.past-meeting, .doc-item {
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 0.5rem;
}

.past-meeting:hover, .doc-item:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
}

.meeting-date {
    font-size: 0.75rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
}

.meeting-topic {
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.meeting-score {
    font-size: 0.75rem;
    color: #059669;
}

.doc-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.doc-icon {
    font-size: 1rem;
}

.doc-name {
    font-size: 0.875rem;
    font-weight: 500;
}

/* ãƒ¯ãƒ¼ã‚¯ã‚¨ãƒªã‚¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.work-area-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.current-stage-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.stage-icon {
    font-size: 2rem;
}

.stage-details h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.stage-details p {
    font-size: 0.875rem;
    color: #6b7280;
}

.stage-actions {
    display: flex;
    gap: 0.5rem;
}

/* AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.ai-suggestion {
    background: #f0f9ff;
    border: 1px solid #0ea5e9;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.suggestion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.suggestion-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #0c4a6e;
}

.confidence-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: rgba(14, 165, 233, 0.1);
    color: #0c4a6e;
    border-radius: 4px;
}

.suggestion-content {
    font-size: 0.875rem;
    color: #374151;
    margin-bottom: 0.75rem;
    line-height: 1.5;
}

.suggestion-actions {
    display: flex;
    gap: 0.5rem;
}

.suggestion-btn {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
}

.suggestion-btn.primary {
    background: #0ea5e9;
    color: white;
}

.suggestion-btn.primary:hover {
    background: #0284c7;
}

.suggestion-btn.secondary {
    background: #f1f5f9;
    color: #64748b;
    border: 1px solid #cbd5e1;
}

.suggestion-btn.secondary:hover {
    background: #e2e8f0;
    border-color: #94a3b8;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 1200px) {
    .stages-container {
        gap: 0.25rem;
    }
    
    .stage-item {
        min-width: 80px;
        padding: 0.5rem 0.25rem;
    }
    
    .stage-label {
        font-size: 0.625rem;
    }
    
    .stage-desc {
        display: none;
    }
}

@media (max-width: 768px) {
    .meeting-actions {
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .pipeline-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .stage-item {
        min-width: 60px;
    }
}
</style>
{% endblock %}

{% block left_sidebar_content %}
<!-- æŠ•è³‡å®¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« -->
<div class="investor-profile">
    <div class="investor-avatar">
        {{ meeting_data.investor_name[0] }}
    </div>
    <div class="investor-info">
        <h4>{{ meeting_data.investor_name }}</h4>
        <p>{{ meeting_data.investor_type }}</p>
    </div>
</div>
<div class="investor-stats">
    <div class="stat-item">
        <div class="stat-value">12</div>
        <div class="stat-label">ç·é¢è«‡å›æ•°</div>
    </div>
    <div class="stat-item">
        <div class="stat-value">8.5</div>
        <div class="stat-label">æº€è¶³åº¦</div>
    </div>
</div>

<h3>ğŸ“‹ éå»é¢è«‡å±¥æ­´</h3>
<div class="past-meetings">
    <div class="past-meeting" onclick="compareWithPast('2023-10-15')">
        <div class="meeting-date">2023-10-15</div>
        <div class="meeting-topic">Q2æ±ºç®—èª¬æ˜ã€ESGæˆ¦ç•¥</div>
        <div class="meeting-score">æº€è¶³åº¦: 8.2</div>
    </div>
    <div class="past-meeting" onclick="compareWithPast('2023-07-15')">
        <div class="meeting-date">2023-07-15</div>
        <div class="meeting-topic">ä¸­æœŸçµŒå–¶è¨ˆç”»ã€M&Aæˆ¦ç•¥</div>
        <div class="meeting-score">æº€è¶³åº¦: 7.8</div>
    </div>
</div>

<h3>ğŸ“„ é–¢é€£è³‡æ–™</h3>
<div class="related-docs">
    <div class="doc-item" onclick="openDocument('q3-earnings')">
        <span class="doc-icon">ğŸ“Š</span>
        <span class="doc-name">Q3æ±ºç®—è³‡æ–™</span>
    </div>
    <div class="doc-item" onclick="openDocument('mid-term-plan')">
        <span class="doc-icon">ğŸ“ˆ</span>
        <span class="doc-name">ä¸­æœŸçµŒå–¶è¨ˆç”»</span>
    </div>
    <div class="doc-item" onclick="openDocument('esg-report')">
        <span class="doc-icon">ğŸŒ±</span>
        <span class="doc-name">ESGãƒ¬ãƒãƒ¼ãƒˆ</span>
    </div>
</div>
{% endblock %}

{% block main_header %}
<!-- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é€²æ—ãƒãƒ¼ -->
<div class="pipeline-progress">
    <div class="pipeline-header">
        <div class="meeting-info">
            <h1>{{ meeting_data.title }}</h1>
            <div class="meeting-meta">
                <span>{{ meeting_data.investor_name }}</span>
                <span>â€¢</span>
                <span>{{ meeting_data.formatted_date }}</span>
                <span>â€¢</span>
                <span>{{ meeting_data.type }}</span>
            </div>
        </div>
        <div class="meeting-actions">
            {% if meeting_data.priority == 'high' %}
            <div class="action-badge priority-high">
                ğŸ”¥ å„ªå…ˆåº¦é«˜
            </div>
            {% endif %}
            {% if meeting_data.days_elapsed > 3 %}
            <div class="action-badge days-elapsed">
                âš ï¸ {{ meeting_data.days_elapsed }}æ—¥çµŒé
            </div>
            {% endif %}
            <button class="btn btn-secondary" onclick="exportData()">
                ğŸ“¤ æ›¸ãå‡ºã—
            </button>
        </div>
    </div>
    
    <!-- æ®µéšã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div class="stage-pipeline">
        <div class="stages-container">
            {% set stages = [
                {'id': 'upload', 'icon': 'ğŸ“¹', 'label': 'ãƒ•ã‚¡ã‚¤ãƒ«\nã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰', 'desc': 'éŸ³å£°ãƒ»è³‡æ–™ã®å–ã‚Šè¾¼ã¿'},
                {'id': 'transcription', 'icon': 'ğŸ“', 'label': 'æ–‡å­—èµ·ã“ã—\nãƒ»ç·¨é›†', 'desc': 'éŸ³å£°ã®ãƒ†ã‚­ã‚¹ãƒˆåŒ–ã¨ç·¨é›†'},
                {'id': 'ai_summary', 'icon': 'ğŸ¤–', 'label': 'AIè¦ç´„\nãƒ»åˆ†æ', 'desc': 'è‡ªå‹•è¦ç´„ã¨æ´å¯ŸæŠ½å‡º'},
                {'id': 'faq', 'icon': 'â“', 'label': 'FAQ\nä½œæˆ', 'desc': 'è³ªç–‘å¿œç­”ã®æ•´ç†'},
                {'id': 'review', 'icon': 'âœ…', 'label': 'ãƒ¬ãƒ“ãƒ¥ãƒ¼\nãƒ»æ‰¿èª', 'desc': 'å†…å®¹ç¢ºèªã¨æ‰¿èª'},
                {'id': 'publish', 'icon': 'ğŸŒ', 'label': 'å…¬é–‹\nãƒ»é…ä¿¡', 'desc': 'æœ€çµ‚å…¬é–‹ã¨å…±æœ‰'}
            ] %}
            
            {% for stage in stages %}
            <div class="stage-item {% if stage.id == meeting_data.current_stage %}active{% elif stage.id in meeting_data.completed_stages %}completed{% endif %}" 
                 onclick="switchStage('{{ stage.id }}')">
                <div class="stage-icon">{{ stage.icon }}</div>
                <div class="stage-label">{{ stage.label }}</div>
                <div class="stage-desc">{{ stage.desc }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block main_content %}
<!-- ãƒ¯ãƒ¼ã‚¯ã‚¨ãƒªã‚¢ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="work-area-header">
    <div class="current-stage-info">
        <div class="stage-icon">
            {% if meeting_data.current_stage == 'upload' %}ğŸ“¹
            {% elif meeting_data.current_stage == 'transcription' %}ğŸ“
            {% elif meeting_data.current_stage == 'ai_summary' %}ğŸ¤–
            {% elif meeting_data.current_stage == 'faq' %}â“
            {% elif meeting_data.current_stage == 'review' %}âœ…
            {% elif meeting_data.current_stage == 'publish' %}ğŸŒ
            {% endif %}
        </div>
        <div class="stage-details">
            <h3>
                {% if meeting_data.current_stage == 'upload' %}ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»åŸºæœ¬æƒ…å ±
                {% elif meeting_data.current_stage == 'transcription' %}æ–‡å­—èµ·ã“ã—ãƒ»éŸ³å£°ç·¨é›†
                {% elif meeting_data.current_stage == 'ai_summary' %}AIè¦ç´„ãƒ»åˆ†æ
                {% elif meeting_data.current_stage == 'faq' %}FAQä½œæˆãƒ»ç·¨é›†
                {% elif meeting_data.current_stage == 'review' %}ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª
                {% elif meeting_data.current_stage == 'publish' %}å…¬é–‹ãƒ»é…ä¿¡
                {% endif %}
            </h3>
            <p>
                {% if meeting_data.current_stage_info.message %}
                    {{ meeting_data.current_stage_info.message }}
                {% else %}
                    ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ä½œæ¥­ã‚’é€²ã‚ã¦ãã ã•ã„
                {% endif %}
            </p>
        </div>
    </div>
    <div class="stage-actions">
        {% if meeting_data.current_stage == 'upload' %}
        <button class="btn btn-primary" onclick="startUpload()">
            ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹
        </button>
        {% elif meeting_data.current_stage == 'transcription' %}
        <button class="btn btn-primary" onclick="startTranscription()">
            ğŸ™ï¸ æ–‡å­—èµ·ã“ã—é–‹å§‹
        </button>
        <button class="btn btn-secondary" onclick="editTranscript()">
            âœï¸ ç·¨é›†
        </button>
        {% elif meeting_data.current_stage == 'ai_summary' %}
        <button class="btn btn-primary" onclick="generateSummary()">
            ğŸ¤– è¦ç´„ç”Ÿæˆ
        </button>
        <button class="btn btn-secondary" onclick="refineSummary()">
            ğŸ¨ èª¿æ•´
        </button>
        {% elif meeting_data.current_stage == 'faq' %}
        <button class="btn btn-primary" onclick="createFAQ()">
            â“ FAQä½œæˆ
        </button>
        <button class="btn btn-secondary" onclick="importFAQ()">
            ğŸ“¥ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–è¾¼
        </button>
        {% elif meeting_data.current_stage == 'review' %}
        <button class="btn btn-primary" onclick="approveContent()">
            âœ… æ‰¿èª
        </button>
        <button class="btn btn-warning" onclick="requestRevision()">
            ğŸ”„ ä¿®æ­£ä¾é ¼
        </button>
        {% elif meeting_data.current_stage == 'publish' %}
        <button class="btn btn-primary" onclick="publish()">
            ğŸŒ å…¬é–‹
        </button>
        <button class="btn btn-secondary" onclick="schedulePublish()">
            â° äºˆç´„æŠ•ç¨¿
        </button>
        {% endif %}
    </div>
</div>

<!-- ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
<div class="stage-content">
    {% if meeting_data.current_stage == 'upload' %}
    <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="upload-content">
        <div class="upload-area" id="uploadArea">
            <div class="upload-placeholder">
                <span style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem;">ğŸ“¤</span>
                <p style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p style="color: #6b7280; margin-bottom: 1rem;">ã¾ãŸã¯ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                </button>
                <input type="file" id="fileInput" style="display: none;" accept="audio/*,video/*" onchange="handleFileSelect(event)">
            </div>
        </div>
        
        <div class="upload-info">
            <h4>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æƒ…å ±</h4>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">ã‚µãƒãƒ¼ãƒˆå½¢å¼</span>
                    <span class="info-value">MP3, MP4, WAV, M4A</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æœ€å¤§ã‚µã‚¤ã‚º</span>
                    <span class="info-value">500MB</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ¨å¥¨æ™‚é–“</span>
                    <span class="info-value">ï½3æ™‚é–“</span>
                </div>
            </div>
        </div>
    </div>
    
    {% elif meeting_data.current_stage == 'transcription' %}
    <!-- æ–‡å­—èµ·ã“ã—ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="transcription-content">
        <div class="transcription-editor">
            <div class="editor-toolbar">
                <div class="playback-controls">
                    <button class="control-btn" onclick="togglePlayback()">
                        <span id="playButton">â¸ï¸</span>
                    </button>
                    <div class="time-display">
                        <span id="currentTime">25:30</span> / <span id="totalTime">1:30:45</span>
                    </div>
                    <input type="range" id="progressSlider" min="0" max="5445" value="1530" onchange="seekTo(this.value)">
                    <button class="control-btn" onclick="adjustSpeed()">
                        <span id="speedButton">1.0x</span>
                    </button>
                </div>
                <div class="editing-tools">
                    <button class="tool-btn" onclick="insertTimestamp()">ğŸ• ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—</button>
                    <button class="tool-btn" onclick="insertSpeaker()">ğŸ‘¤ è©±è€…å¤‰æ›´</button>
                    <button class="tool-btn" onclick="markUncertain()">â“ ä¸æ˜ç®‡æ‰€</button>
                </div>
            </div>
            
            <div class="transcript-text">
                <div contenteditable="true" id="transcriptEditor">
                    <p><strong>[00:25:30] æŠ•è³‡å®¶A:</strong> AIäº‹æ¥­ã«ãŠã‘ã‚‹å¾¡ç¤¾ã®ç«¶äº‰å„ªä½æ€§ã«ã¤ã„ã¦ãŠèã‹ã›ãã ã•ã„ã€‚ç‰¹ã«ã€å¤§æ‰‹ãƒ†ãƒƒã‚¯ä¼æ¥­ã¨ã®å·®åˆ¥åŒ–è¦å› ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™ã€‚</p>
                    
                    <p><strong>[00:26:15] IRæ‹…å½“è€…:</strong> ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å¼Šç¤¾ã®AIäº‹æ¥­ã«ãŠã‘ã‚‹ç«¶äº‰å„ªä½æ€§ã¯ã€ä¸»ã«3ã¤ã®è¦ç´ ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
                    
                    <p><strong>[00:26:30] IRæ‹…å½“è€…:</strong> ç¬¬ä¸€ã«ã€æ¥­ç•Œç‰¹åŒ–å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®è“„ç©ã§ã™ã€‚å¼Šç¤¾ã¯éå»10å¹´é–“ã«ã‚ãŸã£ã¦ã€è£½é€ æ¥­å‘ã‘ã®å°‚é–€çš„ãªãƒ‡ãƒ¼ã‚¿ã‚’åé›†ãƒ»æ•´ç†ã—ã¦ãã¦ãŠã‚Šã€ã“ã®é ˜åŸŸã§ã¯ä»–ç¤¾ã«å¤§ããå…ˆè¡Œã—ã¦ã„ã¾ã™ã€‚</p>
                    
                    <p><span class="uncertain">[00:27:10] IRæ‹…å½“è€…: ç¬¬äºŒã«ã€â€»â€»â€»â€»ï¼ˆèãå–ã‚Œãªã„ï¼‰â€»â€»â€»â€»ã«ã‚ˆã‚‹ç‹¬è‡ªã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é–‹ç™ºã§ã™ã€‚</span></p>
                    
                    <p><strong>[00:27:45] IRæ‹…å½“è€…:</strong> ãã—ã¦ç¬¬ä¸‰ã«ã€é¡§å®¢ã¨ã®å¯†æ¥ãªé–¢ä¿‚æ§‹ç¯‰ã§ã™ã€‚æˆ‘ã€…ã¯å˜ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æä¾›ã™ã‚‹ã®ã§ã¯ãªãã€é¡§å®¢ã®æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹å…¨ä½“ã‚’ç†è§£ã—ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>
    </div>
    
    {% elif meeting_data.current_stage == 'ai_summary' %}
    <!-- AIè¦ç´„ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="ai-summary-content">
        <div class="summary-sections">
            <div class="summary-section">
                <h4>ğŸ“‹ ä¼šè­°è¦ç´„</h4>
                <div class="summary-text" contenteditable="true">
                    <p><strong>ä¸»è¦è­°é¡Œ:</strong> AIäº‹æ¥­ã®ç«¶äº‰å„ªä½æ€§ã€ESGæˆ¦ç•¥ã®é€²æ—ã€ä»Šå¾Œã®æŠ•è³‡è¨ˆç”»</p>
                    
                    <p><strong>ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
                    <ul>
                        <li>AIäº‹æ¥­ã§ã¯æ¥­ç•Œç‰¹åŒ–å‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ç«¶åˆå„ªä½ã‚’ç¢ºç«‹</li>
                        <li>è£½é€ æ¥­å‘ã‘ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§å¸‚å ´ã‚·ã‚§ã‚¢25%ã‚’é”æˆ</li>
                        <li>ESGæŠ•è³‡ã‚’ä»ŠæœŸ20%å¢—é¡ã€ã‚«ãƒ¼ãƒœãƒ³ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ç›®æ¨™ã‚’2030å¹´ã«å‰å€’ã—</li>
                        <li>æ–°è¦è¨­å‚™æŠ•è³‡ã«ã‚ˆã‚Šç”Ÿç”£åŠ¹ç‡ã‚’15%å‘ä¸Šäºˆå®š</li>
                    </ul>
                    
                    <p><strong>æŠ•è³‡å®¶ã®é–¢å¿ƒäº‹é …:</strong></p>
                    <ul>
                        <li>AIäº‹æ¥­ã®åç›Šæ€§ã¨æˆé•·æŒç¶šæ€§</li>
                        <li>å¤§æ‰‹ãƒ†ãƒƒã‚¯ä¼æ¥­ã¨ã®ç«¶äº‰æˆ¦ç•¥</li>
                        <li>ESGæŠ•è³‡ã®ROIæ¸¬å®šæ–¹æ³•</li>
                        <li>æŠ€è¡“è€…æ¡ç”¨è¨ˆç”»ã¨äººæå®šç€ç‡</li>
                    </ul>
                </div>
            </div>
            
            <div class="summary-section">
                <h4>ğŸ¯ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ </h4>
                <div class="action-items">
                    <div class="action-item">
                        <div class="action-header">
                            <span class="action-title">è¿½åŠ è³‡æ–™ã®æº–å‚™</span>
                            <span class="action-priority high">å„ªå…ˆåº¦: é«˜</span>
                        </div>
                        <div class="action-description">AIäº‹æ¥­ã®è©³ç´°ãªãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—è³‡æ–™ã‚’æ¬¡å›é¢è«‡ã¾ã§ã«æº–å‚™</div>
                        <div class="action-deadline">æœŸé™: 2024-01-15</div>
                    </div>
                    
                    <div class="action-item">
                        <div class="action-header">
                            <span class="action-title">ESGæŒ‡æ¨™ã®è©³ç´°èª¬æ˜</span>
                            <span class="action-priority medium">å„ªå…ˆåº¦: ä¸­</span>
                        </div>
                        <div class="action-description">ã‚«ãƒ¼ãƒœãƒ³ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«é”æˆã®ãŸã‚ã®å…·ä½“çš„æ–½ç­–ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
                        <div class="action-deadline">æœŸé™: 2024-01-20</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% elif meeting_data.current_stage == 'faq' %}
    <!-- FAQä½œæˆã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="faq-content">
        <div class="faq-editor">
            <div class="faq-controls">
                <button class="btn btn-primary" onclick="addFAQ()">+ FAQè¿½åŠ </button>
                <button class="btn btn-secondary" onclick="importTemplate()">ğŸ“¥ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
                <button class="btn btn-secondary" onclick="sortFAQs()">ğŸ”„ ä¸¦ã³æ›¿ãˆ</button>
            </div>
            
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question" contenteditable="true">
                        <strong>Q:</strong> AIäº‹æ¥­ã«ãŠã‘ã‚‹å¾¡ç¤¾ã®ç«¶äº‰å„ªä½æ€§ã¯ä½•ã§ã™ã‹ï¼Ÿ
                    </div>
                    <div class="faq-answer" contenteditable="true">
                        <strong>A:</strong> å¼Šç¤¾ã®AIäº‹æ¥­ã«ãŠã‘ã‚‹ç«¶äº‰å„ªä½æ€§ã¯ä¸»ã«3ã¤ã‚ã‚Šã¾ã™ã€‚ç¬¬ä¸€ã«ã€10å¹´é–“è“„ç©ã—ã¦ããŸæ¥­ç•Œç‰¹åŒ–å‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€ç¬¬äºŒã«ç‹¬è‡ªã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é–‹ç™ºåŠ›ã€ç¬¬ä¸‰ã«é¡§å®¢ã¨ã®å¯†æ¥ãªé–¢ä¿‚æ§‹ç¯‰ã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³æä¾›ã§ã™ã€‚ç‰¹ã«è£½é€ æ¥­å‘ã‘ã§ã¯å¸‚å ´ã‚·ã‚§ã‚¢25%ã‚’é”æˆã—ã¦ãŠã‚Šã€å¤§æ‰‹ãƒ†ãƒƒã‚¯ä¼æ¥­ã¨ã¯å·®åˆ¥åŒ–ã•ã‚ŒãŸç«¶äº‰æˆ¦ç•¥ã‚’å±•é–‹ã—ã¦ã„ã¾ã™ã€‚
                    </div>
                    <div class="faq-actions">
                        <button class="btn btn-sm btn-secondary" onclick="editFAQ(1)">ç·¨é›†</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFAQ(1)">å‰Šé™¤</button>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" contenteditable="true">
                        <strong>Q:</strong> ESGæŠ•è³‡ã®å…·ä½“çš„ãªè¨ˆç”»ã¨æˆæœæ¸¬å®šæ–¹æ³•ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
                    </div>
                    <div class="faq-answer" contenteditable="true">
                        <strong>A:</strong> å¼Šç¤¾ã§ã¯ä»ŠæœŸESGæŠ•è³‡ã‚’20%å¢—é¡ã—ã€ã‚«ãƒ¼ãƒœãƒ³ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ç›®æ¨™ã‚’2030å¹´ã«å‰å€’ã—ã§è¨­å®šã—ã¾ã—ãŸã€‚å…·ä½“çš„æ–½ç­–ã¨ã—ã¦ã€å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å°å…¥æ‹¡å¤§ã€çœã‚¨ãƒè¨­å‚™ã¸ã®æŠ•è³‡ã€ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³å…¨ä½“ã§ã®CO2å‰Šæ¸›ãªã©ã‚’æ¨é€²ã—ã¦ã„ã¾ã™ã€‚æˆæœæ¸¬å®šã«ã¤ã„ã¦ã¯ã€ISO14001æº–æ‹ ã®ç’°å¢ƒãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã€å››åŠæœŸã”ã¨ã«é€²æ—ã‚’å ±å‘Šã—ã¦ã„ã¾ã™ã€‚
                    </div>
                    <div class="faq-actions">
                        <button class="btn btn-sm btn-secondary" onclick="editFAQ(2)">ç·¨é›†</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFAQ(2)">å‰Šé™¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% elif meeting_data.current_stage == 'review' %}
    <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="review-content">
        <div class="review-sections">
            <div class="review-checklist">
                <h4>âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h4>
                <div class="checklist-items">
                    <label class="checklist-item">
                        <input type="checkbox" checked>
                        <span>æ–‡å­—èµ·ã“ã—ã®æ­£ç¢ºæ€§ç¢ºèª</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" checked>
                        <span>è¦ç´„å†…å®¹ã®å¦¥å½“æ€§æ¤œè¨¼</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox">
                        <span>FAQå†…å®¹ã®é©åˆ‡æ€§ç¢ºèª</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox">
                        <span>æ©Ÿå¯†æƒ…å ±ã®é™¤å»ç¢ºèª</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox">
                        <span>æ³•å‹™ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯</span>
                    </label>
                </div>
            </div>
            
            <div class="review-comments">
                <h4>ğŸ’¬ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ</h4>
                <div class="comment-form">
                    <textarea placeholder="ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." rows="4"></textarea>
                    <button class="btn btn-primary">ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ </button>
                </div>
                
                <div class="comment-list">
                    <div class="comment-item">
                        <div class="comment-header">
                            <span class="comment-author">ç”°ä¸­ å¤ªéƒ</span>
                            <span class="comment-date">2024-01-10 14:30</span>
                        </div>
                        <div class="comment-content">
                            AIäº‹æ¥­ã®ç«¶äº‰å„ªä½æ€§ã®èª¬æ˜ã§ã€å…·ä½“çš„ãªæ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã†å°‘ã—è©³ã—ãè¨˜è¼‰ã—ãŸæ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% elif meeting_data.current_stage == 'publish' %}
    <!-- å…¬é–‹ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="publish-content">
        <div class="publish-options">
            <div class="publish-section">
                <h4>ğŸŒ å…¬é–‹è¨­å®š</h4>
                <div class="option-group">
                    <label class="option-item">
                        <input type="radio" name="publish-type" value="immediate" checked>
                        <span>å³åº§ã«å…¬é–‹</span>
                    </label>
                    <label class="option-item">
                        <input type="radio" name="publish-type" value="scheduled">
                        <span>äºˆç´„æŠ•ç¨¿</span>
                        <input type="datetime-local" class="schedule-input" style="margin-left: 1rem;">
                    </label>
                </div>
            </div>
            
            <div class="publish-section">
                <h4>ğŸ‘¥ å…¬é–‹ç¯„å›²</h4>
                <div class="option-group">
                    <label class="option-item">
                        <input type="checkbox" checked>
                        <span>æŠ•è³‡å®¶å‘ã‘ãƒãƒ¼ã‚¿ãƒ«</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox">
                        <span>ä¸€èˆ¬å‘ã‘Webã‚µã‚¤ãƒˆ</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox">
                        <span>ãƒ¡ãƒ¼ãƒ«é…ä¿¡</span>
                    </label>
                </div>
            </div>
            
            <div class="publish-section">
                <h4>ğŸ“§ é€šçŸ¥è¨­å®š</h4>
                <div class="option-group">
                    <label class="option-item">
                        <input type="checkbox" checked>
                        <span>é–¢ä¿‚è€…ã¸ã®é€šçŸ¥</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox">
                        <span>æŠ•è³‡å®¶ã¸ã®è‡ªå‹•é€šçŸ¥</span>
                    </label>
                </div>
            </div>
        </div>
        
        <div class="publish-preview">
            <h4>ğŸ‘€ å…¬é–‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
            <div class="preview-content">
                <iframe src="/preview/{{ meeting_id }}" style="width: 100%; height: 400px; border: 1px solid #e2e8f0; border-radius: 8px;"></iframe>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block right_panel_content %}
<!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ AIææ¡ˆ -->
<div class="ai-suggestion">
    <div class="suggestion-header">
        <span class="suggestion-title">ğŸ“ FAQå€™è£œã‚’æ¤œå‡º</span>
        <span class="confidence-badge">ä¿¡é ¼åº¦: 94%</span>
    </div>
    <div class="suggestion-content">
        ã€ŒAIäº‹æ¥­ã®ç«¶äº‰å„ªä½æ€§ã«ã¤ã„ã¦ã€ã®FAQã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ã“ã®è³ªå•ã¯éå»3å›ã®é¢è«‡ã§ã‚‚è¨€åŠã•ã‚Œã¦ã„ã¾ã™ã€‚
    </div>
    <div class="suggestion-actions">
        <button class="suggestion-btn primary" onclick="createFAQ('ai_competition')">FAQã‚’ä½œæˆ</button>
        <button class="suggestion-btn secondary" onclick="dismissSuggestion(1)">å¾Œã§</button>
    </div>
</div>

<div class="ai-suggestion">
    <div class="suggestion-header">
        <span class="suggestion-title">âš ï¸ é‡è¦ãªå¤‰åŒ–ã‚’æ¤œå‡º</span>
        <span class="confidence-badge">ä¿¡é ¼åº¦: 87%</span>
    </div>
    <div class="suggestion-content">
        å‰å›é¢è«‡ã¨æ¯”è¼ƒã—ã¦ã€æŠ€è¡“å„ªä½æ€§ã¸ã®é–¢å¿ƒãŒ45%å¢—åŠ ã—ã¦ã„ã¾ã™ã€‚è¿½åŠ è³‡æ–™ã®æº–å‚™ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
    </div>
    <div class="suggestion-actions">
        <button class="suggestion-btn primary" onclick="prepareDocument('tech_advantage')">è³‡æ–™æº–å‚™</button>
        <button class="suggestion-btn secondary" onclick="dismissSuggestion(2)">ç„¡è¦–</button>
    </div>
</div>

<!-- AIåˆ†æçµæœ -->
<div style="margin-top: 2rem;">
    <h4 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem; color: #111827;">ğŸ“Š ä»Šå›é¢è«‡ã®åˆ†æ</h4>
    <div style="padding: 1rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <span style="font-size: 0.75rem; color: #6b7280;">æ„Ÿæƒ…åˆ†æ</span>
            <span style="font-size: 0.75rem; font-weight: 600; color: #10b981;">ãƒã‚¸ãƒ†ã‚£ãƒ– 78%</span>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <span style="font-size: 0.75rem; color: #6b7280;">é–¢å¿ƒåº¦</span>
            <span style="font-size: 0.75rem; font-weight: 600; color: #3b82f6;">é«˜ (8.2/10)</span>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <span style="font-size: 0.75rem; color: #6b7280;">ç†è§£åº¦</span>
            <span style="font-size: 0.75rem; font-weight: 600; color: #f59e0b;">ä¸­ (6.5/10)</span>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 0.75rem; color: #6b7280;">æº€è¶³åº¦</span>
            <span style="font-size: 0.75rem; font-weight: 600; color: #10b981;">é«˜ (7.8/10)</span>
        </div>
    </div>
</div>
{% endblock %}

{% block three_column_extra_js %}
<script>
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
const meetingId = '{{ meeting_id }}';
let currentStage = '{{ meeting_data.current_stage }}';
let isPlaying = false;
let currentTime = 0;
let totalDuration = 5445; // 1:30:45 in seconds
let autoSaveInterval;

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    initializeEditor();
    startAutoSave();
});

// ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼åˆæœŸåŒ–
function initializeEditor() {
    // ã‚¹ãƒ†ãƒ¼ã‚¸å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
    switch(currentStage) {
        case 'upload':
            initializeUpload();
            break;
        case 'transcription':
            initializeTranscription();
            break;
        case 'ai_summary':
            initializeSummary();
            break;
        case 'faq':
            initializeFAQ();
            break;
        case 'review':
            initializeReview();
            break;
        case 'publish':
            initializePublish();
            break;
    }
}

// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializeUpload() {
    const uploadArea = document.getElementById('uploadArea');
    if (uploadArea) {
        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
    }
}

// æ–‡å­—èµ·ã“ã—ã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializeTranscription() {
    // éŸ³å£°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸåŒ–
    updateTimeDisplay();
    setInterval(updateProgress, 1000);
}

// è¦ç´„ã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializeSummary() {
    // è¦ç´„ã®è‡ªå‹•ä¿å­˜è¨­å®š
    const summaryTexts = document.querySelectorAll('.summary-text[contenteditable]');
    summaryTexts.forEach(text => {
        text.addEventListener('input', debounce(autoSaveSummary, 2000));
    });
}

// FAQã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializeFAQ() {
    // FAQé …ç›®ã®ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
    initializeSortable();
}

// ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializeReview() {
    // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®é€²æ—æ›´æ–°
    updateReviewProgress();
}

// å…¬é–‹ã‚¹ãƒ†ãƒ¼ã‚¸åˆæœŸåŒ–
function initializePublish() {
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°
    refreshPreview();
}

// ã‚¹ãƒ†ãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
function switchStage(stageId) {
    if (stageId === currentStage) return;
    
    // ç¾åœ¨ã®ä½œæ¥­ã‚’ä¿å­˜
    saveCurrentWork();
    
    // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»å‹•
    window.location.href = `/dialogue/edit?id=${meetingId}&stage=${stageId}`;
}

// è‡ªå‹•ä¿å­˜é–‹å§‹
function startAutoSave() {
    autoSaveInterval = setInterval(autoSave, 30000); // 30ç§’é–“éš”
}

// è‡ªå‹•ä¿å­˜å®Ÿè¡Œ
function autoSave() {
    const data = gatherCurrentData();
    
    fetch(`/api/meetings/${meetingId}/autosave`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showNotification('è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        }
    })
    .catch(error => {
        console.error('è‡ªå‹•ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
    });
}

// ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿åé›†
function gatherCurrentData() {
    const data = {
        stage: currentStage,
        timestamp: new Date().toISOString()
    };
    
    // ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ãƒ‡ãƒ¼ã‚¿åé›†
    switch(currentStage) {
        case 'transcription':
            data.transcript = document.getElementById('transcriptEditor')?.innerHTML;
            data.currentTime = currentTime;
            break;
        case 'ai_summary':
            data.summary = document.querySelector('.summary-text')?.innerHTML;
            break;
        case 'faq':
            data.faqs = gatherFAQData();
            break;
        case 'review':
            data.checklist = gatherChecklistData();
            data.comments = gatherCommentsData();
            break;
    }
    
    return data;
}

// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–¢é€£é–¢æ•°
function handleFileSelect(event) {
    const files = event.target.files;
    if (files.length > 0) {
        uploadFile(files[0]);
    }
}

function handleDragOver(event) {
    event.preventDefault();
    event.currentTarget.classList.add('drag-over');
}

function handleDrop(event) {
    event.preventDefault();
    event.currentTarget.classList.remove('drag-over');
    
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        uploadFile(files[0]);
    }
}

function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('meeting_id', meetingId);
    
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—è¡¨ç¤º
    showUploadProgress();
    
    fetch('/api/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showNotification('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†', 'success');
            // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã‚€
            switchStage('transcription');
        } else {
            showNotification('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    })
    .catch(error => {
        console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        showNotification('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
    });
}

// æ–‡å­—èµ·ã“ã—é–¢é€£é–¢æ•°
function togglePlayback() {
    isPlaying = !isPlaying;
    const playButton = document.getElementById('playButton');
    
    if (isPlaying) {
        playButton.textContent = 'â¸ï¸';
        // å®Ÿéš›ã®éŸ³å£°å†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯
    } else {
        playButton.textContent = 'â–¶ï¸';
        // éŸ³å£°åœæ­¢ãƒ­ã‚¸ãƒƒã‚¯
    }
}

function seekTo(time) {
    currentTime = parseInt(time);
    updateTimeDisplay();
    // å®Ÿéš›ã®ã‚·ãƒ¼ã‚¯å‡¦ç†
}

function adjustSpeed() {
    // å†ç”Ÿé€Ÿåº¦èª¿æ•´
    const speedButton = document.getElementById('speedButton');
    const speeds = ['0.5x', '0.75x', '1.0x', '1.25x', '1.5x', '2.0x'];
    const currentSpeed = speedButton.textContent;
    const currentIndex = speeds.indexOf(currentSpeed);
    const nextIndex = (currentIndex + 1) % speeds.length;
    speedButton.textContent = speeds[nextIndex];
}

function updateTimeDisplay() {
    const currentTimeEl = document.getElementById('currentTime');
    const progressSlider = document.getElementById('progressSlider');
    
    if (currentTimeEl) {
        currentTimeEl.textContent = formatTime(currentTime);
    }
    if (progressSlider) {
        progressSlider.value = currentTime;
    }
}

function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const remainingSeconds = seconds % 60;
    
    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    } else {
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }
}

// é€šçŸ¥è¡¨ç¤º
function showNotification(message, type = 'info') {
    // é€šçŸ¥è¦ç´ ã‚’ä½œæˆ
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
    Object.assign(notification.style, {
        position: 'fixed',
        top: '1rem',
        right: '1rem',
        padding: '0.75rem 1rem',
        borderRadius: '0.5rem',
        color: 'white',
        fontWeight: '500',
        zIndex: '9999',
        minWidth: '200px',
        textAlign: 'center'
    });
    
    // ã‚¿ã‚¤ãƒ—åˆ¥è‰²è¨­å®š
    switch(type) {
        case 'success':
            notification.style.background = '#10b981';
            break;
        case 'error':
            notification.style.background = '#ef4444';
            break;
        case 'warning':
            notification.style.background = '#f59e0b';
            break;
        default:
            notification.style.background = '#3b82f6';
    }
    
    document.body.appendChild(notification);
    
    // 3ç§’å¾Œã«å‰Šé™¤
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// ãƒ‡ãƒã‚¦ãƒ³ã‚¹é–¢æ•°
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// ãã®ä»–ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
function exportData() {
    const data = gatherCurrentData();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `meeting-${meetingId}-export.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function saveCurrentWork() {
    const data = gatherCurrentData();
    localStorage.setItem(`meeting-${meetingId}-work`, JSON.stringify(data));
}

function compareWithPast(date) {
    window.open(`/compare/${meetingId}/${date}`, '_blank');
}

function openDocument(docId) {
    window.open(`/documents/${docId}`, '_blank');
}
</script>
{% endblock %} 