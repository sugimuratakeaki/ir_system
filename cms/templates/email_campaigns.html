{% extends "base.html" %}

{% block title %}ãƒ¡ãƒ¼ãƒ«é…ä¿¡ç®¡ç†{% endblock %}

{% block content %}
<!-- é…ä¿¡çµ±è¨ˆ -->
<div class="mb-lg">
    <div class="faq-stats">
        <div class="stat-card">
            <div class="stat-value">{{ total_recipients }}</div>
            <div class="stat-label">ç·é…ä¿¡å…ˆæ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ sent_this_month }}</div>
            <div class="stat-label">ä»Šæœˆã®é…ä¿¡æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ avg_open_rate }}%</div>
            <div class="stat-label">å¹³å‡é–‹å°ç‡</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ scheduled_campaigns }}</div>
            <div class="stat-label">äºˆç´„é…ä¿¡</div>
        </div>
    </div>
</div>

<!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
<div class="flex justify-between items-center mb-lg">
    <div class="flex gap-md">
        <button class="btn btn-primary" onclick="showNewCampaignModal()">
            <span>âœ‰ï¸</span>
            <span>æ–°è¦é…ä¿¡ä½œæˆ</span>
        </button>
        <button class="btn btn-secondary">
            <span>ğŸ“‹</span>
            <span>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</span>
        </button>
        <button class="btn btn-secondary">
            <span>ğŸ‘¥</span>
            <span>é…ä¿¡ãƒªã‚¹ãƒˆç®¡ç†</span>
        </button>
    </div>
    <div class="flex gap-md">
        <input type="text" class="form-control" placeholder="ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’æ¤œç´¢..." style="width: 300px;">
        <select class="form-control" style="width: 150px;">
            <option>ã™ã¹ã¦ã®çŠ¶æ…‹</option>
            <option>ä¸‹æ›¸ã</option>
            <option>é…ä¿¡äºˆç´„</option>
            <option>é…ä¿¡æ¸ˆã¿</option>
        </select>
    </div>
</div>

<!-- ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§ -->
<div class="card">
    <div class="card-header">
        <h3 class="text-lg font-semibold">é…ä¿¡ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>é…ä¿¡æ—¥æ™‚</th>
                        <th>ä»¶å</th>
                        <th>é…ä¿¡å¯¾è±¡</th>
                        <th>é…ä¿¡æ•°</th>
                        <th>é–‹å°ç‡</th>
                        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                    </tr>
                </thead>
                <tbody>
                    {% for campaign in campaigns %}
                    <tr>
                        <td>{{ campaign.scheduled_date }}</td>
                        <td>
                            <div class="font-medium">{{ campaign.subject }}</div>
                            <div class="text-sm text-muted">{{ campaign.template }}</div>
                        </td>
                        <td>
                            <span class="badge badge-primary">{{ campaign.target_group }}</span>
                        </td>
                        <td>{{ campaign.recipient_count }}</td>
                        <td>
                            {% if campaign.status == "é…ä¿¡æ¸ˆã¿" %}
                            <div class="flex items-center gap-sm">
                                <div class="progress" style="width: 100px;">
                                    <div class="progress-bar" style="width: {{ campaign.open_rate }}%"></div>
                                </div>
                                <span class="text-sm">{{ campaign.open_rate }}%</span>
                            </div>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if campaign.status == "ä¸‹æ›¸ã" %}
                            <span class="badge badge-secondary">ä¸‹æ›¸ã</span>
                            {% elif campaign.status == "é…ä¿¡äºˆç´„" %}
                            <span class="badge badge-warning">é…ä¿¡äºˆç´„</span>
                            {% elif campaign.status == "é…ä¿¡ä¸­" %}
                            <span class="badge badge-primary">é…ä¿¡ä¸­</span>
                            {% else %}
                            <span class="badge badge-success">é…ä¿¡æ¸ˆã¿</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                {% if campaign.status == "ä¸‹æ›¸ã" %}
                                <button class="btn btn-sm btn-primary">é…ä¿¡</button>
                                <button class="btn btn-sm btn-secondary">ç·¨é›†</button>
                                {% elif campaign.status == "é…ä¿¡äºˆç´„" %}
                                <button class="btn btn-sm btn-secondary">ç·¨é›†</button>
                                <button class="btn btn-sm btn-danger">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                {% else %}
                                <button class="btn btn-sm btn-secondary">è©³ç´°</button>
                                <button class="btn btn-sm btn-secondary">è¤‡è£½</button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- é…ä¿¡ã‚°ãƒ«ãƒ¼ãƒ— -->
<div class="card mt-lg">
    <div class="card-header">
        <h3 class="text-lg font-semibold">é…ä¿¡ã‚°ãƒ«ãƒ¼ãƒ—</h3>
    </div>
    <div class="card-body">
        <div class="grid grid-cols-4 gap-md">
            {% for group in mailing_groups %}
            <div class="group-card">
                <div class="group-icon">{{ group.icon }}</div>
                <div class="group-name">{{ group.name }}</div>
                <div class="group-count">{{ group.count }}ä»¶</div>
                <div class="group-actions">
                    <button class="btn btn-sm btn-secondary">ç·¨é›†</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- æ–°è¦é…ä¿¡ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="newCampaignModal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">æ–°è¦ãƒ¡ãƒ¼ãƒ«é…ä¿¡ä½œæˆ</h3>
            <button class="modal-close" onclick="closeNewCampaignModal()">&times;</button>
        </div>
        <form>
            <div class="form-group">
                <label class="form-label">é…ä¿¡ã‚¿ã‚¤ãƒ—</label>
                <div class="flex gap-md">
                    <label class="radio-label">
                        <input type="radio" name="campaign_type" value="immediate" checked>
                        <span>å³æ™‚é…ä¿¡</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="campaign_type" value="scheduled">
                        <span>äºˆç´„é…ä¿¡</span>
                    </label>
                </div>
            </div>
            
            <div class="form-group" id="scheduleGroup" style="display: none;">
                <label class="form-label">é…ä¿¡æ—¥æ™‚</label>
                <div class="flex gap-md">
                    <input type="date" class="form-control">
                    <input type="time" class="form-control">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">é…ä¿¡å¯¾è±¡</label>
                <select class="form-control">
                    <option>ã™ã¹ã¦ã®æŠ•è³‡å®¶</option>
                    <option>æ©Ÿé–¢æŠ•è³‡å®¶</option>
                    <option>å€‹äººæŠ•è³‡å®¶</option>
                    <option>æµ·å¤–æŠ•è³‡å®¶</option>
                    <option>ãƒ¡ãƒ¼ãƒ«é€šçŸ¥å¸Œæœ›è€…</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
                <select class="form-control" onchange="loadTemplate()">
                    <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</option>
                    <option value="earnings">æ±ºç®—ç™ºè¡¨é€šçŸ¥</option>
                    <option value="event">ã‚¤ãƒ™ãƒ³ãƒˆæ¡ˆå†…</option>
                    <option value="news">ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                    <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä»¶å</label>
                <input type="text" class="form-control" placeholder="ä¾‹ï¼šã€KAGAMIã€‘2024å¹´åº¦ç¬¬3å››åŠæœŸæ±ºç®—ç™ºè¡¨ã®ãŠçŸ¥ã‚‰ã›">
            </div>
            
            <div class="form-group">
                <label class="form-label">æœ¬æ–‡</label>
                <textarea class="form-control" rows="10" placeholder="ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                <div class="text-sm text-muted mt-sm">
                    åˆ©ç”¨å¯èƒ½ãªå¤‰æ•°: {{investor_name}}, {{company_name}}, {{date}}
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</label>
                <div class="upload-area-small">
                    <span>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</span>
                </div>
            </div>
            
            <div class="flex justify-between">
                <button type="button" class="btn btn-secondary" onclick="closeNewCampaignModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <div class="flex gap-md">
                    <button type="button" class="btn btn-secondary">ä¸‹æ›¸ãä¿å­˜</button>
                    <button type="submit" class="btn btn-primary">é…ä¿¡è¨­å®š</button>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
.grid {
    display: grid;
}

.grid-cols-4 {
    grid-template-columns: repeat(4, 1fr);
}

.group-card {
    background-color: var(--bg-secondary);
    border-radius: var(--border-radius-md);
    padding: var(--space-lg);
    text-align: center;
    transition: all var(--transition-normal);
}

.group-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.group-icon {
    font-size: 2rem;
    margin-bottom: var(--space-sm);
}

.group-name {
    font-weight: var(--font-semibold);
    margin-bottom: var(--space-xs);
}

.group-count {
    color: var(--gray-600);
    font-size: var(--text-sm);
    margin-bottom: var(--space-md);
}

.radio-label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    cursor: pointer;
}

.upload-area-small {
    border: 1px dashed var(--gray-300);
    border-radius: var(--border-radius-md);
    padding: var(--space-md);
    text-align: center;
    background-color: var(--gray-50);
    cursor: pointer;
    transition: all var(--transition-normal);
}

.upload-area-small:hover {
    border-color: var(--kagami-blue);
    background-color: rgba(26, 54, 93, 0.05);
}

@media (max-width: 768px) {
    .grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
function showNewCampaignModal() {
    document.getElementById('newCampaignModal').classList.add('active');
}

function closeNewCampaignModal() {
    document.getElementById('newCampaignModal').classList.remove('active');
}

// é…ä¿¡ã‚¿ã‚¤ãƒ—åˆ‡ã‚Šæ›¿ãˆ
document.querySelectorAll('input[name="campaign_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const scheduleGroup = document.getElementById('scheduleGroup');
        if (this.value === 'scheduled') {
            scheduleGroup.style.display = 'block';
        } else {
            scheduleGroup.style.display = 'none';
        }
    });
});

function loadTemplate() {
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã®å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
    console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.getElementById('newCampaignModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeNewCampaignModal();
    }
});
</script>
{% endblock %}
