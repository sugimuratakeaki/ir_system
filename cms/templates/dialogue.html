{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!-- ヘッダーセクション -->
<div class="flex justify-between items-center mb-lg">
    <div>
        <h2 class="text-2xl font-bold mb-sm">対話記録管理</h2>
        <p class="text-muted">すべての投資家対話記録を一元管理</p>
    </div>
    <div class="flex gap-md">
        <!-- ビュー切り替えボタン -->
        <div class="view-toggle">
            <button class="view-btn active" onclick="setViewMode('simple')" data-view="simple">
                <span class="icon">📋</span>
                <span>シンプル</span>
            </button>
            <button class="view-btn" onclick="setViewMode('detailed')" data-view="detailed">
                <span class="icon">📊</span>
                <span>詳細</span>
            </button>
        </div>
        <button class="btn btn-secondary" onclick="showFilterModal()">
            🔍 詳細フィルタ
        </button>
        <a href="/upload" class="btn btn-primary">
            📤 新規取り込み
        </a>
    </div>
</div>

<!-- 統計サマリー -->
<div class="dashboard-grid mb-lg">
    <div class="kpi-card">
        <div class="kpi-value">156</div>
        <div class="kpi-label">今月の対話記録</div>
        <div class="kpi-trend trend-positive">↑ 23% 前月比</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">42</div>
        <div class="kpi-label">処理待ち</div>
        <div class="kpi-trend trend-negative">↑ 5件 昨日より</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">98%</div>
        <div class="kpi-label">AI分析完了率</div>
        <div class="kpi-trend">→ 安定</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">234</div>
        <div class="kpi-label">FAQ候補生成</div>
        <div class="kpi-trend trend-positive">↑ 45% 効率改善</div>
    </div>
</div>

<!-- フィルタバー -->
<div class="card mb-lg">
    <div class="card-body">
        <div class="flex gap-md items-center flex-wrap">
            <div class="form-group mb-0">
                <select class="form-control">
                    <option>すべてのソース</option>
                    <option>🎙️ 音声・動画</option>
                    <option>💻 Web会議</option>
                    <option>📧 メール</option>
                    <option>📄 文書</option>
                </select>
            </div>
            <div class="form-group mb-0">
                <select class="form-control">
                    <option>すべてのステータス</option>
                    <option>⏳ 処理待ち</option>
                    <option>🔄 処理中</option>
                    <option>✅ 完了</option>
                    <option>❌ エラー</option>
                </select>
            </div>
            <div class="form-group mb-0">
                <input type="date" class="form-control" placeholder="開始日">
            </div>
            <span>〜</span>
            <div class="form-group mb-0">
                <input type="date" class="form-control" placeholder="終了日">
            </div>
            <div class="form-group mb-0 flex-1">
                <input type="text" class="form-control" placeholder="キーワード検索...">
            </div>
            <button class="btn btn-primary">検索</button>
        </div>
    </div>
</div>

<!-- 対話記録一覧 -->
<div class="card">
    <div class="card-body">
        <div class="table-container">
            <table class="table" id="dialogueTable">
                <thead>
                    <tr class="simple-view">
                        <th style="width: 40px;">
                            <input type="checkbox" id="selectAll">
                        </th>
                        <th style="width: 120px;">日時</th>
                        <th style="width: 100px;">データ</th>
                        <th>タイトル/内容</th>
                        <th style="width: 120px;">取引先</th>
                        <th style="width: 150px;">社内関係者</th>
                        <th style="width: 100px;">ステータス</th>
                        <th style="width: 120px;">アクション</th>
                    </tr>
                    <tr class="detailed-view">
                        <th style="width: 40px;">
                            <input type="checkbox" id="selectAllDetailed">
                        </th>
                        <th style="width: 120px;">日時</th>
                        <th style="width: 100px;">データ</th>
                        <th>タイトル/内容</th>
                        <th style="width: 300px;">AIサマリー</th>
                        <th style="width: 120px;">取引先</th>
                        <th style="width: 150px;">社内関係者</th>
                        <th style="width: 100px;">AI分析</th>
                        <th style="width: 100px;">ステータス</th>
                        <th style="width: 120px;">アクション</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Web会議の例 -->
                    <tr class="simple-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/15</div>
                            <div class="text-sm text-muted">14:00-14:45</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon active" title="Web会議">💻</span>
                                <span class="data-icon active" title="音声あり">🎤</span>
                                <span class="data-icon active" title="動画あり">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">45分・156名</div>
                        </td>
                        <td>
                            <div class="font-semibold">2024年第3四半期決算説明会</div>
                            <div class="text-sm text-muted">Zoom会議 • 投資家向け説明会</div>
                        </td>
                        <td>
                            <div class="text-sm">機関投資家多数</div>
                            <div class="text-sm text-muted">投資家向け説明会</div>
                        </td>
                        <td>
                            <div class="text-sm">CEO, CFO</div>
                            <div class="text-sm text-muted">IR部</div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                                <div class="ai-status mt-xs">
                                    <span class="ai-badge ai-complete" title="AI分析完了">🤖</span>
                                    <span class="text-xs">AI処理済</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('meeting_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('meeting_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    <tr class="detailed-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/15</div>
                            <div class="text-sm text-muted">14:00-14:45</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon active" title="Web会議">💻</span>
                                <span class="data-icon active" title="音声あり">🎤</span>
                                <span class="data-icon active" title="動画あり">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">45分・156名</div>
                        </td>
                        <td>
                            <div class="font-semibold">2024年第3四半期決算説明会</div>
                            <div class="text-sm text-muted">Zoom会議 • 投資家向け説明会</div>
                        </td>
                        <td>
                            <div class="ai-summary">
                                <div class="summary-header">
                                    <span class="icon">📝</span>
                                    <span class="text-sm font-semibold">AIサマリー</span>
                                </div>
                                <p class="text-sm mt-sm">好調な業績（売上15%増、AI事業35%増）を報告。投資家から成長戦略、DX投資、ESG目標について質問多数。全体的にポジティブな反応。</p>
                                <div class="summary-tags mt-sm">
                                    <span class="tag-small">📈 成長性</span>
                                    <span class="tag-small">👥 人材確保</span>
                                    <span class="tag-small">🌏 ESG</span>
                                </div>
                                <div class="summary-metrics mt-sm">
                                    <div class="metric-item">
                                        <span class="metric-label">主要トピック:</span>
                                        <span class="metric-value">海外事業(35%), DX投資(25%), ESG(20%)</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">投資家反応:</span>
                                        <span class="metric-value positive">ポジティブ 75%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">重要度:</span>
                                        <span class="metric-value high">高</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-sm">機関投資家多数</div>
                            <div class="text-sm text-muted">投資家向け説明会</div>
                        </td>
                        <td>
                            <div class="text-sm">CEO, CFO</div>
                            <div class="text-sm text-muted">IR部</div>
                        </td>
                        <td>
                            <div class="ai-analysis-summary">
                                <div class="flex gap-xs flex-wrap">
                                    <span class="badge badge-info">FAQ: 12</span>
                                    <span class="badge badge-warning">課題: 3</span>
                                    <span class="badge badge-success">好感75%</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('meeting_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('meeting_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- メールの例 (シンプルビュー) -->
                    <tr class="simple-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/14</div>
                            <div class="text-sm text-muted">16:23</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon inactive" title="音声なし">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon active" title="メールあり">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">メール対応</div>
                        </td>
                        <td>
                            <div class="font-semibold">配当政策に関する質問</div>
                            <div class="text-sm text-muted">機関投資家A社 → IR部</div>
                        </td>
                        <td>
                            <div class="text-sm">機関投資家A社</div>
                            <div class="text-sm text-muted">担当: 田中</div>
                        </td>
                        <td>
                            <div class="text-sm">IR部</div>
                            <div class="text-sm text-muted">担当: 鈴木</div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-warning">🔄 処理中</span>
                                <div class="ai-status mt-xs">
                                    <span class="ai-badge ai-processing" title="AI分析中">🤖</span>
                                    <span class="text-xs">分析中</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" disabled>詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('email_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    <!-- メールの例 (詳細ビュー) -->
                    <tr class="detailed-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/14</div>
                            <div class="text-sm text-muted">16:23</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon inactive" title="音声なし">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon active" title="メールあり">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">メール対応</div>
                        </td>
                        <td>
                            <div class="font-semibold">配当政策に関する質問</div>
                            <div class="text-sm text-muted">機関投資家A社 → IR部</div>
                        </td>
                        <td>
                            <div class="ai-summary">
                                <div class="summary-header">
                                    <span class="icon">📝</span>
                                    <span class="text-sm font-semibold">AIサマリー</span>
                                </div>
                                <p class="text-sm mt-sm">配当性向目標、中期的な株主還元方針、自社株買いの検討状況についての問い合わせ。経営方針に関わる重要事項。</p>
                                <div class="summary-tags mt-sm">
                                    <span class="tag-small">💵 配当</span>
                                    <span class="tag-small">📈 株主還元</span>
                                    <span class="tag-small">⚠️ 重要</span>
                                </div>
                                <div class="summary-metrics mt-sm">
                                    <div class="metric-item">
                                        <span class="metric-label">質問内容:</span>
                                        <span class="metric-value">配当性向、株主還元、自社株買い</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">緊急度:</span>
                                        <span class="metric-value medium">中</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">回答要否:</span>
                                        <span class="metric-value required">要回答</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-sm">機関投資家A社</div>
                            <div class="text-sm text-muted">担当: 田中</div>
                        </td>
                        <td>
                            <div class="text-sm">IR部</div>
                            <div class="text-sm text-muted">担当: 鈴木</div>
                        </td>
                        <td>
                            <div class="ai-analysis-summary">
                                <div class="text-sm text-muted">分析中...</div>
                            </div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-warning">🔄 処理中</span>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" disabled>詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('email_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- 音声の例 (シンプルビュー) -->
                    <tr class="simple-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/13</div>
                            <div class="text-sm text-muted">10:00-10:32</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon active" title="音声あり">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">32分・4名</div>
                        </td>
                        <td>
                            <div class="font-semibold">投資家B社との個別面談</div>
                            <div class="text-sm text-muted">音声ファイル • 個別面談</div>
                        </td>
                        <td>
                            <div class="text-sm">投資家B社</div>
                            <div class="text-sm text-muted">2名参加</div>
                        </td>
                        <td>
                            <div class="text-sm">CFO, IR部長</div>
                            <div class="text-sm text-muted">IR部</div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                                <div class="ai-status mt-xs">
                                    <span class="ai-badge ai-complete" title="AI分析完了">🤖</span>
                                    <span class="text-xs">AI処理済</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('voice_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('voice_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    <!-- 音声の例 (詳細ビュー) -->
                    <tr class="detailed-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/13</div>
                            <div class="text-sm text-muted">10:00-10:32</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon active" title="音声あり">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon inactive" title="文書なし">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">32分・4名</div>
                        </td>
                        <td>
                            <div class="font-semibold">投資家B社との個別面談</div>
                            <div class="text-sm text-muted">音声ファイル • 個別面談</div>
                        </td>
                        <td>
                            <div class="ai-summary">
                                <div class="summary-header">
                                    <span class="icon">📝</span>
                                    <span class="text-sm font-semibold">AIサマリー</span>
                                </div>
                                <p class="text-sm mt-sm">投資家B社との個別面談。事業戦略、財務状況、ESG取り組みについて詳細な説明。投資家からは成長戦略とリスク管理について質問多数。全体的に建設的な対話。</p>
                                <div class="summary-tags mt-sm">
                                    <span class="tag-small">📈 成長戦略</span>
                                    <span class="tag-small">💰 財務</span>
                                    <span class="tag-small">🌏 ESG</span>
                                </div>
                                <div class="summary-metrics mt-sm">
                                    <div class="metric-item">
                                        <span class="metric-label">主要トピック:</span>
                                        <span class="metric-value">事業戦略(40%), 財務(30%), ESG(30%)</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">投資家反応:</span>
                                        <span class="metric-value positive">ポジティブ 80%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">重要度:</span>
                                        <span class="metric-value high">高</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-sm">投資家B社</div>
                            <div class="text-sm text-muted">2名参加</div>
                        </td>
                        <td>
                            <div class="text-sm">CFO, IR部長</div>
                            <div class="text-sm text-muted">IR部</div>
                        </td>
                        <td>
                            <div class="ai-analysis-summary">
                                <div class="flex gap-xs flex-wrap">
                                    <span class="badge badge-info">FAQ: 5</span>
                                    <span class="badge badge-warning">課題: 2</span>
                                    <span class="badge badge-success">好感80%</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('voice_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('voice_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- 文書の例 (シンプルビュー) -->
                    <tr class="simple-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/10</div>
                            <div class="text-sm text-muted">-</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon inactive" title="音声なし">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon active" title="文書あり">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">PDF・15ページ</div>
                        </td>
                        <td>
                            <div class="font-semibold">取締役会議事録</div>
                            <div class="text-sm text-muted">PDF • 議事録</div>
                        </td>
                        <td>
                            <div class="text-sm">-</div>
                            <div class="text-sm text-muted">内部文書</div>
                        </td>
                        <td>
                            <div class="text-sm">取締役会</div>
                            <div class="text-sm text-muted">全取締役</div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                                <div class="ai-status mt-xs">
                                    <span class="ai-badge ai-complete" title="AI分析完了">🤖</span>
                                    <span class="text-xs">AI処理済</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('doc_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('doc_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                    <!-- 文書の例 (詳細ビュー) -->
                    <tr class="detailed-view">
                        <td><input type="checkbox"></td>
                        <td>
                            <div>2024/01/10</div>
                            <div class="text-sm text-muted">-</div>
                        </td>
                        <td>
                            <div class="data-icons">
                                <span class="data-icon inactive" title="Web会議なし">💻</span>
                                <span class="data-icon inactive" title="音声なし">🎤</span>
                                <span class="data-icon inactive" title="動画なし">🎥</span>
                                <span class="data-icon active" title="文書あり">📄</span>
                                <span class="data-icon inactive" title="メールなし">✉️</span>
                            </div>
                            <div class="text-xs text-muted mt-xs">PDF・15ページ</div>
                        </td>
                        <td>
                            <div class="font-semibold">取締役会議事録</div>
                            <div class="text-sm text-muted">PDF • 議事録</div>
                        </td>
                        <td>
                            <div class="ai-summary">
                                <div class="summary-header">
                                    <span class="icon">📝</span>
                                    <span class="text-sm font-semibold">AIサマリー</span>
                                </div>
                                <p class="text-sm mt-sm">2024年1月10日開催の取締役会議事録。中期経営計画の修正、配当方針の変更、DX投資増額など重要な決議事項多数。全取締役出席。</p>
                                <div class="summary-tags mt-sm">
                                    <span class="tag-small">📋 議事録</span>
                                    <span class="tag-small">💰 配当</span>
                                    <span class="tag-small">⚠️ 重要</span>
                                </div>
                                <div class="summary-metrics mt-sm">
                                    <div class="metric-item">
                                        <span class="metric-label">決議事項:</span>
                                        <span class="metric-value">中期計画修正、配当方針変更、DX投資増額</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">重要度:</span>
                                        <span class="metric-value critical">最高</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">開示要否:</span>
                                        <span class="metric-value required">要開示</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-sm">-</div>
                            <div class="text-sm text-muted">内部文書</div>
                        </td>
                        <td>
                            <div class="text-sm">取締役会</div>
                            <div class="text-sm text-muted">全取締役</div>
                        </td>
                        <td>
                            <div class="ai-analysis-summary">
                                <div class="flex gap-xs flex-wrap">
                                    <span class="badge badge-info">重要: 8</span>
                                    <span class="badge badge-warning">決議: 5</span>
                                    <span class="badge badge-success">完了</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-indicator">
                                <span class="badge badge-success">✅ 完了</span>
                            </div>
                        </td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="btn btn-sm btn-primary" onclick="showDetailModal('doc_001')">詳細</button>
                                <button class="btn btn-sm btn-secondary" onclick="editDialogue('doc_001')">編集</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- ページネーション -->
        <div class="flex justify-between items-center mt-lg">
            <div class="text-sm text-muted">
                全156件中 1-10件を表示
            </div>
            <div class="flex gap-sm">
                <button class="btn btn-sm btn-secondary" disabled>前へ</button>
                <button class="btn btn-sm btn-secondary active">1</button>
                <button class="btn btn-sm btn-secondary">2</button>
                <button class="btn btn-sm btn-secondary">3</button>
                <span>...</span>
                <button class="btn btn-sm btn-secondary">16</button>
                <button class="btn btn-sm btn-secondary">次へ</button>
            </div>
        </div>
    </div>
</div>

<!-- 一括操作バー -->
<div class="fixed-bottom-bar" id="bulkActionBar" style="display: none;">
    <div class="container flex justify-between items-center">
        <div>
            <span id="selectedCount">0</span>件を選択中
        </div>
        <div class="flex gap-md">
            <button class="btn btn-sm btn-secondary">タグ付け</button>
            <button class="btn btn-sm btn-secondary">公開設定変更</button>
            <button class="btn btn-sm btn-secondary">エクスポート</button>
            <button class="btn btn-sm btn-danger">削除</button>
        </div>
    </div>
</div>

<!-- 詳細モーダル -->
<div id="detailModal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="closeDetailModal()"></div>
    <div class="modal-content" style="max-width: 90%; width: 1200px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <h2 class="text-xl font-bold">対話記録詳細</h2>
            <button class="btn btn-icon" onclick="closeDetailModal()">✕</button>
        </div>
        
        <div class="modal-body">
            <!-- 内容はshowDetailModal()で動的に生成 -->
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDetailModal()">閉じる</button>
            <button class="btn btn-primary" onclick="editFromModal()">編集画面へ</button>
        </div>
    </div>
</div>

<style>
/* ビュー切り替えボタン */
.view-toggle {
    display: flex;
    background-color: var(--gray-100);
    border-radius: var(--border-radius-md);
    padding: 2px;
}

.view-btn {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    background-color: transparent;
    border: none;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: var(--text-sm);
    color: var(--gray-600);
}

.view-btn:hover {
    color: var(--gray-800);
}

.view-btn.active {
    background-color: white;
    color: var(--kagami-blue);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.view-btn .icon {
    font-size: 1.2em;
}

/* データアイコン */
.data-icons {
    display: flex;
    gap: 2px;
    justify-content: center;
    flex-wrap: wrap;
}

.data-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    font-size: 14px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.data-icon.active {
    background-color: rgba(21, 123, 255, 0.1);
    filter: grayscale(0);
}

.data-icon.inactive {
    background-color: var(--gray-50);
    filter: grayscale(1);
    opacity: 0.4;
}

/* AIステータス */
.ai-status {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.ai-badge {
    font-size: 16px;
}

.ai-badge.ai-complete {
    filter: hue-rotate(120deg);
}

.ai-badge.ai-processing {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* AIサマリー */
.ai-summary {
    background-color: var(--gray-50);
    padding: var(--space-sm);
    border-radius: var(--border-radius-md);
    border-left: 3px solid var(--kagami-blue);
}

.summary-header {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.summary-tags {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
}

.tag-small {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    padding: 2px 8px;
    background-color: white;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
    color: var(--gray-700);
}

/* ステータスインジケーター */
.status-indicator {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-xs);
}

/* AI分析サマリー */
.ai-analysis-summary {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.flex-wrap {
    flex-wrap: wrap;
}

.mt-xs {
    margin-top: var(--space-xs);
}

/* テーブルのビュー切り替え */
.table tbody tr {
    transition: all 0.3s ease;
}

/* デフォルト状態: シンプルビューを表示 */
.table tbody tr.simple-view {
    display: table-row !important;
}

.table tbody tr.detailed-view {
    display: none !important;
}

/* 詳細モード時: 詳細ビューを表示 */
body.detailed-mode .table tbody tr.simple-view {
    display: none !important;
}

body.detailed-mode .table tbody tr.detailed-view {
    display: table-row !important;
}

/* ヘッダーの切り替え */
.table thead tr.simple-view {
    display: table-row !important;
}

.table thead tr.detailed-view {
    display: none !important;
}

body.detailed-mode .table thead tr.simple-view {
    display: none !important;
}

body.detailed-mode .table thead tr.detailed-view {
    display: table-row !important;
}

/* 固定底部バー */
.fixed-bottom-bar {
    position: fixed;
    bottom: 0;
    left: 250px; /* サイドバーの幅 */
    right: 0;
    background-color: white;
    border-top: 1px solid var(--gray-200);
    padding: var(--space-md);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 100;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
}

/* モーダル */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    position: relative;
    background-color: white;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    z-index: 1001;
}

.modal-header {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: var(--space-lg);
}

.modal-footer {
    padding: var(--space-lg);
    border-top: 1px solid var(--gray-200);
    display: flex;
    justify-content: flex-end;
    gap: var(--space-md);
}

/* フレックスユーティリティ */
.flex-1 {
    flex: 1;
}

.gap-xs {
    gap: var(--space-xs);
}

.mb-0 {
    margin-bottom: 0;
}

/* サマリーメトリクス */
.summary-metrics {
    border-top: 1px solid var(--gray-200);
    padding-top: var(--space-sm);
}

.metric-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xs);
    font-size: var(--text-xs);
}

.metric-item:last-child {
    margin-bottom: 0;
}

.metric-label {
    color: var(--gray-600);
    font-weight: var(--font-medium);
}

.metric-value {
    font-weight: var(--font-semibold);
}

.metric-value.positive {
    color: var(--success-green);
}

.metric-value.negative {
    color: var(--error-red);
}

.metric-value.high {
    color: var(--warning-yellow);
}

.metric-value.critical {
    color: var(--error-red);
}

.metric-value.medium {
    color: var(--warning-yellow);
}

.metric-value.required {
    color: var(--error-red);
    font-weight: var(--font-bold);
}

/* レスポンシブ */
@media (max-width: 768px) {
    .fixed-bottom-bar {
        left: 0;
    }
    
    .flex-wrap {
        flex-wrap: wrap;
    }
}
</style>

{% endblock %}

{% block extra_js %}
<script>
// ビューモードの切り替え
function setViewMode(mode) {
    console.log('setViewMode called with:', mode);
    
    // ボタンのアクティブ状態を更新
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-view="${mode}"]`).classList.add('active');
    
    // bodyにクラスを追加/削除
    if (mode === 'detailed') {
        document.body.classList.add('detailed-mode');
        console.log('Added detailed-mode class to body');
    } else {
        document.body.classList.remove('detailed-mode');
        console.log('Removed detailed-mode class from body');
    }
    
    // チェックボックスの同期
    syncCheckboxes();
    
    // LocalStorageに保存
    localStorage.setItem('dialogueViewMode', mode);
    
    // デバッグ: 現在の表示状態を確認
    const simpleRows = document.querySelectorAll('tbody tr.simple-view');
    const detailedRows = document.querySelectorAll('tbody tr.detailed-view');
    console.log('Simple rows:', simpleRows.length);
    console.log('Detailed rows:', detailedRows.length);
    console.log('Body has detailed-mode class:', document.body.classList.contains('detailed-mode'));
}

// チェックボックスの同期
function syncCheckboxes() {
    const isDetailedMode = document.body.classList.contains('detailed-mode');
    const selectAll = isDetailedMode ? document.getElementById('selectAllDetailed') : document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll(`tbody tr.${isDetailedMode ? 'detailed' : 'simple'}-view input[type="checkbox"]`);
    
    // 全選択チェックボックスの状態を更新
    if (selectAll) {
        selectAll.checked = Array.from(checkboxes).every(cb => cb.checked);
    }
}

// ページ読み込み時に保存されたビューモードを適用
window.addEventListener('DOMContentLoaded', function() {
    const savedMode = localStorage.getItem('dialogueViewMode') || 'simple';
    if (savedMode === 'detailed') {
        setViewMode('detailed');
    }
});

// 編集画面への遷移
function editDialogue(recordId) {
    window.location.href = `/dialogue/edit?id=${recordId}`;
}

// チェックボックス管理
function setupCheckboxListeners() {
    // 全選択チェックボックス
    ['selectAll', 'selectAllDetailed'].forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox) {
            checkbox.addEventListener('change', function() {
                const isDetailedMode = document.body.classList.contains('detailed-mode');
                const viewClass = isDetailedMode ? 'detailed-view' : 'simple-view';
                const checkboxes = document.querySelectorAll(`tbody tr.${viewClass} input[type="checkbox"]`);
                checkboxes.forEach(cb => cb.checked = this.checked);
                updateBulkActionBar();
            });
        }
    });
    
    // 個別チェックボックス
    document.querySelectorAll('tbody input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', function() {
            updateBulkActionBar();
            syncCheckboxes();
        });
    });
}

// ページ読み込み時にリスナーを設定
window.addEventListener('DOMContentLoaded', function() {
    setupCheckboxListeners();
});

// 一括操作バーの更新
function updateBulkActionBar() {
    const isDetailedMode = document.body.classList.contains('detailed-mode');
    const viewClass = isDetailedMode ? 'detailed-view' : 'simple-view';
    const checkedBoxes = document.querySelectorAll(`tbody tr.${viewClass} input[type="checkbox"]:checked`);
    const count = checkedBoxes.length;
    const bulkActionBar = document.getElementById('bulkActionBar');
    
    if (count > 0) {
        document.getElementById('selectedCount').textContent = count;
        bulkActionBar.style.display = 'block';
    } else {
        bulkActionBar.style.display = 'none';
    }
}

// 詳細モーダルの表示
let currentRecordId = null; // 現在表示中の記録ID

function showDetailModal(recordId) {
    currentRecordId = recordId; // IDを保存
    const modal = document.getElementById('detailModal');
    const modalBody = modal.querySelector('.modal-body');
    
    // レコードタイプに応じて適切な内容を表示
    if (recordId.startsWith('meeting_')) {
        modalBody.innerHTML = getMeetingDetailContent();
    } else if (recordId.startsWith('email_')) {
        modalBody.innerHTML = getEmailDetailContent();
    } else if (recordId.startsWith('voice_')) {
        modalBody.innerHTML = getVoiceDetailContent();
    } else if (recordId.startsWith('doc_')) {
        modalBody.innerHTML = getDocumentDetailContent();
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// Web会議の詳細コンテンツ
function getMeetingDetailContent() {
    return `
        <!-- 基本情報 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">📋 基本情報</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label class="form-label">タイトル</label>
                        <input type="text" class="form-control" value="2024年第3四半期決算説明会">
                    </div>
                    <div class="form-group">
                        <label class="form-label">開催日時</label>
                        <input type="datetime-local" class="form-control" value="2024-01-15T14:00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">会議システム</label>
                        <select class="form-control">
                            <option selected>Zoom</option>
                            <option>Teams</option>
                            <option>Webex</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">参加者数</label>
                        <input type="number" class="form-control" value="156">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">主な参加者</label>
                    <div class="tag-input">
                        <span class="tag">CEO 山田太郎</span>
                        <span class="tag">CFO 鈴木花子</span>
                        <span class="tag">機関投資家（120名）</span>
                        <span class="tag">個人投資家（30名）</span>
                        <input type="text" class="form-control" placeholder="参加者を追加...">
                    </div>
                    <div class="faq-candidate">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold">Q: エンジニア採用の具体的な目標は？</h4>
                                <p class="text-sm text-muted mt-sm">A: 2025年度末までに200名体制を目指し、現在150名まで増強。新卒・中途採用をバランス良く進め、特にAI・機械学習分野のスペシャリスト確保に注力しています。</p>
                            </div>
                            <div class="flex gap-sm">
                                <span class="confidence-badge confidence-high">信頼度: 95%</span>
                                <label class="flex items-center gap-sm">
                                    <input type="checkbox" checked>
                                    <span>採用</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-md">
                    <button class="btn btn-sm btn-secondary">すべてのFAQ候補を表示</button>
                </div>
            </div>
        </div>

        <!-- フォローアップタスク -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">📋 フォローアップタスク</h3>
            </div>
            <div class="card-body">
                <div class="task-list">
                    <div class="task-item">
                        <input type="checkbox" id="task1">
                        <label for="task1">
                            <span class="task-title">競合分析レポートの更新</span>
                            <span class="task-meta">期限: 2025/01/31 • 担当: 事業企画部</span>
                        </label>
                    </div>
                    <div class="task-item">
                        <input type="checkbox" id="task2">
                        <label for="task2">
                            <span class="task-title">人材確保戦略の詳細資料作成</span>
                            <span class="task-meta">期限: 2025/01/25 • 担当: 人事部</span>
                        </label>
                    </div>
                    <div class="task-item">
                        <input type="checkbox" id="task3">
                        <label for="task3">
                            <span class="task-title">AI事業の成長戦略プレゼン資料更新</span>
                            <span class="task-meta">期限: 2025/02/05 • 担当: AI事業部</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI分析結果 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">🤖 AI分析結果</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-md">
                    <h4 class="font-semibold mb-sm">📝 対話サマリー</h4>
                    <p>第3四半期の好調な業績（売上高前年同期比15%増、特にAI事業35%増）を報告。投資家からは今後の成長戦略、DX投資計画、ESG目標について多数の質問。全体的にポジティブな反応を得たが、競合他社の動向と人材確保については慎重な見方も示された。</p>
                </div>
                
                <div class="grid grid-cols-2 gap-md">
                    <div>
                        <h4 class="font-semibold mb-sm">📊 主要トピック</h4>
                        <ul class="list-disc list-inside space-y-sm">
                            <li>海外事業の成長戦略（35%の時間）</li>
                            <li>DX投資計画（25%の時間）</li>
                            <li>ESG目標と施策（20%の時間）</li>
                            <li>財務状況・配当方針（20%の時間）</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-sm">😊 投資家センチメント</h4>
                        <div class="sentiment-chart">
                            <div class="sentiment-bar positive" style="width: 75%;">ポジティブ 75%</div>
                            <div class="sentiment-bar neutral" style="width: 20%;">中立 20%</div>
                            <div class="sentiment-bar negative" style="width: 5%;">ネガティブ 5%</div>
                        </div>
                        <div class="mt-md">
                            <h5 class="font-medium mb-sm">⚠️ 検出された課題・懸念</h5>
                            <ul class="concern-list-compact">
                                <li class="concern-high">🔴 人材確保の持続可能性への懸念</li>
                                <li class="concern-medium">🟡 競合他社の追い上げリスク</li>
                                <li class="concern-low">🟢 海外展開のスピード感</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ候補 -->
        <div class="card mb-lg">
            <div class="card-header flex justify-between items-center">
                <h3 class="text-lg font-semibold">❓ FAQ候補（12件）</h3>
                <button class="btn btn-sm btn-primary">すべて採用</button>
            </div>
            <div class="card-body">
                <div class="space-y-md">
                    <div class="faq-candidate">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold">Q: AI事業の成長率35%の要因は？</h4>
                                <p class="text-sm text-muted mt-sm">A: エンタープライズSaaSの好調、新製品の市場投入、既存顧客のアップセルが寄与しました。特に大手企業向けAIソリューションの採用が加速しています。</p>
                            </div>
                            <div class="flex gap-sm">
                                <span class="confidence-badge confidence-high">信頼度: 98%</span>
                                <label class="flex items-center gap-sm">
                                    <input type="checkbox" checked>
                                    <span>採用</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 公開設定 -->
        <div class="card">
            <div class="card-header">
                <h3 class="text-lg font-semibold">🔒 公開設定</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label class="form-label">公開範囲</label>
                        <select class="form-control">
                            <option>非公開（IR部門のみ）</option>
                            <option>社内公開</option>
                            <option selected>投資家限定公開</option>
                            <option>一般公開</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">公開日時</label>
                        <input type="datetime-local" class="form-control" value="2024-01-15T18:00">
                    </div>
                </div>
            </div>
        </div>
    `;
}

// メールの詳細コンテンツ
function getEmailDetailContent() {
    return `
        <!-- 基本情報 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">📧 メール情報</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label class="form-label">送信者</label>
                        <input type="text" class="form-control" value="機関投資家A社 田中様">
                    </div>
                    <div class="form-group">
                        <label class="form-label">受信日時</label>
                        <input type="datetime-local" class="form-control" value="2024-01-14T16:23">
                    </div>
                    <div class="form-group">
                        <label class="form-label">件名</label>
                        <input type="text" class="form-control" value="配当政策に関する質問">
                    </div>
                    <div class="form-group">
                        <label class="form-label">重要度</label>
                        <select class="form-control">
                            <option>低</option>
                            <option selected>中</option>
                            <option>高</option>
                            <option>緊急</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">メール本文</label>
                    <div class="email-content">
                        <p>いつもお世話になっております。</p>
                        <p>貴社の配当政策について、以下の点を確認させていただきたくご連絡いたしました。</p>
                        <ol>
                            <li>今期の配当性向目標について</li>
                            <li>中期的な株主還元方針</li>
                            <li>自社株買いの検討状況</li>
                        </ol>
                        <p>お忙しいところ恐縮ですが、ご回答いただければ幸いです。</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI分析・回答案 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">🤖 AI分析・回答案</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-md">
                    <span>⚠️</span>
                    <span>配当政策に関する重要な質問です。経営陣の承認が必要な可能性があります。</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">回答案</label>
                    <textarea class="form-control" rows="10">
田中様

お問い合わせいただきありがとうございます。
配当政策について以下のとおり回答いたします。

1. 今期の配当性向目標
   当社は安定配当を基本方針とし、今期は配当性向30%を目標としております。

2. 中期的な株主還元方針
   今後3年間で配当性向を段階的に35%まで引き上げる予定です。
   業績向上に応じて、株主の皆様への還元を強化してまいります。

3. 自社株買いの検討状況
   現時点では具体的な計画はございませんが、資本効率向上の観点から
   継続的に検討してまいります。

ご不明な点がございましたら、お気軽にお問い合わせください。

IR部 鈴木
                    </textarea>
                </div>
                
                <div class="flex gap-md">
                    <button class="btn btn-primary">この内容で返信</button>
                    <button class="btn btn-secondary">下書き保存</button>
                    <button class="btn btn-secondary">承認依頼</button>
                </div>
            </div>
        </div>
    `;
}

// 音声の詳細コンテンツ
function getVoiceDetailContent() {
    // 基本的にWeb会議と同様の構造だが、音声特有の要素を追加
    return getMeetingDetailContent();
}

// 文書の詳細コンテンツ
function getDocumentDetailContent() {
    return `
        <!-- 基本情報 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">📄 文書情報</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label class="form-label">文書名</label>
                        <input type="text" class="form-control" value="取締役会議事録_20240110">
                    </div>
                    <div class="form-group">
                        <label class="form-label">文書タイプ</label>
                        <select class="form-control">
                            <option>決算資料</option>
                            <option>説明会資料</option>
                            <option selected>議事録</option>
                            <option>適時開示</option>
                            <option>その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">作成日</label>
                        <input type="date" class="form-control" value="2024-01-10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ページ数</label>
                        <input type="number" class="form-control" value="15">
                    </div>
                </div>
            </div>
        </div>

        <!-- AI抽出情報 -->
        <div class="card mb-lg">
            <div class="card-header">
                <h3 class="text-lg font-semibold">🤖 AI抽出情報</h3>
            </div>
            <div class="card-body">
                <h4 class="font-semibold mb-sm">📌 重要事項（8件）</h4>
                <div class="space-y-sm mb-md">
                    <div class="alert alert-warning">
                        <strong>中期経営計画の修正承認</strong>
                        <p class="text-sm mt-sm">DX投資を50億円から70億円に増額することを承認</p>
                    </div>
                    <div class="alert alert-info">
                        <strong>配当方針の変更</strong>
                        <p class="text-sm mt-sm">配当性向を30%から35%に引き上げることを決議</p>
                    </div>
                </div>
                
                <h4 class="font-semibold mb-sm">🔢 抽出された数値情報</h4>
                <table class="table">
                    <tr>
                        <td>DX投資額</td>
                        <td class="font-semibold">70億円</td>
                    </tr>
                    <tr>
                        <td>配当性向</td>
                        <td class="font-semibold">35%</td>
                    </tr>
                    <tr>
                        <td>売上高目標（3年後）</td>
                        <td class="font-semibold">1,500億円</td>
                    </tr>
                </table>
            </div>
        </div>
    `;
}

// 詳細モーダルを閉じる
function closeDetailModal() {
    document.getElementById('detailModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// モーダルから編集画面へ
function editFromModal() {
    if (currentRecordId) {
        window.location.href = `/dialogue/edit?id=${currentRecordId}`;
    }
}

// タグ入力の処理
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('tag-input') || e.target.parentElement?.classList.contains('tag-input')) {
        const input = e.target.querySelector('input') || e.target;
        if (input.tagName === 'INPUT') {
            input.focus();
        }
    }
});

// スタイル追加
const style = document.createElement('style');
style.textContent = `
.email-content {
    background-color: var(--gray-50);
    padding: var(--space-md);
    border-radius: var(--border-radius-md);
    font-family: monospace;
}

.sentiment-chart {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.sentiment-bar {
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    text-align: center;
}

.sentiment-bar.positive {
    background-color: rgba(16, 185, 129, 0.2);
    color: var(--success-green);
}

.sentiment-bar.neutral {
    background-color: rgba(107, 114, 128, 0.2);
    color: var(--gray-600);
}

.sentiment-bar.negative {
    background-color: rgba(239, 68, 68, 0.2);
    color: var(--error-red);
}

.tag-input {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    align-items: center;
    padding: var(--space-sm);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-md);
    background-color: white;
}

.tag {
    display: inline-flex;
    align-items: center;
    padding: var(--space-xs) var(--space-sm);
    background-color: var(--kagami-blue);
    color: white;
    border-radius: var(--border-radius-full);
    font-size: var(--text-sm);
}

.tag-input input {
    flex: 1;
    min-width: 150px;
    border: none;
    outline: none;
    padding: var(--space-xs);
}

.confidence-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background-color: var(--gray-100);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
}

.confidence-high {
    background-color: rgba(16, 185, 129, 0.1);
    color: var(--success-green);
}

.faq-candidate {
    padding: var(--space-md);
    background-color: var(--gray-50);
    border-radius: var(--border-radius-md);
    border: 1px solid var(--gray-200);
}

/* 懸念リスト（コンパクト） */
.concern-list-compact {
    list-style: none;
    padding: 0;
    margin: 0;
}

.concern-list-compact li {
    padding: var(--space-xs) var(--space-sm);
    margin-bottom: var(--space-xs);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
}

.concern-list-compact .concern-high {
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--error-red);
}

.concern-list-compact .concern-medium {
    background-color: rgba(245, 158, 11, 0.1);
    color: var(--warning-yellow);
}

.concern-list-compact .concern-low {
    background-color: rgba(16, 185, 129, 0.1);
    color: var(--success-green);
}

/* タスクリスト */
.task-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.task-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm);
    background-color: var(--gray-50);
    border-radius: var(--border-radius-sm);
}

.task-item input[type="checkbox"] {
    cursor: pointer;
}

.task-item label {
    flex: 1;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.task-title {
    font-weight: var(--font-medium);
}

.task-meta {
    font-size: var(--text-sm);
    color: var(--gray-600);
}

.task-item input[type="checkbox"]:checked + label .task-title {
    text-decoration: line-through;
    color: var(--gray-500);
}

.grid {
    display: grid;
}

.grid-cols-2 {
    grid-template-columns: repeat(2, 1fr);
}

.gap-md {
    gap: var(--space-md);
}

.space-y-sm > * + * {
    margin-top: var(--space-sm);
}

.space-y-md > * + * {
    margin-top: var(--space-md);
}
`;
document.head.appendChild(style);
</script>
{% endblock %}
