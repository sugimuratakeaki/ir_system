{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!-- FAQçµ±è¨ˆ -->
<div class="faq-stats">
    <div class="stat-card">
        <div class="stat-value">{{ total_faqs }}</div>
        <div class="stat-label">ç·FAQæ•°</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ published_count }}</div>
        <div class="stat-label">å…¬é–‹ä¸­</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ total_faqs - published_count }}</div>
        <div class="stat-label">ä¸‹æ›¸ã</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">95%</div>
        <div class="stat-label">å¹³å‡ä¿¡é ¼åº¦</div>
    </div>
</div>

<!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
<div class="flex justify-between items-center mb-lg">
    <div class="flex gap-md">
        <button class="btn btn-primary" onclick="showNewFAQModal()">
            <span>â•</span> æ–°è¦FAQä½œæˆ
        </button>
        <button class="btn btn-secondary" onclick="bulkGenerateFAQs()">
            <span>ğŸ¤–</span> AIä¸€æ‹¬ç”Ÿæˆ
        </button>
    </div>
    
    <div class="flex gap-md">
        <input type="text" class="form-control" placeholder="FAQã‚’æ¤œç´¢..." style="width: 300px;">
        <select class="form-control" style="width: 150px;">
            <option>ã™ã¹ã¦</option>
            <option>å…¬é–‹ä¸­</option>
            <option>ä¸‹æ›¸ã</option>
        </select>
    </div>
</div>

<!-- FAQä¸€è¦§ -->
<div class="faq-table">
    <table class="table">
        <thead>
            <tr>
                <th style="width: 40px;">
                    <input type="checkbox" onchange="toggleAllCheckboxes(this)">
                </th>
                <th>è³ªå•</th>
                <th>å›ç­”ï¼ˆè¦ç´„ï¼‰</th>
                <th style="width: 100px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th style="width: 100px;">ä¿¡é ¼åº¦</th>
                <th style="width: 120px;">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
        </thead>
        <tbody>
            {% for faq in faqs %}
            <tr>
                <td>
                    <input type="checkbox" name="faq-select" value="{{ faq.id }}">
                </td>
                <td>{{ faq.question }}</td>
                <td>{{ faq.answer[:50] }}...</td>
                <td>
                    {% if faq.status == 'published' %}
                        <span class="badge badge-success">å…¬é–‹ä¸­</span>
                    {% else %}
                        <span class="badge badge-warning">ä¸‹æ›¸ã</span>
                    {% endif %}
                </td>
                <td>
                    <span class="confidence-badge {% if faq.confidence >= 95 %}confidence-high{% elif faq.confidence >= 85 %}confidence-medium{% else %}confidence-low{% endif %}">
                        {{ faq.confidence }}%
                    </span>
                </td>
                <td>
                    <div class="flex gap-sm">
                        <button class="btn btn-sm btn-secondary" onclick="editFAQ({{ faq.id }})">ç·¨é›†</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFAQ({{ faq.id }})">å‰Šé™¤</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
<div class="flex justify-center mt-lg">
    <div class="flex gap-sm">
        <button class="btn btn-sm btn-secondary">å‰ã¸</button>
        <button class="btn btn-sm btn-primary">1</button>
        <button class="btn btn-sm btn-secondary">2</button>
        <button class="btn btn-sm btn-secondary">3</button>
        <button class="btn btn-sm btn-secondary">æ¬¡ã¸</button>
    </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆFAQä½œæˆ/ç·¨é›†ï¼‰ -->
<div class="modal" id="faqModal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2 class="modal-title">FAQç·¨é›†</h2>
            <button class="modal-close" onclick="closeModal('faqModal')">&times;</button>
        </div>
        <form onsubmit="event.preventDefault(); saveFAQ();">
            <div class="form-group">
                <label class="form-label">è³ªå•</label>
                <input type="text" class="form-control" id="faq-question" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">å›ç­”</label>
                <textarea class="form-control" id="faq-answer" rows="6" required></textarea>
            </div>
            
            <div class="flex gap-lg">
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
                    <select class="form-control">
                        <option>è²¡å‹™ãƒ»æ¥­ç¸¾</option>
                        <option>çµŒå–¶æˆ¦ç•¥</option>
                        <option>ESG</option>
                        <option>æ ªä¸»é‚„å…ƒ</option>
                        <option>ãã®ä»–</option>
                    </select>
                </div>
                
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select class="form-control">
                        <option value="draft">ä¸‹æ›¸ã</option>
                        <option value="published">å…¬é–‹</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">AIåˆ†æçµæœ</label>
                <div class="alert alert-info">
                    <span>ğŸ¤–</span>
                    <div>
                        <strong>ä¿¡é ¼åº¦: 95%</strong><br>
                        é¡ä¼¼FAQ: 3ä»¶æ¤œå‡º | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: è²¡å‹™ã€æ¥­ç¸¾ã€è¦‹é€šã—
                    </div>
                </div>
            </div>
            
            <div class="flex gap-md justify-end">
                <button type="button" class="btn btn-secondary" onclick="closeModal('faqModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="btn btn-primary">ä¿å­˜</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// FAQä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showNewFAQModal() {
    document.getElementById('faq-question').value = '';
    document.getElementById('faq-answer').value = '';
    document.getElementById('faqModal').classList.add('active');
}

// FAQç·¨é›†
function editFAQ(id) {
    // ãƒ‡ãƒ¢ç”¨ï¼šå›ºå®šãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
    document.getElementById('faq-question').value = '2024å¹´åº¦ã®æ¥­ç¸¾è¦‹é€šã—ã¯ï¼Ÿ';
    document.getElementById('faq-answer').value = 'å£²ä¸Šé«˜ã¯å‰å¹´æ¯”15%å¢—ã®è¦‹è¾¼ã¿ã§ã™ã€‚';
    document.getElementById('faqModal').classList.add('active');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// FAQä¿å­˜ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
function saveFAQ() {
    alert('FAQã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰');
    closeModal('faqModal');
}

// FAQå‰Šé™¤ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
function deleteFAQ(id) {
    if (confirm('ã“ã®FAQã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        alert('FAQã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰');
    }
}

// AIä¸€æ‹¬ç”Ÿæˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
function bulkGenerateFAQs() {
    if (confirm('éå»ã®å¯¾è©±å±¥æ­´ã‹ã‚‰FAQã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ')) {
        alert('AIåˆ†æã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚å®Œäº†å¾Œã€æ–°è¦FAQãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ï¼ˆãƒ‡ãƒ¢ï¼‰');
    }
}

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å…¨é¸æŠ
function toggleAllCheckboxes(source) {
    const checkboxes = document.getElementsByName('faq-select');
    checkboxes.forEach(checkbox => {
        checkbox.checked = source.checked;
    });
}
</script>
{% endblock %}
