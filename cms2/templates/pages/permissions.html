{% extends "base.html" %}

{% block title %}æ¨©é™ç®¡ç†{% endblock %}

{% block extra_css %}
<style>
    /* æ¨©é™ç®¡ç†å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .permission-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 24px;
        transition: all 0.3s ease;
        border: 1px solid #e5e7eb;
    }
    
    .permission-card:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    
    .role-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 24px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .role-header:hover {
        background: #f3f4f6;
    }
    
    .role-header.expanded {
        background: #e5e7eb;
    }
    
    .role-info {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    .role-icon {
        width: 48px;
        height: 48px;
        background: #e5e7eb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    .role-admin .role-icon {
        background: #fee2e2;
        color: #dc2626;
    }
    
    .role-editor .role-icon {
        background: #dbeafe;
        color: #2563eb;
    }
    
    .role-viewer .role-icon {
        background: #d1fae5;
        color: #059669;
    }
    
    .role-custom .role-icon {
        background: #f3e8ff;
        color: #7c3aed;
    }
    
    .role-details {
        flex: 1;
    }
    
    .role-name {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 4px;
    }
    
    .role-description {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .role-stats {
        display: flex;
        align-items: center;
        gap: 16px;
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .role-body {
        padding: 24px;
        display: none;
    }
    
    .role-header.expanded + .role-body {
        display: block;
    }
    
    .permission-section {
        margin-bottom: 24px;
    }
    
    .permission-section-title {
        font-weight: 600;
        color: #374151;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .permission-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
    }
    
    .permission-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: #f9fafb;
        border-radius: 8px;
        transition: all 0.2s ease;
    }
    
    .permission-item:hover {
        background: #f3f4f6;
    }
    
    .permission-checkbox {
        margin-right: 12px;
    }
    
    .permission-label {
        flex: 1;
        font-size: 0.875rem;
        color: #374151;
    }
    
    .permission-icon {
        color: #9ca3af;
        margin-left: 8px;
    }
    
    .user-permission-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .user-permission-table th {
        background: #f9fafb;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        color: #374151;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .user-permission-table td {
        padding: 12px;
        border-bottom: 1px solid #f3f4f6;
        font-size: 0.875rem;
    }
    
    .user-permission-table tr:hover {
        background: #f9fafb;
    }
    
    .user-avatar {
        width: 32px;
        height: 32px;
        background: #e5e7eb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
    }
    
    .permission-matrix {
        overflow-x: auto;
    }
    
    .matrix-table {
        width: 100%;
        min-width: 800px;
        border-collapse: collapse;
    }
    
    .matrix-table th {
        background: #f9fafb;
        padding: 8px 12px;
        text-align: center;
        font-weight: 600;
        font-size: 0.75rem;
        color: #374151;
        border: 1px solid #e5e7eb;
        white-space: nowrap;
    }
    
    .matrix-table td {
        padding: 8px;
        text-align: center;
        border: 1px solid #f3f4f6;
    }
    
    .matrix-table tbody tr:hover {
        background: #f9fafb;
    }
    
    .matrix-table .resource-name {
        text-align: left;
        font-weight: 500;
        color: #374151;
    }
    
    .permission-indicator {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        margin: 0 auto;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .permission-full {
        background: #10b981;
    }
    
    .permission-read {
        background: #3b82f6;
    }
    
    .permission-none {
        background: #e5e7eb;
    }
    
    .permission-indicator:hover {
        transform: scale(1.2);
    }
    
    .audit-entry {
        display: flex;
        align-items: start;
        gap: 12px;
        padding: 12px;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .audit-entry:last-child {
        border-bottom: none;
    }
    
    .audit-time {
        font-size: 0.75rem;
        color: #9ca3af;
        white-space: nowrap;
    }
    
    .audit-content {
        flex: 1;
        font-size: 0.875rem;
        color: #374151;
    }
    
    .audit-user {
        font-weight: 500;
        color: #111827;
    }
</style>
{% endblock %}

{% block content %}
<!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="mb-8">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">æ¨©é™ç®¡ç†</h1>
            <p class="text-gray-600">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã¨ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®è¨­å®š</p>
        </div>
        <div class="mt-4 lg:mt-0 flex flex-wrap gap-3">
            <button onclick="showMatrixView()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹
            </button>
            <button onclick="showAuditLog()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                å¤‰æ›´å±¥æ­´
            </button>
            <button onclick="createRole()" class="px-4 py-2 bg-kagami-blue text-white rounded-lg hover:bg-kagami-blue-dark transition-colors flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                æ–°è¦ãƒ­ãƒ¼ãƒ«ä½œæˆ
            </button>
        </div>
    </div>
</div>

<!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="bg-white rounded-lg p-4 border border-gray-200">
        <div class="text-sm text-gray-600 mb-1">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
        <div class="text-2xl font-bold text-gray-900">24</div>
        <div class="text-xs text-gray-500 mt-1">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: 22</div>
    </div>
    <div class="bg-white rounded-lg p-4 border border-gray-200">
        <div class="text-sm text-gray-600 mb-1">å®šç¾©æ¸ˆã¿ãƒ­ãƒ¼ãƒ«</div>
        <div class="text-2xl font-bold text-gray-900">5</div>
        <div class="text-xs text-gray-500 mt-1">ã‚«ã‚¹ã‚¿ãƒ : 2</div>
    </div>
    <div class="bg-white rounded-lg p-4 border border-gray-200">
        <div class="text-sm text-gray-600 mb-1">æ¨©é™ã‚°ãƒ«ãƒ¼ãƒ—</div>
        <div class="text-2xl font-bold text-gray-900">8</div>
        <div class="text-xs text-gray-500 mt-1">å…¨128é …ç›®</div>
    </div>
    <div class="bg-white rounded-lg p-4 border border-gray-200">
        <div class="text-sm text-gray-600 mb-1">æœ€çµ‚æ›´æ–°</div>
        <div class="text-2xl font-bold text-gray-900">3æ—¥å‰</div>
        <div class="text-xs text-gray-500 mt-1">ç®¡ç†è€…ã«ã‚ˆã‚‹</div>
    </div>
</div>

<!-- ãƒ­ãƒ¼ãƒ«ç®¡ç† -->
<div class="space-y-4 mb-8">
    <!-- ç®¡ç†è€…ãƒ­ãƒ¼ãƒ« -->
    <div class="permission-card">
        <div class="role-header role-admin expanded" onclick="toggleRole(this)">
            <div class="role-info">
                <div class="role-icon">ğŸ‘‘</div>
                <div class="role-details">
                    <div class="role-name">ç®¡ç†è€…</div>
                    <div class="role-description">ã‚·ã‚¹ãƒ†ãƒ ã®å…¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</div>
                </div>
            </div>
            <div class="role-stats">
                <span>3å</span>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>
        <div class="role-body">
            <!-- IRç®¡ç† -->
            <div class="permission-section">
                <h4 class="permission-section-title">IRç®¡ç†</h4>
                <div class="permission-grid">
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">æŠ•è³‡å®¶æƒ…å ±ã®é–²è¦§ãƒ»ç·¨é›†</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">è­°äº‹éŒ²ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">FAQç®¡ç†</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ãƒ¡ãƒ¼ãƒ«é…ä¿¡</label>
                    </div>
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç† -->
            <div class="permission-section">
                <h4 class="permission-section-title">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†</h4>
                <div class="permission-grid">
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ãŠçŸ¥ã‚‰ã›ã®å…¬é–‹</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</label>
                    </div>
                </div>
            </div>
            
            <!-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç† -->
            <div class="permission-section">
                <h4 class="permission-section-title">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</h4>
                <div class="permission-grid">
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">æ¨©é™ç®¡ç†</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ç›£æŸ»ãƒ­ã‚°ã®é–²è¦§</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" checked disabled class="permission-checkbox">
                        <label class="permission-label">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</label>
                    </div>
                </div>
            </div>
            
            <!-- å‰²ã‚Šå½“ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ -->
            <div class="mt-6">
                <h4 class="font-medium text-gray-900 mb-3">å‰²ã‚Šå½“ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼</h4>
                <div class="flex flex-wrap gap-3">
                    <div class="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg">
                        <div class="user-avatar">å±±ç”°</div>
                        <span class="text-sm">å±±ç”° å¤ªéƒ</span>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg">
                        <div class="user-avatar">éˆ´æœ¨</div>
                        <span class="text-sm">éˆ´æœ¨ ä¸€éƒ</span>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg">
                        <div class="user-avatar">é«˜æ©‹</div>
                        <span class="text-sm">é«˜æ©‹ ç¾å’²</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç·¨é›†è€…ãƒ­ãƒ¼ãƒ« -->
    <div class="permission-card">
        <div class="role-header role-editor" onclick="toggleRole(this)">
            <div class="role-info">
                <div class="role-icon">âœï¸</div>
                <div class="role-details">
                    <div class="role-name">ç·¨é›†è€…</div>
                    <div class="role-description">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½œæˆãƒ»ç·¨é›†ãŒå¯èƒ½</div>
                </div>
            </div>
            <div class="role-stats">
                <span>12å</span>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>
        <div class="role-body">
            <!-- æ¨©é™è¨­å®šå†…å®¹ -->
        </div>
    </div>
    
    <!-- é–²è¦§è€…ãƒ­ãƒ¼ãƒ« -->
    <div class="permission-card">
        <div class="role-header role-viewer" onclick="toggleRole(this)">
            <div class="role-info">
                <div class="role-icon">ğŸ‘ï¸</div>
                <div class="role-details">
                    <div class="role-name">é–²è¦§è€…</div>
                    <div class="role-description">æƒ…å ±ã®é–²è¦§ã®ã¿å¯èƒ½</div>
                </div>
            </div>
            <div class="role-stats">
                <span>7å</span>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>
        <div class="role-body">
            <!-- æ¨©é™è¨­å®šå†…å®¹ -->
        </div>
    </div>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ« -->
    <div class="permission-card">
        <div class="role-header role-custom" onclick="toggleRole(this)">
            <div class="role-info">
                <div class="role-icon">âš¡</div>
                <div class="role-details">
                    <div class="role-name">IRæ‹…å½“è€…</div>
                    <div class="role-description">IRæ¥­å‹™ã«ç‰¹åŒ–ã—ãŸæ¨©é™ã‚»ãƒƒãƒˆ</div>
                </div>
            </div>
            <div class="role-stats">
                <span>5å</span>
                <button onclick="event.stopPropagation(); editRole('custom1')" class="text-accent-teal hover:text-accent-teal/80">
                    ç·¨é›†
                </button>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>
        <div class="role-body">
            <!-- æ¨©é™è¨­å®šå†…å®¹ -->
        </div>
    </div>
</div>

<!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æ¨©é™ä¸€è¦§ -->
<div class="permission-card">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æ¨©é™ä¸€è¦§</h2>
        <div class="flex items-center gap-2">
            <input type="text" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
            <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <option>ã™ã¹ã¦ã®ãƒ­ãƒ¼ãƒ«</option>
                <option>ç®¡ç†è€…</option>
                <option>ç·¨é›†è€…</option>
                <option>é–²è¦§è€…</option>
            </select>
        </div>
    </div>
    
    <div class="overflow-x-auto">
        <table class="user-permission-table">
            <thead>
                <tr>
                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                    <th>éƒ¨ç½²</th>
                    <th>ãƒ­ãƒ¼ãƒ«</th>
                    <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="flex items-center gap-3">
                            <div class="user-avatar">å±±ç”°</div>
                            <div>
                                <div class="font-medium">å±±ç”° å¤ªéƒ</div>
                                <div class="text-xs text-gray-500">yamada@example.com</div>
                            </div>
                        </div>
                    </td>
                    <td>IRéƒ¨</td>
                    <td>
                        <span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">
                            ç®¡ç†è€…
                        </span>
                    </td>
                    <td>10åˆ†å‰</td>
                    <td>
                        <span class="text-green-600 font-medium">æœ‰åŠ¹</span>
                    </td>
                    <td>
                        <button onclick="editUserPermission(1)" class="text-sm text-accent-teal hover:text-accent-teal/80">
                            ç·¨é›†
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="flex items-center gap-3">
                            <div class="user-avatar">ä½è—¤</div>
                            <div>
                                <div class="font-medium">ä½è—¤ èŠ±å­</div>
                                <div class="text-xs text-gray-500">sato@example.com</div>
                            </div>
                        </div>
                    </td>
                    <td>çµŒç†éƒ¨</td>
                    <td>
                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
                            ç·¨é›†è€…
                        </span>
                    </td>
                    <td>2æ™‚é–“å‰</td>
                    <td>
                        <span class="text-green-600 font-medium">æœ‰åŠ¹</span>
                    </td>
                    <td>
                        <button onclick="editUserPermission(2)" class="text-sm text-accent-teal hover:text-accent-teal/80">
                            ç·¨é›†
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="flex items-center gap-3">
                            <div class="user-avatar">éˆ´æœ¨</div>
                            <div>
                                <div class="font-medium">éˆ´æœ¨ ä¸€éƒ</div>
                                <div class="text-xs text-gray-500">suzuki@example.com</div>
                            </div>
                        </div>
                    </td>
                    <td>åºƒå ±éƒ¨</td>
                    <td>
                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
                            é–²è¦§è€…
                        </span>
                    </td>
                    <td>1æ—¥å‰</td>
                    <td>
                        <span class="text-green-600 font-medium">æœ‰åŠ¹</span>
                    </td>
                    <td>
                        <button onclick="editUserPermission(3)" class="text-sm text-accent-teal hover:text-accent-teal/80">
                            ç·¨é›†
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ãƒ­ãƒ¼ãƒ«ã®å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿
    function toggleRole(header) {
        header.classList.toggle('expanded');
        const icon = header.querySelector('svg');
        if (header.classList.contains('expanded')) {
            icon.style.transform = 'rotate(180deg)';
        } else {
            icon.style.transform = 'rotate(0deg)';
        }
    }
    
    // æ–°è¦ãƒ­ãƒ¼ãƒ«ä½œæˆ
    function createRole() {
        showModal({
            title: 'æ–°è¦ãƒ­ãƒ¼ãƒ«ä½œæˆ',
            content: `
                <form class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ­ãƒ¼ãƒ«å</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                            placeholder="ä¾‹: çµŒå–¶ä¼ç”»æ‹…å½“">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">èª¬æ˜</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg" rows="3"
                            placeholder="ã“ã®ãƒ­ãƒ¼ãƒ«ã®ç”¨é€”ã‚„æ¨©é™ã®æ¦‚è¦"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ™ãƒ¼ã‚¹ãƒ­ãƒ¼ãƒ«</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option>æ¨©é™ã‚’æœ€åˆã‹ã‚‰è¨­å®š</option>
                            <option>é–²è¦§è€…ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œæˆ</option>
                            <option>ç·¨é›†è€…ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œæˆ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ã‚¢ã‚¤ã‚³ãƒ³</label>
                        <div class="flex gap-2">
                            <button type="button" class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50">ğŸ¯</button>
                            <button type="button" class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50">ğŸ’¼</button>
                            <button type="button" class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50">ğŸ“Š</button>
                            <button type="button" class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50">ğŸ”§</button>
                            <button type="button" class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50">ğŸŒŸ</button>
                        </div>
                    </div>
                </form>
            `,
            confirmText: 'ä½œæˆ',
            onConfirm: () => {
                showNotification('æ–°ã—ã„ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');
            }
        });
    }
    
    // ãƒ­ãƒ¼ãƒ«ç·¨é›†
    function editRole(roleId) {
        showNotification('ãƒ­ãƒ¼ãƒ«ç·¨é›†ç”»é¢ã‚’é–‹ãã¾ã™', 'info');
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç·¨é›†
    function editUserPermission(userId) {
        showModal({
            title: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã®ç·¨é›†',
            content: `
                <div class="space-y-4">
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div class="user-avatar">å±±ç”°</div>
                        <div>
                            <div class="font-medium">å±±ç”° å¤ªéƒ</div>
                            <div class="text-sm text-gray-500">yamada@example.com</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ­ãƒ¼ãƒ«</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option selected>ç®¡ç†è€…</option>
                            <option>ç·¨é›†è€…</option>
                            <option>é–²è¦§è€…</option>
                            <option>IRæ‹…å½“è€…ï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å€‹åˆ¥æ¨©é™ã®è¿½åŠ </label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">æ±ºç®—è³‡æ–™ã®æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">æ©Ÿå¯†æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">ä»–éƒ¨ç½²ãƒ‡ãƒ¼ã‚¿ã®é–²è¦§</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">IPåˆ¶é™ã‚’æœ‰åŠ¹åŒ–</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">äºŒè¦ç´ èªè¨¼ã‚’å¿…é ˆåŒ–</span>
                            </label>
                        </div>
                    </div>
                </div>
            `,
            confirmText: 'ä¿å­˜',
            onConfirm: () => {
                showNotification('æ¨©é™è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
            }
        });
    }
    
    // æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º
    function showMatrixView() {
        showModal({
            title: 'æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹',
            size: 'xl',
            content: `
                <div class="permission-matrix">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="resource-name">ãƒªã‚½ãƒ¼ã‚¹ / ãƒ­ãƒ¼ãƒ«</th>
                                <th>ç®¡ç†è€…</th>
                                <th>ç·¨é›†è€…</th>
                                <th>é–²è¦§è€…</th>
                                <th>IRæ‹…å½“è€…</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="resource-name">æŠ•è³‡å®¶æƒ…å ±</td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-read" title="èª­ã¿å–ã‚Šå°‚ç”¨"></div></td>
                                <td><div class="permission-indicator permission-read" title="èª­ã¿å–ã‚Šå°‚ç”¨"></div></td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                            </tr>
                            <tr>
                                <td class="resource-name">è­°äº‹éŒ²</td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-read" title="èª­ã¿å–ã‚Šå°‚ç”¨"></div></td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                            </tr>
                            <tr>
                                <td class="resource-name">è²¡å‹™ãƒ‡ãƒ¼ã‚¿</td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-read" title="èª­ã¿å–ã‚Šå°‚ç”¨"></div></td>
                                <td><div class="permission-indicator permission-none" title="ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"></div></td>
                                <td><div class="permission-indicator permission-read" title="èª­ã¿å–ã‚Šå°‚ç”¨"></div></td>
                            </tr>
                            <tr>
                                <td class="resource-name">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-none" title="ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"></div></td>
                                <td><div class="permission-indicator permission-none" title="ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"></div></td>
                                <td><div class="permission-indicator permission-none" title="ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"></div></td>
                            </tr>
                            <tr>
                                <td class="resource-name">ãƒ¡ãƒ¼ãƒ«é…ä¿¡</td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                                <td><div class="permission-indicator permission-none" title="ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯"></div></td>
                                <td><div class="permission-indicator permission-full" title="å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹"></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex items-center justify-center gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="permission-indicator permission-full" style="width: 16px; height: 16px;"></div>
                        <span>å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="permission-indicator permission-read" style="width: 16px; height: 16px;"></div>
                        <span>èª­ã¿å–ã‚Šå°‚ç”¨</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="permission-indicator permission-none" style="width: 16px; height: 16px;"></div>
                        <span>ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯</span>
                    </div>
                </div>
            `,
            confirmText: null,
            cancelText: 'é–‰ã˜ã‚‹'
        });
    }
    
    // å¤‰æ›´å±¥æ­´è¡¨ç¤º
    function showAuditLog() {
        showModal({
            title: 'æ¨©é™å¤‰æ›´å±¥æ­´',
            size: 'lg',
            content: `
                <div class="space-y-1">
                    <div class="audit-entry">
                        <div class="audit-time">2024/01/22 15:30</div>
                        <div class="audit-content">
                            <span class="audit-user">å±±ç”° å¤ªéƒ</span>ãŒ
                            <span class="audit-user">ä½è—¤ èŠ±å­</span>ã®ãƒ­ãƒ¼ãƒ«ã‚’
                            ã€Œé–²è¦§è€…ã€ã‹ã‚‰ã€Œç·¨é›†è€…ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">2024/01/20 10:15</div>
                        <div class="audit-content">
                            <span class="audit-user">éˆ´æœ¨ ä¸€éƒ</span>ãŒ
                            æ–°ã—ã„ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã€ŒIRæ‹…å½“è€…ã€ã‚’ä½œæˆã—ã¾ã—ãŸ
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">2024/01/18 14:45</div>
                        <div class="audit-content">
                            <span class="audit-user">å±±ç”° å¤ªéƒ</span>ãŒ
                            ã€Œç·¨é›†è€…ã€ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ˆãƒ¡ãƒ¼ãƒ«é…ä¿¡æ¨©é™ã‚’è¿½åŠ ï¼‰
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">2024/01/15 09:30</div>
                        <div class="audit-content">
                            <span class="audit-user">é«˜æ©‹ ç¾å’²</span>ãŒ
                            <span class="audit-user">ç”°ä¸­ æ¬¡éƒ</span>ã‚’ã‚·ã‚¹ãƒ†ãƒ ã«è¿½åŠ ã—ã€
                            ã€Œé–²è¦§è€…ã€ãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã¾ã—ãŸ
                        </div>
                    </div>
                </div>
            `,
            confirmText: null,
            cancelText: 'é–‰ã˜ã‚‹'
        });
    }
</script>
{% endblock %}