{% extends "base.html" %}

{% block title %}ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - {{ super() }}{% endblock %}
{% block page_icon %}ğŸ“¤{% endblock %}
{% block page_title %}ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰{% endblock %}
{% block breadcrumb_current %}ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰{% endblock %}

{% block extra_css %}
<style>
    /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .upload-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .upload-step {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 32px;
        margin-bottom: 24px;
    }
    
    .step-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .step-number {
        width: 40px;
        height: 40px;
        background: #e5e7eb;
        color: #6b7280;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1.125rem;
    }
    
    .step-number.active {
        background: #14b8a6;
        color: white;
    }
    
    .step-number.completed {
        background: #10b981;
        color: white;
    }
    
    .step-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #111827;
    }
    
    .upload-zone {
        border: 2px dashed #d1d5db;
        border-radius: 12px;
        padding: 48px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f9fafb;
    }
    
    .upload-zone:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .upload-zone.dragging {
        border-color: #3b82f6;
        background: #dbeafe;
    }
    
    .upload-zone.has-file {
        border-style: solid;
        border-color: #10b981;
        background: #f0fdf4;
        cursor: default;
    }
    
    .upload-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 16px;
        color: #9ca3af;
    }
    
    .upload-zone.has-file .upload-icon {
        color: #10b981;
    }
    
    .file-info {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
        margin-top: 16px;
    }
    
    .file-icon {
        width: 48px;
        height: 48px;
        background: #f3f4f6;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    .file-details {
        flex: 1;
        text-align: left;
    }
    
    .file-name {
        font-weight: 600;
        color: #111827;
        margin-bottom: 4px;
    }
    
    .file-meta {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 0.875rem;
    }
    
    .form-input {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.2s ease;
    }
    
    .form-input:focus {
        outline: none;
        border-color: #14b8a6;
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }
    
    .form-textarea {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        resize: vertical;
        min-height: 100px;
    }
    
    .transcription-progress {
        background: white;
        border-radius: 12px;
        padding: 32px;
        text-align: center;
    }
    
    .progress-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 0.6; transform: scale(0.95); }
        50% { opacity: 1; transform: scale(1); }
        100% { opacity: 0.6; transform: scale(0.95); }
    }
    
    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
        margin: 24px 0;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #14b8a6, #0891b2);
        border-radius: 4px;
        transition: width 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .progress-bar-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
        );
        animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    .progress-steps {
        display: flex;
        justify-content: space-between;
        margin-top: 32px;
    }
    
    .progress-step {
        text-align: center;
        flex: 1;
    }
    
    .progress-step-icon {
        width: 40px;
        height: 40px;
        background: #f3f4f6;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 8px;
        font-size: 20px;
    }
    
    .progress-step.active .progress-step-icon {
        background: #dbeafe;
        color: #3b82f6;
    }
    
    .progress-step.completed .progress-step-icon {
        background: #d1fae5;
        color: #10b981;
    }
    
    .progress-step-label {
        font-size: 0.75rem;
        color: #6b7280;
    }
    
    .transcription-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-top: 24px;
    }
    
    .option-card {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .option-card:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .option-card.selected {
        border-color: #14b8a6;
        background: #f0fdfa;
        border-width: 2px;
    }
    
    .option-card-title {
        font-weight: 600;
        color: #111827;
        margin-bottom: 4px;
    }
    
    .option-card-description {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .action-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 32px;
        padding-top: 24px;
        border-top: 1px solid #e5e7eb;
    }
</style>
{% endblock %}

{% block content %}
<div class="upload-container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h1>
        <p class="text-gray-600">æŠ•è³‡å®¶ã¨ã®é¢è«‡éŸ³å£°ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€AIã§æ–‡å­—èµ·ã“ã—ã‚’è¡Œã„ã¾ã™</p>
    </div>
    
    <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
    <div class="upload-step" id="step1">
        <div class="step-header">
            <div class="step-number active">1</div>
            <h2 class="step-title">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</h2>
        </div>
        
        <div class="upload-zone" id="uploadZone" onclick="selectFile()">
            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</h3>
            <p class="text-sm text-gray-600 mb-4">MP3, WAV, M4A, MP4å½¢å¼ã«å¯¾å¿œï¼ˆæœ€å¤§2GBï¼‰</p>
            <button class="px-6 py-2 bg-kagami-blue text-white rounded-lg hover:bg-kagami-blue-dark transition-colors">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </button>
            <input type="file" id="fileInput" class="hidden" accept=".mp3,.wav,.m4a,.mp4" onchange="handleFileSelect(event)">
        </div>
        
        <div class="file-info" id="fileInfo" style="display: none;">
            <div class="file-icon">ğŸµ</div>
            <div class="file-details">
                <div class="file-name" id="fileName">meeting_recording.mp3</div>
                <div class="file-meta" id="fileMeta">45.2MB â€¢ 45åˆ†30ç§’</div>
            </div>
            <button onclick="removeFile()" class="p-2 text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>
    
    <!-- ã‚¹ãƒ†ãƒƒãƒ—2: åŸºæœ¬æƒ…å ±å…¥åŠ› -->
    <div class="upload-step" id="step2">
        <div class="step-header">
            <div class="step-number">2</div>
            <h2 class="step-title">é¢è«‡æƒ…å ±ã‚’å…¥åŠ›</h2>
        </div>
        
        <form>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    <label class="form-label">æŠ•è³‡å®¶å <span class="text-red-500">*</span></label>
                    <input type="text" class="form-input" placeholder="ä¾‹: é‡æ‘ã‚¢ã‚»ãƒƒãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">é¢è«‡æ—¥æ™‚ <span class="text-red-500">*</span></label>
                    <input type="datetime-local" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å‚åŠ è€…ï¼ˆæŠ•è³‡å®¶å´ï¼‰</label>
                    <input type="text" class="form-input" placeholder="ä¾‹: å±±ç”°å¤ªéƒï¼ˆãƒ•ã‚¡ãƒ³ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å‚åŠ è€…ï¼ˆè‡ªç¤¾å´ï¼‰</label>
                    <input type="text" class="form-input" placeholder="ä¾‹: CEOã€CFOã€IRéƒ¨é•·">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒ—</label>
                    <select class="form-input">
                        <option>1on1é¢è«‡</option>
                        <option>ã‚°ãƒ«ãƒ¼ãƒ—ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°</option>
                        <option>ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</option>
                        <option>æ±ºç®—èª¬æ˜ä¼š</option>
                        <option>ãƒ­ãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">è¨€èª</label>
                    <select class="form-input">
                        <option>æ—¥æœ¬èª</option>
                        <option>è‹±èª</option>
                        <option>æ—¥æœ¬èªãƒ»è‹±èªæ··åœ¨</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€</label>
                <textarea class="form-textarea" placeholder="ä¸»ãªè­°é¡Œã‚„è©±ã—åˆã£ãŸå†…å®¹ã‚’ç°¡å˜ã«è¨˜è¼‰ã—ã¦ãã ã•ã„"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">ã‚¿ã‚°</label>
                <input type="text" class="form-input" placeholder="ä¾‹: æ±ºç®—, DXæˆ¦ç•¥, ESGï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰">
            </div>
        </form>
    </div>
    
    <!-- ã‚¹ãƒ†ãƒƒãƒ—3: æ–‡å­—èµ·ã“ã—è¨­å®š -->
    <div class="upload-step" id="step3">
        <div class="step-header">
            <div class="step-number">3</div>
            <h2 class="step-title">æ–‡å­—èµ·ã“ã—è¨­å®š</h2>
        </div>
        
        <div class="form-group">
            <label class="form-label">æ–‡å­—èµ·ã“ã—ãƒ¢ãƒ‡ãƒ«</label>
            <div class="transcription-options">
                <div class="option-card selected" onclick="selectOption(this, 'model')">
                    <div class="option-card-title">é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆæ¨å¥¨ï¼‰</div>
                    <div class="option-card-description">æœ€é«˜å“è³ªã®æ–‡å­—èµ·ã“ã—ã€‚å°‚é–€ç”¨èªã‚‚é«˜ç²¾åº¦ã§èªè­˜</div>
                </div>
                <div class="option-card" onclick="selectOption(this, 'model')">
                    <div class="option-card-title">é«˜é€Ÿãƒ¢ãƒ‡ãƒ«</div>
                    <div class="option-card-description">å‡¦ç†é€Ÿåº¦é‡è¦–ã€‚é€šå¸¸ã®3å€é€Ÿã§å‡¦ç†</div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½</label>
            <div class="space-y-3">
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-3">
                    <div>
                        <div class="font-medium">è©±è€…åˆ†é›¢</div>
                        <div class="text-sm text-gray-600">è¤‡æ•°ã®è©±è€…ã‚’è‡ªå‹•ã§è­˜åˆ¥ãƒ»åˆ†é›¢ã—ã¾ã™</div>
                    </div>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-3">
                    <div>
                        <div class="font-medium">ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸</div>
                        <div class="text-sm text-gray-600">ç™ºè¨€ã”ã¨ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã—ã¾ã™</div>
                    </div>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-3">
                    <div>
                        <div class="font-medium">è‡ªå‹•è¦ç´„ç”Ÿæˆ</div>
                        <div class="text-sm text-gray-600">è­°äº‹éŒ²ã®è¦ç´„ã¨ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™</div>
                    </div>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="mr-3">
                    <div>
                        <div class="font-medium">FAQè‡ªå‹•ç”Ÿæˆ</div>
                        <div class="text-sm text-gray-600">ã‚ˆãã‚ã‚‹è³ªå•ã¨å›ç­”ã‚’è‡ªå‹•ã§æŠ½å‡ºã—ã¾ã™</div>
                    </div>
                </label>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">å°‚é–€ç”¨èªè¾æ›¸</label>
            <select class="form-input">
                <option>æ¨™æº–è¾æ›¸ + é‡‘èãƒ»IRç”¨èª</option>
                <option>æ¨™æº–è¾æ›¸ã®ã¿</option>
                <option>ã‚«ã‚¹ã‚¿ãƒ è¾æ›¸ã‚’ä½¿ç”¨</option>
            </select>
        </div>
    </div>
    
    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="action-buttons">
        <button onclick="window.history.back()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
        <div class="flex gap-3">
            <button onclick="saveDraft()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                ä¸‹æ›¸ãä¿å­˜
            </button>
            <button onclick="startTranscription()" class="px-6 py-2 bg-kagami-blue text-white rounded-lg hover:bg-kagami-blue-dark transition-colors">
                æ–‡å­—èµ·ã“ã—ã‚’é–‹å§‹
            </button>
        </div>
    </div>
</div>

<!-- æ–‡å­—èµ·ã“ã—ä¸­ã®ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="transcriptionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="transcription-progress">
        <div class="progress-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="text-kagami-blue">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        </div>
        
        <h3 class="text-xl font-semibold text-gray-900 mb-2">AIãŒéŸ³å£°ã‚’æ–‡å­—èµ·ã“ã—ä¸­...</h3>
        <p class="text-gray-600 mb-6">45åˆ†ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã—ã¦ã„ã¾ã™</p>
        
        <div class="progress-bar-container">
            <div class="progress-bar-fill" style="width: 35%"></div>
        </div>
        
        <p class="text-sm text-gray-500 mt-2">äºˆæƒ³æ®‹ã‚Šæ™‚é–“: ç´„8åˆ†</p>
        
        <div class="progress-steps">
            <div class="progress-step completed">
                <div class="progress-step-icon">âœ“</div>
                <div class="progress-step-label">éŸ³å£°è§£æ</div>
            </div>
            <div class="progress-step active">
                <div class="progress-step-icon">âš¡</div>
                <div class="progress-step-label">æ–‡å­—èµ·ã“ã—</div>
            </div>
            <div class="progress-step">
                <div class="progress-step-icon">ğŸ”</div>
                <div class="progress-step-label">è©±è€…åˆ†é›¢</div>
            </div>
            <div class="progress-step">
                <div class="progress-step-icon">ğŸ“</div>
                <div class="progress-step-label">è¦ç´„ç”Ÿæˆ</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
    const uploadZone = document.getElementById('uploadZone');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadZone.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        uploadZone.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight(e) {
        uploadZone.classList.add('dragging');
    }
    
    function unhighlight(e) {
        uploadZone.classList.remove('dragging');
    }
    
    uploadZone.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            handleFile(files[0]);
        }
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    function selectFile() {
        document.getElementById('fileInput').click();
    }
    
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            handleFile(file);
        }
    }
    
    function handleFile(file) {
        // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileMeta').textContent = `${formatFileSize(file.size)} â€¢ æ¨å®šæ™‚é–“: ${estimateDuration(file.size)}`;
        document.getElementById('fileInfo').style.display = 'flex';
        uploadZone.classList.add('has-file');
        
        // ã‚¹ãƒ†ãƒƒãƒ—1ã‚’å®Œäº†çŠ¶æ…‹ã«
        document.querySelector('#step1 .step-number').classList.remove('active');
        document.querySelector('#step1 .step-number').classList.add('completed');
        document.querySelector('#step1 .step-number').innerHTML = 'âœ“';
        
        // ã‚¹ãƒ†ãƒƒãƒ—2ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.querySelector('#step2 .step-number').classList.add('active');
    }
    
    function removeFile() {
        document.getElementById('fileInfo').style.display = 'none';
        uploadZone.classList.remove('has-file');
        document.getElementById('fileInput').value = '';
        
        // ã‚¹ãƒ†ãƒƒãƒ—1ã‚’å†åº¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.querySelector('#step1 .step-number').classList.add('active');
        document.querySelector('#step1 .step-number').classList.remove('completed');
        document.querySelector('#step1 .step-number').innerHTML = '1';
        
        // ã‚¹ãƒ†ãƒƒãƒ—2ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.querySelector('#step2 .step-number').classList.remove('active');
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // æ¨å®šæ™‚é–“ã®è¨ˆç®—ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
    function estimateDuration(fileSize) {
        const minutes = Math.floor(fileSize / (1024 * 1024) * 0.5);
        return `${minutes}åˆ†${Math.floor(Math.random() * 60)}ç§’`;
    }
    
    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠ
    function selectOption(element, type) {
        const options = element.parentElement.querySelectorAll('.option-card');
        options.forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
    }
    
    // ä¸‹æ›¸ãä¿å­˜
    function saveDraft() {
        showNotification('ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
    }
    
    // æ–‡å­—èµ·ã“ã—é–‹å§‹
    function startTranscription() {
        // å…¥åŠ›æ¤œè¨¼
        const requiredFields = document.querySelectorAll('input[required], select[required]');
        let isValid = true;
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        document.getElementById('transcriptionModal').classList.remove('hidden');
        
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        let progress = 0;
        const progressBar = document.querySelector('.progress-bar-fill');
        const progressSteps = document.querySelectorAll('.progress-step');
        
        const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress > 100) progress = 100;
            
            progressBar.style.width = progress + '%';
            
            // ã‚¹ãƒ†ãƒƒãƒ—ã®æ›´æ–°
            if (progress > 25) {
                progressSteps[1].classList.remove('active');
                progressSteps[1].classList.add('completed');
                progressSteps[1].querySelector('.progress-step-icon').innerHTML = 'âœ“';
                progressSteps[2].classList.add('active');
            }
            if (progress > 50) {
                progressSteps[2].classList.remove('active');
                progressSteps[2].classList.add('completed');
                progressSteps[2].querySelector('.progress-step-icon').innerHTML = 'âœ“';
                progressSteps[3].classList.add('active');
            }
            if (progress > 75) {
                progressSteps[3].classList.remove('active');
                progressSteps[3].classList.add('completed');
                progressSteps[3].querySelector('.progress-step-icon').innerHTML = 'âœ“';
            }
            
            if (progress === 100) {
                clearInterval(interval);
                setTimeout(() => {
                    document.getElementById('transcriptionModal').classList.add('hidden');
                    showNotification('æ–‡å­—èµ·ã“ã—ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                    window.location.href = '/dialogue/DLG-2024-004/edit';
                }, 1000);
            }
        }, 500);
    }
</script>
{% endblock %}