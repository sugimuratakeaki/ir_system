{% extends 'base.html' %}

{% block title %}ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†{% endblock %}
{% block page_icon %}ğŸ¤{% endblock %}
{% block page_title %}ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb-item">
    <a href="#" class="breadcrumb-link">IRæ¥­å‹™çµ±åˆ</a>
    <span class="breadcrumb-separator">â€º</span>
</div>
{% endblock %}
{% block breadcrumb_current %}ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†{% endblock %}

{% block content %}
<!-- ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°çµ±è¨ˆ -->
<div class="meeting-stats">
    <div class="stat-card primary">
        <div class="stat-header">
            <span class="stat-icon">ğŸ“…</span>
            <span class="stat-period">ä»Šæœˆ</span>
        </div>
        <div class="stat-body">
            <div class="stat-number">42</div>
            <div class="stat-label">ç·ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ•°</div>
            <div class="stat-change positive">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 12V4M8 4L4 8M8 4L12 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                12% å‰æœˆæ¯”
            </div>
        </div>
    </div>
    
    <div class="stat-card success">
        <div class="stat-header">
            <span class="stat-icon">âœ…</span>
            <span class="stat-period">å®Œäº†ç‡</span>
        </div>
        <div class="stat-body">
            <div class="stat-number">89%</div>
            <div class="stat-label">è­°äº‹éŒ²ä½œæˆæ¸ˆã¿</div>
            <div class="stat-detail">38/42 ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°</div>
        </div>
    </div>
    
    <div class="stat-card info">
        <div class="stat-header">
            <span class="stat-icon">â±ï¸</span>
            <span class="stat-period">å¹³å‡</span>
        </div>
        <div class="stat-body">
            <div class="stat-number">48åˆ†</div>
            <div class="stat-label">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚é–“</div>
            <div class="stat-detail">å‰æœˆ: 52åˆ†</div>
        </div>
    </div>
    
    <div class="stat-card warning">
        <div class="stat-header">
            <span class="stat-icon">ğŸ¯</span>
            <span class="stat-period">ä»Šé€±</span>
        </div>
        <div class="stat-body">
            <div class="stat-number">15</div>
            <div class="stat-label">äºˆå®šãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°</div>
            <div class="stat-detail">3ä»¶ãŒè¦ç¢ºèª</div>
        </div>
    </div>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="meeting-container">
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼/ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ -->
    <div class="view-controls">
        <div class="view-tabs">
            <button class="view-tab active" data-view="calendar">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M17.5 8.33333H2.5M13.3333 1.66667V5M6.66667 1.66667V5M6.5 18.3333H13.5C14.9001 18.3333 15.6002 18.3333 16.135 18.0609C16.6054 17.8212 16.9879 17.4387 17.2276 16.9683C17.5 16.4335 17.5 15.7335 17.5 14.3333V7.33333C17.5 5.93321 17.5 5.23314 17.2276 4.69836C16.9879 4.22796 16.6054 3.8455 16.135 3.60582C15.6002 3.33333 14.9001 3.33333 13.5 3.33333H6.5C5.09988 3.33333 4.39982 3.33333 3.86504 3.60582C3.39464 3.8455 3.01217 4.22796 2.77248 4.69836C2.5 5.23314 2.5 5.93321 2.5 7.33333V14.3333C2.5 15.7335 2.5 16.4335 2.77248 16.9683C3.01217 17.4387 3.39464 17.8212 3.86504 18.0609C4.39982 18.3333 5.09988 18.3333 6.5 18.3333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
            </button>
            <button class="view-tab" data-view="list">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M7.5 5H17.5M7.5 10H17.5M7.5 15H17.5M2.5 5H3.16667M2.5 10H3.16667M2.5 15H3.16667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ãƒªã‚¹ãƒˆ
            </button>
            <button class="view-tab" data-view="kanban">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="2.5" y="2.5" width="5" height="15" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="7.5" y="2.5" width="5" height="10" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="12.5" y="2.5" width="5" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                ã‹ã‚“ã°ã‚“
            </button>
        </div>
        
        <div class="view-actions">
            <button class="btn btn-primary" id="newMeetingBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 3.33333V12.6667M3.33333 8H12.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                æ–°è¦ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°
            </button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
    <div class="view-content" id="calendarView">
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav" id="prevMonth">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                
                <h2 class="calendar-title">2024å¹´3æœˆ</h2>
                
                <button class="calendar-nav" id="nextMonth">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                
                <div class="calendar-controls">
                    <button class="btn btn-sm btn-secondary" id="todayBtn">ä»Šæ—¥</button>
                </div>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">æ—¥</div>
                    <div class="calendar-weekday">æœˆ</div>
                    <div class="calendar-weekday">ç«</div>
                    <div class="calendar-weekday">æ°´</div>
                    <div class="calendar-weekday">æœ¨</div>
                    <div class="calendar-weekday">é‡‘</div>
                    <div class="calendar-weekday">åœŸ</div>
                </div>
                
                <div class="calendar-days" id="calendarDays">
                    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã¨ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ -->
    <div class="view-content" id="listView" style="display: none;">
        <div class="meeting-filters">
            <div class="filter-group">
                <label class="filter-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                <select class="filter-select" id="statusFilter">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="scheduled">äºˆå®š</option>
                    <option value="completed">å®Œäº†</option>
                    <option value="cancelled">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
                    <option value="processing">å‡¦ç†ä¸­</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">æŠ•è³‡å®¶ã‚¿ã‚¤ãƒ—</label>
                <select class="filter-select" id="investorTypeFilter">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="institutional">æ©Ÿé–¢æŠ•è³‡å®¶</option>
                    <option value="overseas">æµ·å¤–æŠ•è³‡å®¶</option>
                    <option value="individual">å€‹äººæŠ•è³‡å®¶</option>
                    <option value="analyst">ã‚¢ãƒŠãƒªã‚¹ãƒˆ</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">æœŸé–“</label>
                <input type="date" class="filter-input" id="dateFrom">
                <span class="filter-separator">ã€œ</span>
                <input type="date" class="filter-input" id="dateTo">
            </div>
            
            <button class="btn btn-secondary" id="applyFilters">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 4H14M4 8H12M6 12H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            </button>
        </div>
        
        <div class="meeting-table-container" id="meetingTableContainer">
            <!-- DataTableã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æç”» -->
        </div>
    </div>
    
    <!-- ã‹ã‚“ã°ã‚“ãƒ“ãƒ¥ãƒ¼ -->
    <div class="view-content" id="kanbanView" style="display: none;">
        <div class="kanban-board">
            <div class="kanban-column" data-status="scheduled">
                <div class="kanban-header">
                    <h3 class="kanban-title">äºˆå®š</h3>
                    <span class="kanban-count">8</span>
                </div>
                <div class="kanban-cards" id="scheduledCards">
                    <div class="kanban-card" draggable="true" data-id="meeting1">
                        <div class="kanban-card-header">
                            <span class="meeting-type institutional">æ©Ÿé–¢æŠ•è³‡å®¶</span>
                            <span class="meeting-priority high">é«˜</span>
                        </div>
                        <h4 class="kanban-card-title">é‡æ‘ã‚¢ã‚»ãƒƒãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ§˜</h4>
                        <p class="kanban-card-desc">Q3æ±ºç®—èª¬æ˜ãƒ»ä¸­æœŸçµŒå–¶è¨ˆç”»ã«ã¤ã„ã¦</p>
                        <div class="kanban-card-footer">
                            <span class="meeting-date">3æœˆ15æ—¥ 14:00</span>
                            <div class="meeting-participants">
                                <span class="participant-avatar">å±±</span>
                                <span class="participant-avatar">ç”°</span>
                                <span class="participant-more">+2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="kanban-card" draggable="true" data-id="meeting2">
                        <div class="kanban-card-header">
                            <span class="meeting-type overseas">æµ·å¤–æŠ•è³‡å®¶</span>
                            <span class="meeting-priority medium">ä¸­</span>
                        </div>
                        <h4 class="kanban-card-title">BlackRock Inc.</h4>
                        <p class="kanban-card-desc">ESGæˆ¦ç•¥ã«é–¢ã™ã‚‹è¿½åŠ èª¬æ˜</p>
                        <div class="kanban-card-footer">
                            <span class="meeting-date">3æœˆ16æ—¥ 10:00</span>
                            <div class="meeting-participants">
                                <span class="participant-avatar">éˆ´</span>
                                <span class="participant-avatar">ä½</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="kanban-column" data-status="processing">
                <div class="kanban-header">
                    <h3 class="kanban-title">å‡¦ç†ä¸­</h3>
                    <span class="kanban-count">3</span>
                </div>
                <div class="kanban-cards" id="processingCards">
                    <div class="kanban-card processing" draggable="true" data-id="meeting3">
                        <div class="processing-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%;"></div>
                            </div>
                            <span class="progress-text">æ–‡å­—èµ·ã“ã—ä¸­...</span>
                        </div>
                        <h4 class="kanban-card-title">ä¸‰è±UFJä¿¡è¨—éŠ€è¡Œæ§˜</h4>
                        <p class="kanban-card-desc">ã‚¬ãƒãƒŠãƒ³ã‚¹å¼·åŒ–æ–½ç­–ã«ã¤ã„ã¦</p>
                        <div class="kanban-card-footer">
                            <span class="meeting-date">3æœˆ14æ—¥ å®Ÿæ–½</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="kanban-column" data-status="completed">
                <div class="kanban-header">
                    <h3 class="kanban-title">å®Œäº†</h3>
                    <span class="kanban-count">12</span>
                </div>
                <div class="kanban-cards" id="completedCards">
                    <div class="kanban-card completed" draggable="true" data-id="meeting4">
                        <div class="kanban-card-header">
                            <span class="meeting-type analyst">ã‚¢ãƒŠãƒªã‚¹ãƒˆ</span>
                            <span class="completion-badge">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                å…¬é–‹æ¸ˆã¿
                            </span>
                        </div>
                        <h4 class="kanban-card-title">ã¿ãšã»è¨¼åˆ¸æ§˜</h4>
                        <p class="kanban-card-desc">æ¥­ç¸¾è¦‹é€šã—ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ</p>
                        <div class="kanban-card-footer">
                            <span class="meeting-date">3æœˆ13æ—¥ å®Œäº†</span>
                            <button class="view-summary-btn">ã‚µãƒãƒªãƒ¼è¡¨ç¤º</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ–°è¦ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="newMeetingModal" style="display: none;">
    <div class="modal-content large">
        <div class="modal-header">
            <h2>æ–°è¦ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç™»éŒ²</h2>
            <button class="modal-close" onclick="closeNewMeetingModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="newMeetingForm" class="meeting-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" class="form-input" name="title" data-validate="required" placeholder="ä¾‹: é‡æ‘ã‚¢ã‚»ãƒƒãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ§˜ Q3æ±ºç®—èª¬æ˜">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">æŠ•è³‡å®¶å</label>
                        <input type="text" class="form-input" name="investor" data-validate="required" placeholder="æŠ•è³‡å®¶åã‚’å…¥åŠ›">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">æŠ•è³‡å®¶ã‚¿ã‚¤ãƒ—</label>
                        <select class="form-select" name="investorType" data-validate="required">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="institutional">æ©Ÿé–¢æŠ•è³‡å®¶</option>
                            <option value="overseas">æµ·å¤–æŠ•è³‡å®¶</option>
                            <option value="individual">å€‹äººæŠ•è³‡å®¶</option>
                            <option value="analyst">ã‚¢ãƒŠãƒªã‚¹ãƒˆ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">æ—¥æ™‚</label>
                        <input type="datetime-local" class="form-input" name="datetime" data-validate="required">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">å ´æ‰€/å½¢å¼</label>
                        <select class="form-select" name="location">
                            <option value="online">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</option>
                            <option value="office">æœ¬ç¤¾ä¼šè­°å®¤</option>
                            <option value="external">å¤–éƒ¨ä¼šå ´</option>
                            <option value="phone">é›»è©±ä¼šè­°</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">è­°é¡Œ</label>
                    <textarea class="form-textarea" name="agenda" rows="3" placeholder="ä¸»ãªè­°é¡Œã‚’å…¥åŠ›"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å‚åŠ è€…</label>
                    <div class="participant-selector">
                        <input type="text" class="form-input" placeholder="å‚åŠ è€…ã‚’æ¤œç´¢..." id="participantSearch">
                        <div class="selected-participants" id="selectedParticipants"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å‚™è€ƒ</label>
                    <textarea class="form-textarea" name="notes" rows="2" placeholder="ãã®ä»–ã®æƒ…å ±"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeNewMeetingModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ç™»éŒ²</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°çµ±è¨ˆ */
.meeting-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.stat-card {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: var(--space-lg);
    border: 1px solid var(--gray-200);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
}

.stat-card.primary::before { background: var(--info); }
.stat-card.success::before { background: var(--success); }
.stat-card.info::before { background: var(--accent-teal); }
.stat-card.warning::before { background: var(--warning); }

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
}

.stat-icon {
    font-size: 1.5rem;
}

.stat-period {
    font-size: var(--text-sm);
    color: var(--gray-600);
    font-weight: var(--font-medium);
}

.stat-number {
    font-size: var(--text-3xl);
    font-weight: var(--font-bold);
    color: var(--gray-900);
    line-height: 1;
    margin-bottom: var(--space-xs);
}

.stat-label {
    font-size: var(--text-sm);
    color: var(--gray-600);
    margin-bottom: var(--space-sm);
}

.stat-change {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
}

.stat-change.positive { color: var(--success); }
.stat-change.negative { color: var(--error); }

.stat-detail {
    font-size: var(--text-xs);
    color: var(--gray-500);
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.meeting-container {
    background: white;
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

/* ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
.view-controls {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.view-tabs {
    display: flex;
    background: var(--gray-100);
    padding: 2px;
    border-radius: var(--border-radius-md);
}

.view-tab {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-600);
    transition: all var(--transition-fast);
}

.view-tab:hover {
    color: var(--gray-900);
}

.view-tab.active {
    background: white;
    color: var(--gray-900);
    box-shadow: var(--shadow-sm);
}

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ */
.calendar-container {
    padding: var(--space-lg);
}

.calendar-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
}

.calendar-nav {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius-md);
    color: var(--gray-600);
    transition: all var(--transition-fast);
}

.calendar-nav:hover {
    background: var(--gray-100);
    color: var(--gray-900);
}

.calendar-title {
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    margin: 0;
    flex: 1;
    text-align: center;
}

.calendar-controls {
    display: flex;
    gap: var(--space-sm);
}

.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--gray-200);
    border: 1px solid var(--gray-200);
    border-bottom: none;
}

.calendar-weekday {
    background: var(--gray-50);
    padding: var(--space-sm);
    text-align: center;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--gray-200);
    border: 1px solid var(--gray-200);
}

.calendar-day {
    background: white;
    min-height: 120px;
    padding: var(--space-sm);
    position: relative;
}

.calendar-day.other-month {
    background: var(--gray-50);
}

.calendar-day.today {
    background: rgba(20, 184, 166, 0.05);
}

.calendar-day-number {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    margin-bottom: var(--space-xs);
}

.calendar-day.today .calendar-day-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--accent-teal);
    color: white;
    border-radius: var(--border-radius-full);
}

.calendar-meetings {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.calendar-meeting {
    font-size: var(--text-xs);
    padding: 2px 4px;
    border-radius: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    cursor: pointer;
}

.calendar-meeting.institutional { background: rgba(59, 130, 246, 0.1); color: var(--info); }
.calendar-meeting.overseas { background: rgba(139, 92, 246, 0.1); color: #8B5CF6; }
.calendar-meeting.analyst { background: rgba(251, 146, 60, 0.1); color: #FB923C; }

/* ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ */
.meeting-filters {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: flex-end;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.filter-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
}

.filter-select,
.filter-input {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-md);
    font-size: var(--text-sm);
    background: white;
}

.filter-separator {
    align-self: center;
    color: var(--gray-500);
}

.meeting-table-container {
    padding: var(--space-lg);
}

/* ã‹ã‚“ã°ã‚“ãƒ“ãƒ¥ãƒ¼ */
.kanban-board {
    display: flex;
    gap: var(--space-lg);
    padding: var(--space-lg);
    overflow-x: auto;
    min-height: 600px;
}

.kanban-column {
    flex: 1;
    min-width: 300px;
    background: var(--gray-50);
    border-radius: var(--border-radius-lg);
    padding: var(--space-md);
}

.kanban-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
}

.kanban-title {
    font-size: var(--text-md);
    font-weight: var(--font-semibold);
    color: var(--gray-700);
    margin: 0;
}

.kanban-count {
    background: var(--gray-200);
    color: var(--gray-600);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    padding: 2px 8px;
    border-radius: var(--border-radius-full);
}

.kanban-cards {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    min-height: 100px;
}

.kanban-card {
    background: white;
    border-radius: var(--border-radius-md);
    padding: var(--space-md);
    border: 1px solid var(--gray-200);
    cursor: move;
    transition: all var(--transition-fast);
}

.kanban-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.kanban-card.dragging {
    opacity: 0.5;
}

.kanban-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-sm);
}

.meeting-type {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    padding: 2px 8px;
    border-radius: var(--border-radius-sm);
}

.meeting-type.institutional { background: rgba(59, 130, 246, 0.1); color: var(--info); }
.meeting-type.overseas { background: rgba(139, 92, 246, 0.1); color: #8B5CF6; }
.meeting-type.analyst { background: rgba(251, 146, 60, 0.1); color: #FB923C; }

.meeting-priority {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
}

.meeting-priority.high { color: var(--error); }
.meeting-priority.medium { color: var(--warning); }
.meeting-priority.low { color: var(--gray-600); }

.kanban-card-title {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--gray-900);
    margin-bottom: var(--space-xs);
}

.kanban-card-desc {
    font-size: var(--text-xs);
    color: var(--gray-600);
    margin-bottom: var(--space-sm);
}

.kanban-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.meeting-date {
    font-size: var(--text-xs);
    color: var(--gray-500);
}

.meeting-participants {
    display: flex;
    align-items: center;
    gap: -8px;
}

.participant-avatar {
    width: 24px;
    height: 24px;
    background: var(--gray-300);
    color: var(--gray-700);
    border-radius: var(--border-radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    border: 2px solid white;
}

.participant-more {
    margin-left: 4px;
    font-size: var(--text-xs);
    color: var(--gray-600);
}

/* å‡¦ç†ä¸­ã‚«ãƒ¼ãƒ‰ */
.kanban-card.processing {
    border-color: var(--accent-teal);
}

.processing-progress {
    margin-bottom: var(--space-sm);
}

.progress-bar {
    height: 4px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
    margin-bottom: var(--space-xs);
}

.progress-fill {
    height: 100%;
    background: var(--accent-teal);
    transition: width var(--transition-normal);
}

.progress-text {
    font-size: var(--text-xs);
    color: var(--accent-teal);
    font-weight: var(--font-medium);
}

/* å®Œäº†ã‚«ãƒ¼ãƒ‰ */
.completion-badge {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-xs);
    color: var(--success);
    font-weight: var(--font-medium);
}

.view-summary-btn {
    font-size: var(--text-xs);
    color: var(--info);
    text-decoration: underline;
    background: none;
    border: none;
    cursor: pointer;
}

/* ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ  */
.meeting-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-md);
}

.participant-selector {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.selected-participants {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
}

.participant-tag {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    background: var(--gray-100);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
}

.participant-tag button {
    color: var(--gray-600);
    font-size: var(--text-xs);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 1024px) {
    .meeting-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .kanban-board {
        padding: var(--space-md);
    }
    
    .kanban-column {
        min-width: 280px;
    }
}

@media (max-width: 768px) {
    .meeting-stats {
        grid-template-columns: 1fr;
    }
    
    .view-controls {
        flex-direction: column;
        gap: var(--space-md);
        align-items: stretch;
    }
    
    .view-tabs {
        width: 100%;
    }
    
    .meeting-filters {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-group {
        width: 100%;
    }
    
    .calendar-weekdays,
    .calendar-days {
        font-size: var(--text-xs);
    }
    
    .calendar-day {
        min-height: 80px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
    const viewTabs = document.querySelectorAll('.view-tab');
    const viewContents = document.querySelectorAll('.view-content');
    
    viewTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetView = tab.dataset.view;
            
            // ã‚¿ãƒ–ã®çŠ¶æ…‹æ›´æ–°
            viewTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            viewContents.forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(targetView + 'View').style.display = 'block';
            
            // ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯DataTableã‚’åˆæœŸåŒ–
            if (targetView === 'list') {
                initializeMeetingTable();
            }
        });
    });
    
    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆæœŸåŒ–
    initializeCalendar();
    
    // ã‹ã‚“ã°ã‚“ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
    initializeKanban();
    
    // æ–°è¦ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ«
    document.getElementById('newMeetingBtn').addEventListener('click', () => {
        document.getElementById('newMeetingModal').style.display = 'flex';
        initializeForm();
    });
    
    // DataTableåˆæœŸåŒ–
    function initializeMeetingTable() {
        if (!window.meetingTableInstance) {
            window.meetingTableInstance = new DataTable('#meetingTableContainer', {
                columns: [
                    {
                        key: 'status',
                        label: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
                        render: (value) => {
                            const statusMap = {
                                scheduled: { label: 'äºˆå®š', class: 'info' },
                                processing: { label: 'å‡¦ç†ä¸­', class: 'warning' },
                                completed: { label: 'å®Œäº†', class: 'success' },
                                cancelled: { label: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', class: 'gray' }
                            };
                            const status = statusMap[value] || { label: value, class: 'gray' };
                            return `<span class="status-badge ${status.class}">${status.label}</span>`;
                        }
                    },
                    { key: 'title', label: 'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å' },
                    { key: 'investor', label: 'æŠ•è³‡å®¶' },
                    {
                        key: 'type',
                        label: 'ã‚¿ã‚¤ãƒ—',
                        render: (value) => {
                            const typeMap = {
                                institutional: 'æ©Ÿé–¢æŠ•è³‡å®¶',
                                overseas: 'æµ·å¤–æŠ•è³‡å®¶',
                                analyst: 'ã‚¢ãƒŠãƒªã‚¹ãƒˆ',
                                individual: 'å€‹äººæŠ•è³‡å®¶'
                            };
                            return typeMap[value] || value;
                        }
                    },
                    { key: 'date', label: 'æ—¥æ™‚' },
                    { key: 'duration', label: 'æ™‚é–“' },
                    {
                        key: 'actions',
                        label: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
                        render: (value, row) => {
                            return `
                                <div class="table-actions">
                                    <button class="btn btn-sm btn-secondary">è©³ç´°</button>
                                    ${row.status === 'completed' ? '<button class="btn btn-sm btn-primary">è­°äº‹éŒ²</button>' : ''}
                                </div>
                            `;
                        }
                    }
                ],
                data: generateMockMeetings(),
                pageSize: 15
            });
        }
    }
    
    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆæœŸåŒ–
    function initializeCalendar() {
        const calendarDays = document.getElementById('calendarDays');
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        
        // æœˆã®æœ€åˆã®æ—¥ã¨æœ€å¾Œã®æ—¥ã‚’å–å¾—
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¡¨ç¤ºã™ã‚‹æœ€åˆã®æ—¥ï¼ˆå‰æœˆã®æ—¥æ›œæ—¥ï¼‰
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
        let currentDate = new Date(startDate);
        let daysHtml = '';
        
        while (currentDate <= lastDay || currentDate.getDay() !== 0) {
            const isCurrentMonth = currentDate.getMonth() === month;
            const isToday = currentDate.toDateString() === today.toDateString();
            
            daysHtml += `
                <div class="calendar-day ${!isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}">
                    <div class="calendar-day-number">${currentDate.getDate()}</div>
                    <div class="calendar-meetings">
                        ${generateMeetingsForDate(currentDate)}
                    </div>
                </div>
            `;
            
            currentDate.setDate(currentDate.getDate() + 1);
        }
        
        calendarDays.innerHTML = daysHtml;
    }
    
    // æ—¥ä»˜ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç”Ÿæˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
    function generateMeetingsForDate(date) {
        const meetings = [];
        if (Math.random() > 0.5) {
            const types = ['institutional', 'overseas', 'analyst'];
            const type = types[Math.floor(Math.random() * types.length)];
            meetings.push(`<div class="calendar-meeting ${type}">10:00 é‡æ‘AM</div>`);
        }
        if (Math.random() > 0.7) {
            meetings.push(`<div class="calendar-meeting overseas">14:00 BlackRock</div>`);
        }
        return meetings.join('');
    }
    
    // ã‹ã‚“ã°ã‚“ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
    function initializeKanban() {
        const draggables = document.querySelectorAll('.kanban-card');
        const containers = document.querySelectorAll('.kanban-cards');
        
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('dragging');
            });
            
            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('dragging');
            });
        });
        
        containers.forEach(container => {
            container.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                if (afterElement == null) {
                    container.appendChild(draggable);
                } else {
                    container.insertBefore(draggable, afterElement);
                }
            });
        });
    }
    
    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.kanban-card:not(.dragging)')];
        
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–
    function initializeForm() {
        const form = document.getElementById('newMeetingForm');
        if (!window.meetingFormValidator) {
            window.meetingFormValidator = new FormValidator(form, {
                onSubmit: (data) => {
                    console.log('æ–°è¦ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç™»éŒ²:', data);
                    showNotification('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç™»éŒ²ã—ã¾ã—ãŸ', 'success');
                    closeNewMeetingModal();
                }
            });
        }
    }
    
    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    function generateMockMeetings() {
        const meetings = [];
        const investors = ['é‡æ‘ã‚¢ã‚»ãƒƒãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ', 'ä¸‰è±UFJä¿¡è¨—éŠ€è¡Œ', 'BlackRock', 'ã¿ãšã»è¨¼åˆ¸', 'ã‚´ãƒ¼ãƒ«ãƒ‰ãƒãƒ³ãƒ»ã‚µãƒƒã‚¯ã‚¹'];
        const types = ['institutional', 'overseas', 'analyst', 'individual'];
        const statuses = ['scheduled', 'processing', 'completed', 'cancelled'];
        
        for (let i = 1; i <= 50; i++) {
            meetings.push({
                id: `meeting${i}`,
                status: statuses[Math.floor(Math.random() * statuses.length)],
                title: `${investors[Math.floor(Math.random() * investors.length)]}æ§˜ å®šä¾‹ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°`,
                investor: investors[Math.floor(Math.random() * investors.length)],
                type: types[Math.floor(Math.random() * types.length)],
                date: '2024/03/15 14:00',
                duration: `${30 + Math.floor(Math.random() * 60)}åˆ†`
            });
        }
        
        return meetings;
    }
});

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeNewMeetingModal() {
    document.getElementById('newMeetingModal').style.display = 'none';
    if (window.meetingFormValidator) {
        window.meetingFormValidator.reset();
    }
}
</script>
{% endblock %}