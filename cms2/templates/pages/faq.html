{% extends "base.html" %}

{% block title %}FAQ管理 - {{ super() }}{% endblock %}
{% block page_icon %}❓{% endblock %}
{% block page_title %}FAQ管理{% endblock %}
{% block breadcrumb_current %}FAQ管理{% endblock %}

{% block content %}
<script>
// onclick属性からアクセスできるように、グローバルにKAGAMIオブジェクトを初期化
if (!window.KAGAMI) {
    window.KAGAMI = {
        faq: {
            toggleExpand: function() { console.log('KAGAMI.faq not initialized yet'); },
            showLanguageSettings: function() { console.log('KAGAMI.faq not initialized yet'); },
            trainModel: function() { console.log('KAGAMI.faq not initialized yet'); },
            showAddModal: function() { console.log('KAGAMI.faq not initialized yet'); },
            bulkTranslate: function() { console.log('KAGAMI.faq not initialized yet'); },
            bulkPublish: function() { console.log('KAGAMI.faq not initialized yet'); },
            bulkArchive: function() { console.log('KAGAMI.faq not initialized yet'); },
            edit: function() { console.log('KAGAMI.faq not initialized yet'); },
            improve: function() { console.log('KAGAMI.faq not initialized yet'); },
            archive: function() { console.log('KAGAMI.faq not initialized yet'); },
            editTranslation: function() { console.log('KAGAMI.faq not initialized yet'); },
            autoTranslate: function() { console.log('KAGAMI.faq not initialized yet'); },
            createFromSuggestion: function() { console.log('KAGAMI.faq not initialized yet'); },
            updateSuggestion: function() { console.log('KAGAMI.faq not initialized yet'); },
            closeLanguageSettings: function() { console.log('KAGAMI.faq not initialized yet'); },
            saveLanguageSettings: function() { console.log('KAGAMI.faq not initialized yet'); },
            removeSource: function() { console.log('KAGAMI.faq not initialized yet'); },
            closeSimilarModal: function() { console.log('KAGAMI.faq not initialized yet'); },
            viewFAQ: function() { console.log('KAGAMI.faq not initialized yet'); },
            mergeFAQ: function() { console.log('KAGAMI.faq not initialized yet'); },
            continueEditing: function() { console.log('KAGAMI.faq not initialized yet'); },
            formatText: function() { console.log('KAGAMI.faq not initialized yet'); },
            insertLink: function() { console.log('KAGAMI.faq not initialized yet'); },
            aiImprove: function() { console.log('KAGAMI.faq not initialized yet'); },
            closeEditModal: function() { console.log('KAGAMI.faq not initialized yet'); },
            saveFAQ: function() { console.log('KAGAMI.faq not initialized yet'); },
            saveFAQAndPublish: function() { console.log('KAGAMI.faq not initialized yet'); },
            closeAIImproveModal: function() { console.log('KAGAMI.faq not initialized yet'); },
            applyAIImprovement: function() { console.log('KAGAMI.faq not initialized yet'); },
            getCategoryValue: function() { console.log('KAGAMI.faq not initialized yet'); },
            startAIAnalysis: function() { console.log('KAGAMI.faq not initialized yet'); },
            showAISuggestions: function() { console.log('KAGAMI.faq not initialized yet'); },
            updateAIMetrics: function() { console.log('KAGAMI.faq not initialized yet'); }
        }
    };
}
</script>

<!-- ページヘッダー -->
<div class="page-header">
    <div class="page-header-content">
        <p class="page-description">AIによる自動FAQ生成と管理システム</p>
    </div>
    <div class="page-header-actions">
        <button class="btn btn-secondary" id="languageSettingsBtn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                <path d="M8 1C8 1 5.5 4 5.5 8C5.5 12 8 15 8 15C8 15 10.5 12 10.5 8C10.5 4 8 1 8 1Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 8H15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            言語設定
        </button>
        <button class="btn btn-secondary" id="trainModelBtn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 8V13.3333C4 13.6869 4.14048 14.0261 4.39052 14.2761C4.64057 14.5262 4.97971 14.6667 5.33333 14.6667H10.6667C11.0203 14.6667 11.3594 14.5262 11.6095 14.2761C11.8595 14.0261 12 13.6869 12 13.3333V8M10 4L8 2M8 2L6 4M8 2V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            AIモデル更新
        </button>
        <button class="btn btn-primary" id="showAddModalBtn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 3.33334V12.6667M3.33333 8H12.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            FAQ追加
        </button>
    </div>
</div>

<!-- AI統計ダッシュボード -->
<div class="ai-stats-grid">
    <div class="ai-stat-card">
        <div class="ai-stat-header">
            <span class="ai-stat-icon">🧠</span>
            <span class="ai-stat-label">AI生成FAQ数</span>
        </div>
        <div class="ai-stat-value">1,234</div>
        <div class="ai-stat-chart">
            <canvas id="aiGeneratedChart" width="100" height="40"></canvas>
        </div>
    </div>
    
    <div class="ai-stat-card">
        <div class="ai-stat-header">
            <span class="ai-stat-icon">✅</span>
            <span class="ai-stat-label">回答精度</span>
        </div>
        <div class="ai-stat-value">94.7%</div>
        <div class="ai-progress">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 94.7%"></div>
            </div>
        </div>
    </div>
    
    <div class="ai-stat-card">
        <div class="ai-stat-header">
            <span class="ai-stat-icon">👍</span>
            <span class="ai-stat-label">満足度スコア</span>
        </div>
        <div class="ai-stat-value">4.8<span class="ai-stat-unit">/5</span></div>
        <div class="ai-rating">
            <span class="star filled">★</span>
            <span class="star filled">★</span>
            <span class="star filled">★</span>
            <span class="star filled">★</span>
            <span class="star partial">★</span>
        </div>
    </div>
    
    <div class="ai-stat-card">
        <div class="ai-stat-header">
            <span class="ai-stat-icon">⚡</span>
            <span class="ai-stat-label">平均応答時間</span>
        </div>
        <div class="ai-stat-value">0.8<span class="ai-stat-unit">秒</span></div>
        <div class="ai-stat-comparison">
            <span class="comparison-label">前月比</span>
            <span class="comparison-value positive">-0.2秒</span>
        </div>
    </div>
</div>

<!-- 言語選択 -->
<div class="language-selector">
    <div class="language-tabs">
        <button class="language-tab active" data-lang="ja">
            <span class="flag">🇯🇵</span>
            日本語
            <span class="lang-count">2,456</span>
        </button>
        <button class="language-tab" data-lang="en">
            <span class="flag">🇺🇸</span>
            English
            <span class="lang-count">1,892</span>
        </button>
        <button class="language-tab" data-lang="zh">
            <span class="flag">🇨🇳</span>
            中文
            <span class="lang-count">856</span>
        </button>
        <button class="language-tab" data-lang="ko">
            <span class="flag">🇰🇷</span>
            한국어
            <span class="lang-count">423</span>
        </button>
    </div>
    <div class="language-actions">
        <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.bulkTranslate()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M7.293 2.707A1 1 0 0 1 8 2.414V7h4.586a1 1 0 0 1 .707 1.707l-5 5a1 1 0 0 1-1.414 0l-5-5A1 1 0 0 1 2.586 7H7V2.414a1 1 0 0 1 .293-.707z" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            一括翻訳
        </button>
    </div>
</div>

<!-- FAQカテゴリータブ -->
<div class="faq-tabs">
    <button class="faq-tab active" data-category="all">
        すべて
        <span class="tab-count">2,456</span>
    </button>
    <button class="faq-tab" data-category="financial">
        財務・業績
        <span class="tab-count">823</span>
    </button>
    <button class="faq-tab" data-category="strategy">
        経営戦略
        <span class="tab-count">456</span>
    </button>
    <button class="faq-tab" data-category="esg">
        ESG・サステナビリティ
        <span class="tab-count">387</span>
    </button>
    <button class="faq-tab" data-category="governance">
        ガバナンス
        <span class="tab-count">290</span>
    </button>
    <button class="faq-tab" data-category="other">
        その他
        <span class="tab-count">500</span>
    </button>
</div>

<!-- フィルターとアクション -->
<div class="faq-controls">
    <div class="faq-filters">
        <div class="search-box">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.5 17.5L13.875 13.875M15.8333 9.16667C15.8333 12.8486 12.8486 15.8333 9.16667 15.8333C5.48477 15.8333 2.5 12.8486 2.5 9.16667C2.5 5.48477 5.48477 2.5 9.16667 2.5C12.8486 2.5 15.8333 5.48477 15.8333 9.16667Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input type="search" class="search-input" placeholder="FAQを検索..." id="faqSearch">
        </div>
        
        <select class="filter-select" id="statusFilter">
            <option value="">すべてのステータス</option>
            <option value="published">公開中</option>
            <option value="draft">下書き</option>
            <option value="review">レビュー中</option>
            <option value="archived">アーカイブ</option>
        </select>
        
        <select class="filter-select" id="sourceFilter">
            <option value="">すべてのソース</option>
            <option value="ai">AI生成</option>
            <option value="manual">手動作成</option>
            <option value="meeting">議事録から生成</option>
        </select>
    </div>
    
    <div class="bulk-actions">
        <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.bulkPublish()">
            一括公開
        </button>
        <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.bulkArchive()">
            一括アーカイブ
        </button>
    </div>
</div>

<!-- FAQ一覧 -->
<div class="faq-list">
    <!-- FAQアイテム -->
    <div class="faq-item">
        <div class="faq-item-header">
            <div class="faq-item-info">
                <h3 class="faq-question">2024年度の営業利益率の目標はどの程度ですか？</h3>
                <div class="faq-meta">
                    <span class="faq-category">財務・業績</span>
                    <span class="faq-source ai">AI生成</span>
                    <span class="faq-date">2024/03/15 14:30</span>
                    <span class="faq-views">閲覧数: 1,234</span>
                </div>
            </div>
            <div class="faq-item-actions">
                <div class="translation-status">
                    <span class="translation-badge complete">🇺🇸 翻訳済</span>
                    <span class="translation-badge pending">🇨🇳 未翻訳</span>
                    <span class="translation-badge pending">🇰🇷 未翻訳</span>
                </div>
                <span class="faq-status published">公開中</span>
                <button class="action-btn" onclick="KAGAMI.faq.toggleExpand(this)">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="faq-item-content" style="display: none;">
            <div class="faq-answer">
                <p>2024年度の営業利益率目標は15%以上を設定しています。これは前年度実績の13.8%から約1.2ポイントの改善を目指すもので、主に以下の施策により達成を見込んでいます：</p>
                <ul>
                    <li>生産効率の向上による原価率の改善（0.5ポイント）</li>
                    <li>高付加価値製品へのシフト（0.4ポイント）</li>
                    <li>販管費の最適化（0.3ポイント）</li>
                </ul>
            </div>
            
            <div class="faq-ai-info">
                <div class="ai-confidence">
                    <span class="confidence-label">AI信頼度:</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: 92%"></div>
                    </div>
                    <span class="confidence-value">92%</span>
                </div>
                <div class="ai-sources">
                    <span class="sources-label">参照元:</span>
                    <a href="#" class="source-link">2024年3月期決算説明会資料 P.12</a>
                    <a href="#" class="source-link">中期経営計画 P.8</a>
                </div>
            </div>
            
            <!-- 多言語管理 -->
            <div class="language-management">
                <div class="language-versions">
                    <div class="language-version">
                        <span class="lang-label">🇺🇸 English</span>
                        <span class="lang-status complete">翻訳済</span>
                        <button class="btn btn-xs btn-outline" onclick="KAGAMI.faq.editTranslation(1, 'en')">編集</button>
                    </div>
                    <div class="language-version">
                        <span class="lang-label">🇨🇳 中文</span>
                        <span class="lang-status pending">未翻訳</span>
                        <button class="btn btn-xs btn-primary" onclick="KAGAMI.faq.autoTranslate(1, 'zh')">自動翻訳</button>
                    </div>
                    <div class="language-version">
                        <span class="lang-label">🇰🇷 한국어</span>
                        <span class="lang-status pending">未翻訳</span>
                        <button class="btn btn-xs btn-primary" onclick="KAGAMI.faq.autoTranslate(1, 'ko')">自動翻訳</button>
                    </div>
                </div>
            </div>
            
            <div class="faq-actions">
                <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.edit(1)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.3333 2C11.5084 1.82491 11.7163 1.68601 11.9451 1.59125C12.1739 1.49649 12.4191 1.44772 12.6667 1.44772C12.9142 1.44772 13.1594 1.49649 13.3882 1.59125C13.617 1.68601 13.8249 1.82491 14 2C14.1751 2.1751 14.314 2.38297 14.4088 2.61178C14.5035 2.84059 14.5523 3.08582 14.5523 3.33333C14.5523 3.58085 14.5035 3.82608 14.4088 4.05489C14.314 4.2837 14.1751 4.49157 14 4.66667L5 13.6667L2 14.6667L3 11.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    編集
                </button>
                <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.improve(1)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 2L9.73205 6.47109L14.596 6.87336L11.0359 10.0289L12.1353 14.7933L8 12.3L3.86474 14.7933L4.96415 10.0289L1.40402 6.87336L6.26795 6.47109L8 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    AI改善
                </button>
                <button class="btn btn-sm btn-outline danger" onclick="KAGAMI.faq.archive(1)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 5.33333H14M2 5.33333V13.3333C2 13.6869 2.14048 14.0261 2.39052 14.2761C2.64057 14.5262 2.97971 14.6667 3.33333 14.6667H12.6667C13.0203 14.6667 13.3594 14.5262 13.6095 14.2761C13.8595 14.0261 14 13.6869 14 13.3333V5.33333M4.66667 5.33333V3.33333C4.66667 2.97971 4.80714 2.64057 5.05719 2.39052C5.30724 2.14048 5.64638 2 6 2H10C10.3536 2 10.6928 2.14048 10.9428 2.39052C11.1929 2.64057 11.3333 2.97971 11.3333 3.33333V5.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    アーカイブ
                </button>
            </div>
        </div>
    </div>
    
    <!-- 追加のFAQアイテム -->
    <div class="faq-item">
        <div class="faq-item-header">
            <div class="faq-item-info">
                <h3 class="faq-question">ESG投資に対する取り組みについて教えてください</h3>
                <div class="faq-meta">
                    <span class="faq-category">ESG・サステナビリティ</span>
                    <span class="faq-source meeting">議事録から生成</span>
                    <span class="faq-date">2024/03/14 10:15</span>
                    <span class="faq-views">閲覧数: 892</span>
                </div>
            </div>
            <div class="faq-item-actions">
                <span class="faq-status review">レビュー中</span>
                <button class="action-btn" onclick="KAGAMI.faq.toggleExpand(this)">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <div class="faq-item">
        <div class="faq-item-header">
            <div class="faq-item-info">
                <h3 class="faq-question">配当政策と株主還元の方針について</h3>
                <div class="faq-meta">
                    <span class="faq-category">財務・業績</span>
                    <span class="faq-source manual">手動作成</span>
                    <span class="faq-date">2024/03/10 16:45</span>
                    <span class="faq-views">閲覧数: 2,341</span>
                </div>
            </div>
            <div class="faq-item-actions">
                <span class="faq-status published">公開中</span>
                <button class="action-btn" onclick="KAGAMI.faq.toggleExpand(this)">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- AI提案セクション -->
<div class="ai-suggestions">
    <h2 class="suggestions-title">
        <span class="suggestions-icon">💡</span>
        AIからの提案
    </h2>
    <div class="suggestions-list">
        <div class="suggestion-item">
            <div class="suggestion-content">
                <p class="suggestion-text">最近の投資家面談で「DX戦略」に関する質問が増えています。FAQの追加を推奨します。</p>
                <div class="suggestion-meta">
                    <span class="suggestion-frequency">過去7日間で12回言及</span>
                    <span class="suggestion-confidence">推奨度: 高</span>
                </div>
            </div>
            <button class="btn btn-sm btn-primary" onclick="KAGAMI.faq.createFromSuggestion(1)">
                FAQ作成
            </button>
        </div>
        
        <div class="suggestion-item">
            <div class="suggestion-content">
                <p class="suggestion-text">「2025年度の設備投資計画」のFAQが古くなっています。最新情報での更新を推奨します。</p>
                <div class="suggestion-meta">
                    <span class="suggestion-frequency">FAQ ID: #234</span>
                    <span class="suggestion-confidence">推奨度: 中</span>
                </div>
            </div>
            <button class="btn btn-sm btn-secondary" onclick="KAGAMI.faq.updateSuggestion(234)">
                更新する
            </button>
        </div>
    </div>
</div>

<!-- FAQ編集モーダル -->
<div class="modal-wrapper" id="faqEditModal" style="opacity: 0; visibility: hidden;">
    <div class="modal-backdrop" onclick="KAGAMI.faq.closeEditModal()"></div>
    <div class="modal modal-large">
        <button class="modal-close" onclick="KAGAMI.faq.closeEditModal()">×</button>
        <div class="modal-header">
            <h2 class="modal-title">FAQ編集</h2>
        </div>
        <div class="modal-body">
            <form id="faqEditForm" class="modal-form">
                <input type="hidden" id="faqId" value="">
                
                <div class="form-group">
                    <label class="form-label required">質問</label>
                    <textarea class="form-input" id="faqQuestion" rows="3" placeholder="投資家からの質問を入力してください" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">カテゴリ</label>
                        <select class="form-select" id="faqCategory" required>
                            <option value="">カテゴリを選択</option>
                            <option value="financial">財務・業績</option>
                            <option value="strategy">経営戦略</option>
                            <option value="esg">ESG・サステナビリティ</option>
                            <option value="governance">ガバナンス</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">ステータス</label>
                        <select class="form-select" id="faqStatus" required>
                            <option value="draft">下書き</option>
                            <option value="review">レビュー中</option>
                            <option value="published">公開中</option>
                            <option value="archived">アーカイブ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">回答</label>
                    <div class="editor-toolbar">
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('bold')" title="太字">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('italic')" title="斜体">
                            <em>I</em>
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('underline')" title="下線">
                            <u>U</u>
                        </button>
                        <span class="editor-separator"></span>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('bulletList')" title="箇条書き">
                            • ―
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('numberList')" title="番号付きリスト">
                            1. ―
                        </button>
                        <span class="editor-separator"></span>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.insertLink()" title="リンク">
                            🔗
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.aiImprove()" title="AI改善">
                            ✨ AI改善
                        </button>
                    </div>
                    <textarea class="form-input editor-content" id="faqAnswer" rows="10" placeholder="回答を入力してください" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">参照元・ソース</label>
                    <div class="source-list" id="sourceList">
                        <div class="source-item">
                            <input type="text" class="form-input" placeholder="例：2024年3月期決算説明会資料 P.12">
                            <button type="button" class="btn btn-sm btn-outline" onclick="KAGAMI.faq.removeSource(this)">削除</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="KAGAMI.faq.addSource()">+ ソース追加</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">タグ</label>
                    <input type="text" class="form-input" id="faqTags" placeholder="タグをカンマ区切りで入力（例：決算, Q3, 業績予想）">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="KAGAMI.faq.closeEditModal()">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="KAGAMI.faq.saveFAQ()">保存</button>
            <button type="button" class="btn btn-primary" onclick="KAGAMI.faq.saveFAQAndPublish()">保存して公開</button>
        </div>
    </div>
</div>

<!-- AI改善モーダル -->
<div class="modal-wrapper" id="aiImproveModal" style="opacity: 0; visibility: hidden;">
    <div class="modal-backdrop" onclick="KAGAMI.faq.closeAIImproveModal()"></div>
    <div class="modal modal-large">
        <button class="modal-close" onclick="KAGAMI.faq.closeAIImproveModal()">×</button>
        <div class="modal-header">
            <h2 class="modal-title">AI改善提案</h2>
        </div>
        <div class="modal-body">
            <div class="ai-improve-content">
                <div class="current-faq">
                    <h3>現在のFAQ</h3>
                    <div class="faq-preview">
                        <h4 id="aiImproveQuestion">質問がここに表示されます</h4>
                        <p id="aiImproveAnswer">回答がここに表示されます</p>
                    </div>
                </div>
                
                <div class="ai-suggestions">
                    <h3>AI改善提案</h3>
                    <div class="suggestion-tabs">
                        <button class="suggestion-tab active" data-type="clarity">明確性の向上</button>
                        <button class="suggestion-tab" data-type="completeness">完全性の向上</button>
                        <button class="suggestion-tab" data-type="tone">トーンの調整</button>
                        <button class="suggestion-tab" data-type="structure">構造の改善</button>
                    </div>
                    
                    <div class="suggestion-content" id="suggestionContent">
                        <div class="loading-spinner">AI分析中...</div>
                    </div>
                    
                    <div class="ai-metrics">
                        <div class="metric-item">
                            <span class="metric-label">読みやすさスコア</span>
                            <div class="metric-bar">
                                <div class="metric-fill" style="width: 0%;"></div>
                            </div>
                            <span class="metric-value">0/100</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">専門性スコア</span>
                            <div class="metric-bar">
                                <div class="metric-fill" style="width: 0%;"></div>
                            </div>
                            <span class="metric-value">0/100</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">完全性スコア</span>
                            <div class="metric-bar">
                                <div class="metric-fill" style="width: 0%;"></div>
                            </div>
                            <span class="metric-value">0/100</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="KAGAMI.faq.closeAIImproveModal()">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="KAGAMI.faq.applyAIImprovement()">改善を適用</button>
        </div>
    </div>
</div>

<!-- 多言語設定モーダル -->
<div class="modal-wrapper" id="languageSettingsModal" style="opacity: 0; visibility: hidden;">
    <div class="modal-backdrop" onclick="KAGAMI.faq.closeLanguageSettings()"></div>
    <div class="modal modal-large">
        <button class="modal-close" onclick="KAGAMI.faq.closeLanguageSettings()">×</button>
        <div class="modal-header">
            <h2 class="modal-title">多言語コンテンツ管理設定</h2>
        </div>
        <div class="modal-body">
            <div class="language-settings-grid">
                <div class="settings-section">
                    <h3>サポート言語</h3>
                    <div class="supported-languages">
                        <div class="language-item">
                            <input type="checkbox" id="lang_ja" checked disabled>
                            <label for="lang_ja">
                                <span class="flag">🇯🇵</span>
                                日本語（プライマリ）
                            </label>
                        </div>
                        <div class="language-item">
                            <input type="checkbox" id="lang_en" checked>
                            <label for="lang_en">
                                <span class="flag">🇺🇸</span>
                                English
                            </label>
                        </div>
                        <div class="language-item">
                            <input type="checkbox" id="lang_zh" checked>
                            <label for="lang_zh">
                                <span class="flag">🇨🇳</span>
                                中文
                            </label>
                        </div>
                        <div class="language-item">
                            <input type="checkbox" id="lang_ko" checked>
                            <label for="lang_ko">
                                <span class="flag">🇰🇷</span>
                                한국어
                            </label>
                        </div>
                        <div class="language-item">
                            <input type="checkbox" id="lang_es">
                            <label for="lang_es">
                                <span class="flag">🇪🇸</span>
                                Español
                            </label>
                        </div>
                        <div class="language-item">
                            <input type="checkbox" id="lang_fr">
                            <label for="lang_fr">
                                <span class="flag">🇫🇷</span>
                                Français
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>自動翻訳設定</h3>
                    <div class="translation-settings">
                        <div class="setting-item">
                            <label class="setting-label">翻訳エンジン</label>
                            <select class="form-select">
                                <option>Google Translate API</option>
                                <option>DeepL API</option>
                                <option>Microsoft Translator</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">翻訳品質</label>
                            <select class="form-select">
                                <option>高品質（手動レビュー必須）</option>
                                <option selected>標準（自動公開可）</option>
                                <option>簡易（ドラフトのみ）</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label class="toggle-label">
                                <input type="checkbox" checked>
                                <span class="toggle"></span>
                                新規FAQの自動翻訳
                            </label>
                        </div>
                        <div class="setting-item">
                            <label class="toggle-label">
                                <input type="checkbox">
                                <span class="toggle"></span>
                                更新時の自動同期
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section full-width">
                    <h3>翻訳統計</h3>
                    <div class="translation-stats">
                        <div class="stat-item">
                            <div class="stat-value">2,456</div>
                            <div class="stat-label">総FAQ数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">1,892</div>
                            <div class="stat-label">英語翻訳済</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">856</div>
                            <div class="stat-label">中国語翻訳済</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">423</div>
                            <div class="stat-label">韓国語翻訳済</div>
                        </div>
                    </div>
                    <div class="progress-overview">
                        <div class="progress-item">
                            <div class="progress-header">
                                <span>英語翻訳進捗</span>
                                <span>77%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 77%"></div>
                            </div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-header">
                                <span>中国語翻訳進捗</span>
                                <span>35%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 35%"></div>
                            </div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-header">
                                <span>韓国語翻訳進捗</span>
                                <span>17%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 17%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="KAGAMI.faq.closeLanguageSettings()">キャンセル</button>
            <button class="btn btn-primary" onclick="KAGAMI.faq.saveLanguageSettings()">設定を保存</button>
        </div>
    </div>
</div>

<!-- FAQ編集モーダル -->
<div class="modal" id="faqEditModal" style="display: none;">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h2>FAQ編集</h2>
            <button class="modal-close" onclick="KAGAMI.faq.closeEditModal()">×</button>
        </div>
        <div class="modal-body">
            <form id="faqEditForm">
                <input type="hidden" id="faqId" value="">
                
                <div class="form-group">
                    <label class="form-label required">質問</label>
                    <textarea class="form-input" id="faqQuestion" rows="3" placeholder="投資家からの質問を入力してください" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">カテゴリ</label>
                        <select class="form-select" id="faqCategory" required>
                            <option value="">カテゴリを選択</option>
                            <option value="financial">財務・業績</option>
                            <option value="strategy">経営戦略</option>
                            <option value="esg">ESG・サステナビリティ</option>
                            <option value="governance">ガバナンス</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">ステータス</label>
                        <select class="form-select" id="faqStatus" required>
                            <option value="draft">下書き</option>
                            <option value="review">レビュー中</option>
                            <option value="published">公開中</option>
                            <option value="archived">アーカイブ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">回答</label>
                    <div class="editor-toolbar">
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('bold')" title="太字">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('italic')" title="斜体">
                            <em>I</em>
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('underline')" title="下線">
                            <u>U</u>
                        </button>
                        <span class="editor-separator"></span>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('bulletList')" title="箇条書き">
                            • ―
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.formatText('numberList')" title="番号付きリスト">
                            1. ―
                        </button>
                        <span class="editor-separator"></span>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.insertLink()" title="リンク">
                            🔗
                        </button>
                        <button type="button" class="editor-btn" onclick="KAGAMI.faq.aiImprove()" title="AI改善">
                            ✨ AI改善
                        </button>
                    </div>
                    <textarea class="form-input editor-content" id="faqAnswer" rows="10" placeholder="回答を入力してください" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">参照元・ソース</label>
                    <div class="source-list" id="sourceList">
                        <div class="source-item">
                            <input type="text" class="form-input" placeholder="例：2024年3月期決算説明会資料 P.12">
                            <button type="button" class="btn btn-sm btn-outline" onclick="KAGAMI.faq.removeSource(this)">削除</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="KAGAMI.faq.addSource()">+ ソース追加</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">タグ</label>
                    <input type="text" class="form-input" id="faqTags" placeholder="タグをカンマ区切りで入力（例：決算, Q3, 業績予想）">
                </div>
                
                <!-- AI情報 -->
                <div class="ai-edit-info">
                    <h4>AI分析情報</h4>
                    <div class="ai-metrics">
                        <div class="ai-metric">
                            <span class="metric-label">類似FAQ検出</span>
                            <span class="metric-value">3件の類似FAQが見つかりました</span>
                            <button type="button" class="btn btn-xs btn-outline" onclick="KAGAMI.faq.showSimilar()">確認</button>
                        </div>
                        <div class="ai-metric">
                            <span class="metric-label">回答品質スコア</span>
                            <div class="quality-score">
                                <div class="score-bar">
                                    <div class="score-fill" style="width: 85%;"></div>
                                </div>
                                <span class="score-text">85/100</span>
                            </div>
                        </div>
                        <div class="ai-metric">
                            <span class="metric-label">推奨改善点</span>
                            <ul class="improvement-list">
                                <li>数値の根拠となる資料を追加することを推奨</li>
                                <li>専門用語に説明を追加</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="KAGAMI.faq.closeEditModal()">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="KAGAMI.faq.saveFAQ()">保存</button>
            <button type="button" class="btn btn-primary" onclick="KAGAMI.faq.saveFAQAndPublish()">保存して公開</button>
        </div>
    </div>
</div>

<!-- 類似FAQ確認モーダル -->
<div class="modal" id="similarFAQModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>類似FAQ</h2>
            <button class="modal-close" onclick="KAGAMI.faq.closeSimilarModal()">×</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">以下の類似FAQが見つかりました。重複を避けるため、既存のFAQの更新も検討してください。</p>
            <div class="similar-faq-list">
                <div class="similar-faq-item">
                    <div class="similarity-score">類似度: 92%</div>
                    <h4>2024年度の売上高目標について教えてください</h4>
                    <p>2024年度の売上高目標は前年比15%増の1,500億円を計画しています...</p>
                    <div class="similar-actions">
                        <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.viewFAQ(123)">詳細を見る</button>
                        <button class="btn btn-sm btn-primary" onclick="KAGAMI.faq.mergeFAQ(123)">統合する</button>
                    </div>
                </div>
                <div class="similar-faq-item">
                    <div class="similarity-score">類似度: 78%</div>
                    <h4>中期経営計画の売上目標は？</h4>
                    <p>中期経営計画では、2026年度までに売上高2,000億円を目指しています...</p>
                    <div class="similar-actions">
                        <button class="btn btn-sm btn-outline" onclick="KAGAMI.faq.viewFAQ(124)">詳細を見る</button>
                        <button class="btn btn-sm btn-primary" onclick="KAGAMI.faq.mergeFAQ(124)">統合する</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="KAGAMI.faq.closeSimilarModal()">閉じる</button>
            <button class="btn btn-primary" onclick="KAGAMI.faq.continueEditing()">新規FAQとして続行</button>
        </div>
    </div>
</div>

<style>
/* ページヘッダー */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xl);
}

.page-description {
    color: var(--gray-600);
    font-size: var(--text-sm);
}

.page-header-actions {
    display: flex;
    gap: var(--space-sm);
}

/* AI統計グリッド */
.ai-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.ai-stat-card {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: var(--space-lg);
    border: 1px solid var(--gray-200);
    transition: all var(--transition-fast);
}

.ai-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.ai-stat-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
}

.ai-stat-icon {
    font-size: 1.5rem;
}

.ai-stat-label {
    font-size: var(--text-sm);
    color: var(--gray-600);
    font-weight: var(--font-medium);
}

.ai-stat-value {
    font-size: var(--text-3xl);
    font-weight: var(--font-bold);
    color: var(--gray-900);
    margin-bottom: var(--space-md);
}

.ai-stat-unit {
    font-size: var(--text-lg);
    font-weight: var(--font-normal);
    color: var(--gray-600);
}

.ai-stat-chart {
    height: 40px;
    position: relative;
}

.ai-progress {
    margin-top: var(--space-sm);
}

.progress-bar {
    height: 8px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-teal), var(--info));
    transition: width var(--transition-normal);
}

.ai-rating {
    display: flex;
    gap: 2px;
    font-size: 1.25rem;
}

.star {
    color: var(--gray-300);
}

.star.filled {
    color: #fbbf24;
}

.star.partial {
    background: linear-gradient(90deg, #fbbf24 80%, var(--gray-300) 80%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.ai-stat-comparison {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--text-sm);
}

.comparison-label {
    color: var(--gray-600);
}

.comparison-value {
    font-weight: var(--font-medium);
}

.comparison-value.positive {
    color: var(--success);
}

.comparison-value.negative {
    color: var(--error);
}

/* FAQタブ */
.faq-tabs {
    display: flex;
    gap: var(--space-xs);
    border-bottom: 2px solid var(--gray-200);
    margin-bottom: var(--space-lg);
    overflow-x: auto;
}

.faq-tab {
    padding: var(--space-sm) var(--space-md);
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-600);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    white-space: nowrap;
}

.faq-tab:hover {
    color: var(--gray-900);
    background: var(--gray-50);
}

.faq-tab.active {
    color: var(--accent-teal);
    border-bottom-color: var(--accent-teal);
}

.tab-count {
    padding: 2px 8px;
    background: var(--gray-100);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
}

.faq-tab.active .tab-count {
    background: rgba(20, 184, 166, 0.1);
    color: var(--accent-teal);
}

/* FAQコントロール */
.faq-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
}

.faq-filters {
    display: flex;
    gap: var(--space-md);
    flex: 1;
}

.bulk-actions {
    display: flex;
    gap: var(--space-sm);
}

/* FAQ一覧 */
.faq-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    margin-bottom: var(--space-xl);
}

.faq-item {
    background: white;
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
    transition: all var(--transition-fast);
}

.faq-item:hover {
    border-color: var(--gray-300);
    box-shadow: var(--shadow-sm);
}

.faq-item-header {
    padding: var(--space-lg);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-md);
}

.faq-item-info {
    flex: 1;
}

.faq-question {
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.faq-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    font-size: var(--text-sm);
    color: var(--gray-600);
}

.faq-category {
    padding: 2px 8px;
    background: var(--gray-100);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-xs);
}

.faq-source {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.faq-source::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--gray-400);
}

.faq-source.ai::before {
    background: var(--info);
}

.faq-source.meeting::before {
    background: var(--accent-teal);
}

.faq-source.manual::before {
    background: var(--warning);
}

.faq-item-actions {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.faq-status {
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
}

.faq-status.published {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.faq-status.draft {
    background: rgba(107, 114, 128, 0.1);
    color: var(--gray-600);
}

.faq-status.review {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.action-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: var(--border-radius-md);
    color: var(--gray-600);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.action-btn:hover {
    background: var(--gray-100);
    color: var(--gray-900);
}

.faq-item-content {
    padding: 0 var(--space-lg) var(--space-lg);
    border-top: 1px solid var(--gray-200);
}

.faq-answer {
    padding: var(--space-lg) 0;
    color: var(--gray-700);
    line-height: var(--leading-relaxed);
}

.faq-answer ul {
    margin-top: var(--space-sm);
    padding-left: var(--space-lg);
}

.faq-ai-info {
    display: flex;
    gap: var(--space-xl);
    padding: var(--space-md);
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
    margin-bottom: var(--space-md);
}

.ai-confidence {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.confidence-label,
.sources-label {
    font-size: var(--text-sm);
    color: var(--gray-600);
    font-weight: var(--font-medium);
}

.confidence-bar {
    width: 100px;
    height: 6px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-teal), var(--info));
}

.confidence-value {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--gray-900);
}

.ai-sources {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
}

.source-link {
    font-size: var(--text-sm);
    color: var(--info);
    text-decoration: none;
}

.source-link:hover {
    text-decoration: underline;
}

.faq-actions {
    display: flex;
    gap: var(--space-sm);
}

.btn.danger {
    color: var(--error);
    border-color: var(--error);
}

.btn.danger:hover {
    background: rgba(239, 68, 68, 0.05);
}

/* AI提案セクション */
.ai-suggestions {
    background: linear-gradient(135deg, rgba(20, 184, 166, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
    border-radius: var(--border-radius-xl);
    padding: var(--space-xl);
    border: 1px solid rgba(20, 184, 166, 0.2);
}

.suggestions-title {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    color: var(--gray-900);
    margin-bottom: var(--space-lg);
}

.suggestions-icon {
    font-size: 1.5rem;
}

.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

.suggestion-item {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: var(--space-md);
    border: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
}

.suggestion-content {
    flex: 1;
}

.suggestion-text {
    font-size: var(--text-sm);
    color: var(--gray-700);
    margin-bottom: var(--space-sm);
}

.suggestion-meta {
    display: flex;
    gap: var(--space-md);
    font-size: var(--text-xs);
    color: var(--gray-600);
}

/* 言語セレクター */
.language-selector {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--gray-50);
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--border-radius-lg);
    margin-bottom: var(--space-lg);
}

.language-tabs {
    display: flex;
    gap: var(--space-sm);
}

.language-tab {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    background: white;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-md);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.language-tab:hover {
    background: var(--gray-100);
    border-color: var(--gray-400);
}

.language-tab.active {
    background: var(--accent-teal);
    color: white;
    border-color: var(--accent-teal);
}

.flag {
    font-size: 1.2em;
}

.lang-count {
    padding: 2px 6px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
}

.language-tab.active .lang-count {
    background: rgba(255, 255, 255, 0.3);
}

.language-actions {
    display: flex;
    gap: var(--space-sm);
}

/* 翻訳ステータス */
.translation-status {
    display: flex;
    gap: var(--space-xs);
    margin-right: var(--space-md);
}

.translation-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
}

.translation-badge.complete {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.translation-badge.pending {
    background: rgba(107, 114, 128, 0.1);
    color: var(--gray-600);
}

.translation-badge.reviewing {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

/* 多言語管理 */
.language-management {
    padding: var(--space-md);
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
    margin-bottom: var(--space-md);
}

.language-versions {
    display: grid;
    gap: var(--space-sm);
}

.language-version {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-sm);
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-sm);
}

.lang-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
    min-width: 120px;
}

.lang-status {
    font-size: var(--text-xs);
    padding: 2px 8px;
    border-radius: var(--border-radius-full);
}

.lang-status.complete {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.lang-status.pending {
    background: rgba(107, 114, 128, 0.1);
    color: var(--gray-600);
}

.lang-status.reviewing {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.btn-xs {
    padding: 2px 8px;
    font-size: var(--text-xs);
}

/* 多言語設定モーダル */
.language-settings-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
}

.settings-section {
    background: var(--gray-50);
    padding: var(--space-lg);
    border-radius: var(--border-radius-md);
}

.settings-section.full-width {
    grid-column: 1 / -1;
}

.settings-section h3 {
    margin-bottom: var(--space-md);
    color: var(--gray-700);
    font-size: var(--text-lg);
}

.supported-languages {
    display: grid;
    gap: var(--space-sm);
}

.language-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.language-item label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    cursor: pointer;
    font-size: var(--text-sm);
}

.translation-settings {
    display: grid;
    gap: var(--space-md);
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.setting-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
}

.form-select {
    padding: var(--space-sm);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-sm);
    background: white;
    font-size: var(--text-sm);
}

.toggle-label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    cursor: pointer;
    font-size: var(--text-sm);
}

.toggle {
    position: relative;
    width: 44px;
    height: 24px;
    background: var(--gray-300);
    border-radius: var(--border-radius-full);
    transition: all var(--transition-fast);
}

.toggle::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: var(--border-radius-full);
    transition: all var(--transition-fast);
}

.toggle-label input:checked + .toggle {
    background: var(--accent-teal);
}

.toggle-label input:checked + .toggle::after {
    left: 22px;
}

.toggle-label input {
    display: none;
}

.translation-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.translation-stats .stat-item {
    text-align: center;
}

.translation-stats .stat-value {
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--accent-teal);
    margin-bottom: var(--space-xs);
}

.translation-stats .stat-label {
    font-size: var(--text-sm);
    color: var(--gray-600);
}

.progress-overview {
    display: grid;
    gap: var(--space-md);
}

.progress-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.progress-header {
    display: flex;
    justify-content: space-between;
    font-size: var(--text-sm);
    color: var(--gray-700);
}

/* フォームスタイル */
.form-group {
    margin-bottom: var(--space-md);
}

.form-group label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
    margin-bottom: var(--space-xs);
}

.form-control {
    width: 100%;
    padding: var(--space-sm);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    transition: border-color var(--transition-fast);
}

.form-control:focus {
    outline: none;
    border-color: var(--accent-teal);
    box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
}

.form-control textarea {
    resize: vertical;
    min-height: 80px;
}

/* アコーディオンアニメーション */
.faq-item-content {
    transition: all var(--transition-normal);
    overflow: hidden;
}

.faq-item.expanded .action-btn svg {
    transform: rotate(180deg);
}

.action-btn svg {
    transition: transform var(--transition-fast);
}

/* FAQ編集モーダル */
.editor-toolbar {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm);
    background: var(--gray-50);
    border: 1px solid var(--gray-300);
    border-bottom: none;
    border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
}

.editor-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.editor-btn:hover {
    background: var(--gray-100);
    border-color: var(--gray-400);
}

.editor-btn:active {
    background: var(--gray-200);
}

.editor-separator {
    width: 1px;
    height: 20px;
    background: var(--gray-300);
    margin: 0 var(--space-xs);
}

.editor-content {
    border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
    border-top: none;
}

.source-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
}

.source-item {
    display: flex;
    gap: var(--space-sm);
    align-items: center;
}

.source-item .form-input {
    flex: 1;
}

.ai-edit-info {
    background: linear-gradient(135deg, rgba(20, 184, 166, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
    border: 1px solid rgba(20, 184, 166, 0.2);
    border-radius: var(--border-radius-md);
    padding: var(--space-lg);
    margin-top: var(--space-lg);
}

.ai-edit-info h4 {
    margin-bottom: var(--space-md);
    color: var(--gray-700);
    font-size: var(--text-md);
}

.ai-metrics {
    display: grid;
    gap: var(--space-md);
}

.ai-metric {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-sm);
    background: white;
    border-radius: var(--border-radius-sm);
}

.metric-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-600);
    min-width: 120px;
}

.metric-value {
    flex: 1;
    font-size: var(--text-sm);
    color: var(--gray-700);
}

.quality-score {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex: 1;
}

.quality-score .score-bar {
    flex: 1;
    height: 8px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
}

.quality-score .score-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-teal), var(--info));
}

.quality-score .score-text {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--gray-700);
}

.improvement-list {
    margin: 0;
    padding-left: var(--space-lg);
    font-size: var(--text-sm);
    color: var(--gray-600);
}

.improvement-list li {
    margin-bottom: var(--space-xs);
}

/* 類似FAQモーダル */
.modal-description {
    color: var(--gray-600);
    margin-bottom: var(--space-lg);
}

.similar-faq-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

.similar-faq-item {
    padding: var(--space-md);
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
    border: 1px solid var(--gray-200);
}

.similarity-score {
    display: inline-block;
    padding: var(--space-xs) var(--space-sm);
    background: var(--info);
    color: white;
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    border-radius: var(--border-radius-sm);
    margin-bottom: var(--space-sm);
}

.similar-faq-item h4 {
    margin-bottom: var(--space-sm);
    color: var(--gray-900);
    font-size: var(--text-base);
}

.similar-faq-item p {
    color: var(--gray-600);
    font-size: var(--text-sm);
    margin-bottom: var(--space-md);
}

.similar-actions {
    display: flex;
    gap: var(--space-sm);
}

/* フォーム要素の追加スタイル */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-md);
}

.form-group {
    margin-bottom: var(--space-lg);
}

.form-label {
    display: block;
    margin-bottom: var(--space-sm);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-700);
}

.form-label.required::after {
    content: " *";
    color: var(--error);
}

.form-input,
.form-select {
    width: 100%;
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    transition: all var(--transition-fast);
}

.form-input:focus,
.form-select:focus {
    outline: none;
    border-color: var(--accent-teal);
    box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
}

textarea.form-input {
    resize: vertical;
    min-height: 100px;
}

.form-label.required::after {
    content: " *";
    color: var(--error);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-md);
}

/* エディタツールバー */
.editor-toolbar {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm);
    background: var(--gray-50);
    border: 1px solid var(--gray-300);
    border-bottom: none;
    border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
}

.editor-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-sm);
    font-size: var(--text-sm);
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.editor-btn:hover {
    background: var(--gray-100);
    border-color: var(--gray-400);
}

.editor-btn:active {
    background: var(--gray-200);
}

.editor-separator {
    width: 1px;
    height: 20px;
    background: var(--gray-300);
    margin: 0 var(--space-xs);
}

.editor-content {
    border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
    border-top: none;
}

.source-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
}

.source-item {
    display: flex;
    gap: var(--space-sm);
    align-items: center;
}

.source-item .form-input {
    flex: 1;
}

/* z-index値の追加 */
:root {
    --z-dropdown: 1000;
    --z-sticky: 1020;
    --z-fixed: 1030;
    --z-modal-backdrop: 1040;
    --z-modal: 1050;
    --z-popover: 1060;
    --z-tooltip: 1070;
    --z-notification: 1080;
    --z-overlay: 9999;
}

/* AI改善モーダル */
.ai-improve-content {
    display: grid;
    gap: var(--space-xl);
}

.current-faq {
    background: var(--gray-50);
    padding: var(--space-lg);
    border-radius: var(--border-radius-md);
}

.current-faq h3 {
    margin-bottom: var(--space-md);
    color: var(--gray-700);
    font-size: var(--text-lg);
}

.faq-preview {
    background: white;
    padding: var(--space-md);
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--gray-200);
}

.faq-preview h4 {
    margin-bottom: var(--space-sm);
    color: var(--gray-900);
    font-size: var(--text-base);
}

.faq-preview p {
    color: var(--gray-600);
    font-size: var(--text-sm);
    line-height: var(--leading-relaxed);
}

.ai-suggestions h3 {
    margin-bottom: var(--space-md);
    color: var(--gray-700);
    font-size: var(--text-lg);
}

.suggestion-tabs {
    display: flex;
    gap: var(--space-xs);
    margin-bottom: var(--space-lg);
    border-bottom: 2px solid var(--gray-200);
}

.suggestion-tab {
    padding: var(--space-sm) var(--space-md);
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--gray-600);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.suggestion-tab:hover {
    color: var(--gray-900);
}

.suggestion-tab.active {
    color: var(--accent-teal);
    border-bottom-color: var(--accent-teal);
}

.suggestion-content {
    min-height: 200px;
    padding: var(--space-lg);
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
}

.ai-suggestion h4 {
    margin-bottom: var(--space-md);
    color: var(--gray-800);
    font-size: var(--text-md);
}

.ai-suggestion ul {
    margin: var(--space-md) 0;
    padding-left: var(--space-lg);
}

.ai-suggestion li {
    margin-bottom: var(--space-sm);
    color: var(--gray-700);
}

.suggested-text {
    margin-top: var(--space-lg);
    padding: var(--space-md);
    background: white;
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--gray-200);
}

.suggested-text h5 {
    margin-bottom: var(--space-sm);
    color: var(--accent-teal);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
}

.ai-metrics {
    display: grid;
    gap: var(--space-md);
    margin-top: var(--space-lg);
}

.metric-item {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.metric-label {
    font-size: var(--text-sm);
    color: var(--gray-600);
    min-width: 120px;
}

.metric-bar {
    flex: 1;
    height: 8px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
}

.metric-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-teal), var(--info));
    transition: width var(--transition-normal);
}

.metric-value {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--gray-700);
    min-width: 50px;
}

.loading-spinner {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    color: var(--gray-500);
    font-size: var(--text-sm);
}

/* レスポンシブ */
@media (max-width: 1024px) {
    .faq-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .faq-filters {
        flex-wrap: wrap;
    }
    
    .search-box {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
    }
    
    .ai-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .faq-tabs {
        -webkit-overflow-scrolling: touch;
    }
    
    .faq-item-header {
        flex-direction: column;
    }
    
    .faq-ai-info {
        flex-direction: column;
    }
    
    .suggestion-item {
        flex-direction: column;
        align-items: stretch;
    }
}
</style>

<script>
// FAQ管理ページ用JavaScript
(function() {
    'use strict';
    
    // FAQモジュールの定義
    const FAQModule = {
        currentEditId: null,
        
        // FAQの展開/折りたたみ
        toggleExpand: function(button) {
            console.log('toggleExpand called');
            const item = button.closest('.faq-item');
            const content = item.querySelector('.faq-item-content');
            const arrow = button.querySelector('svg');
            
            if (!content) {
                console.error('Content not found');
                return;
            }
            
            // 現在の表示状態を確認
            const isCurrentlyHidden = content.style.display === 'none' || getComputedStyle(content).display === 'none';
            
            if (isCurrentlyHidden) {
                // 表示する
                content.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
                item.classList.add('expanded');
            } else {
                // 非表示にする
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
                item.classList.remove('expanded');
            }
        },
        
        // AIモデルの更新
        trainModel: function() {
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.show('AIモデルの更新を開始しました', 'info');
            }
        },
        
        // FAQ追加モーダル
        showAddModal: function() {
            const modal = document.getElementById('faqEditModal');
            if (modal) {
                // 新規作成用にフォームをクリア
                document.getElementById('faqId').value = '';
                document.getElementById('faqQuestion').value = '';
                document.getElementById('faqAnswer').value = '';
                document.getElementById('faqCategory').value = '';
                document.getElementById('faqStatus').value = 'draft';
                document.getElementById('faqTags').value = '';
                
                // モーダルを表示
                modal.style.opacity = '1';
                modal.style.visibility = 'visible';
                modal.classList.add('modal-show');
                modal.classList.remove('modal-hide');
            }
        },
        
        // FAQ編集
        edit: function(id) {
            console.log('Edit FAQ:', id);
            const modal = document.getElementById('faqEditModal');
            if (modal) {
                // モックデータを取得（実際の実装ではAPIから取得）
                const faqItem = document.querySelector(`.faq-item:nth-child(${id})`);
                if (faqItem) {
                    const question = faqItem.querySelector('.faq-question').textContent;
                    const answer = faqItem.querySelector('.faq-answer p')?.textContent || '';
                    const category = faqItem.querySelector('.faq-category')?.textContent || '';
                    const status = faqItem.querySelector('.faq-status');
                    const statusValue = status?.classList.contains('published') ? 'published' :
                                      status?.classList.contains('draft') ? 'draft' :
                                      status?.classList.contains('review') ? 'review' : 'archived';
                    
                    // フォームに値を設定
                    document.getElementById('faqId').value = id;
                    document.getElementById('faqQuestion').value = question;
                    document.getElementById('faqAnswer').value = answer;
                    document.getElementById('faqCategory').value = this.getCategoryValue(category);
                    document.getElementById('faqStatus').value = statusValue;
                }
                
                // モーダルを表示
                modal.style.opacity = '1';
                modal.style.visibility = 'visible';
                modal.classList.add('modal-show');
                modal.classList.remove('modal-hide');
                
                if (window.KAGAMI && window.KAGAMI.notification) {
                    window.KAGAMI.notification.show('FAQ編集画面を開きました', 'info');
                }
            }
        },
        
        // カテゴリ値を取得
        getCategoryValue: function(name) {
            const categories = {
                '財務・業績': 'financial',
                '経営戦略': 'strategy',
                'ESG・サステナビリティ': 'esg',
                'ガバナンス': 'governance',
                'その他': 'other'
            };
            return categories[name] || 'other';
        },
        
        // FAQ保存
        saveFAQ: function() {
            const question = document.getElementById('faqQuestion').value;
            const answer = document.getElementById('faqAnswer').value;
            
            if (!question.trim() || !answer.trim()) {
                if (window.KAGAMI && window.KAGAMI.notification) {
                    window.KAGAMI.notification.error('質問と回答を入力してください');
                }
                return;
            }
            
            // 保存処理（実際の実装ではAPI呼び出し）
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.success('FAQを保存しました');
            }
            this.closeEditModal();
        },
        
        // FAQ保存して公開
        saveFAQAndPublish: function() {
            document.getElementById('faqStatus').value = 'published';
            this.saveFAQ();
        },
        
        // FAQ編集モーダルを閉じる
        closeEditModal: function() {
            const modal = document.getElementById('faqEditModal');
            if (modal) {
                modal.classList.add('modal-hide');
                modal.classList.remove('modal-show');
                setTimeout(() => {
                    modal.style.opacity = '0';
                    modal.style.visibility = 'hidden';
                }, 300);
            }
        },
        
        // AI改善
        improve: function(id) {
            console.log('Improve FAQ:', id);
            const modal = document.getElementById('aiImproveModal');
            if (modal) {
                // FAQデータを取得
                const faqItem = document.querySelector(`.faq-item:nth-child(${id})`);
                if (faqItem) {
                    const question = faqItem.querySelector('.faq-question').textContent;
                    const answer = faqItem.querySelector('.faq-answer p')?.textContent || '';
                    
                    // モーダルに表示
                    document.getElementById('aiImproveQuestion').textContent = question;
                    document.getElementById('aiImproveAnswer').textContent = answer;
                    
                    // AI分析をシミュレート
                    this.startAIAnalysis(id, question, answer);
                }
                
                // モーダルを表示
                modal.style.opacity = '1';
                modal.style.visibility = 'visible';
                modal.classList.add('modal-show');
                modal.classList.remove('modal-hide');
            }
        },
        
        // AI分析開始
        startAIAnalysis: function(id, question, answer) {
            const suggestionContent = document.getElementById('suggestionContent');
            suggestionContent.innerHTML = '<div class="loading-spinner">AI分析中...</div>';
            
            // 2秒後に結果を表示（モック）
            setTimeout(() => {
                this.showAISuggestions('clarity');
                this.updateAIMetrics(85, 78, 92);
            }, 2000);
        },
        
        // AI提案表示
        showAISuggestions: function(type) {
            const suggestionContent = document.getElementById('suggestionContent');
            const suggestions = {
                clarity: `
                    <div class="ai-suggestion">
                        <h4>提案内容</h4>
                        <p>現在の回答をより明確にするための改善提案：</p>
                        <ul>
                            <li>専門用語に簡潔な説明を追加</li>
                            <li>文章を短く区切って読みやすく</li>
                            <li>重要なポイントを箇条書きで整理</li>
                        </ul>
                        <div class="suggested-text">
                            <h5>改善後の回答例</h5>
                            <p>2024年度の営業利益率目標は<strong>15%以上</strong>を設定しています。</p>
                            <p>これは前年度実績の13.8%から約1.2ポイントの改善を目指すもので、主に以下の施策により達成を見込んでいます：</p>
                            <ul>
                                <li><strong>生産効率の向上</strong>：原価率を0.5ポイント改善</li>
                                <li><strong>高付加価値製品へのシフト</strong>：0.4ポイント増</li>
                                <li><strong>販管費の最適化</strong>：0.3ポイント削減</li>
                            </ul>
                        </div>
                    </div>
                `,
                completeness: `
                    <div class="ai-suggestion">
                        <h4>提案内容</h4>
                        <p>回答の完全性を高めるための追加要素：</p>
                        <ul>
                            <li>リスク要因と対策の記載</li>
                            <li>進捗モニタリング方法の説明</li>
                            <li>関連する中長期目標との整合性</li>
                        </ul>
                    </div>
                `,
                tone: `
                    <div class="ai-suggestion">
                        <h4>提案内容</h4>
                        <p>投資家向けの適切なトーン調整：</p>
                        <ul>
                            <li>よりプロフェッショナルな表現に</li>
                            <li>数値根拠を強調</li>
                            <li>自信を持った表現に変更</li>
                        </ul>
                    </div>
                `,
                structure: `
                    <div class="ai-suggestion">
                        <h4>提案内容</h4>
                        <p>回答の構造を改善：</p>
                        <ul>
                            <li>結論を先に述べる</li>
                            <li>論理的な流れで説明</li>
                            <li>要約を最後に追加</li>
                        </ul>
                    </div>
                `
            };
            
            suggestionContent.innerHTML = suggestions[type] || suggestions.clarity;
        },
        
        // AIメトリクス更新
        updateAIMetrics: function(readability, expertise, completeness) {
            const metrics = [
                { value: readability, selector: '.ai-metrics .metric-item:nth-child(1)' },
                { value: expertise, selector: '.ai-metrics .metric-item:nth-child(2)' },
                { value: completeness, selector: '.ai-metrics .metric-item:nth-child(3)' }
            ];
            
            metrics.forEach(metric => {
                const item = document.querySelector(metric.selector);
                if (item) {
                    const fill = item.querySelector('.metric-fill');
                    const value = item.querySelector('.metric-value');
                    fill.style.width = metric.value + '%';
                    value.textContent = metric.value + '/100';
                }
            });
        },
        
        // AI改善モーダルを閉じる
        closeAIImproveModal: function() {
            const modal = document.getElementById('aiImproveModal');
            if (modal) {
                modal.classList.add('modal-hide');
                modal.classList.remove('modal-show');
                setTimeout(() => {
                    modal.style.opacity = '0';
                    modal.style.visibility = 'hidden';
                }, 300);
            }
        },
        
        // AI改善を適用
        applyAIImprovement: function() {
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.success('AI改善を適用しました');
            }
            this.closeAIImproveModal();
        },
        
        // アーカイブ
        archive: function(id) {
            console.log('Archive FAQ:', id);
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.warning('FAQをアーカイブしました');
            }
        },
        
        // 一括公開
        bulkPublish: function() {
            console.log('Bulk publish');
        },
        
        // 一括アーカイブ
        bulkArchive: function() {
            console.log('Bulk archive');
        },
        
        // 提案から作成
        createFromSuggestion: function(id) {
            console.log('Create from suggestion:', id);
        },
        
        // 提案を更新
        updateSuggestion: function(id) {
            console.log('Update suggestion:', id);
        },
        
        // 多言語設定表示
        showLanguageSettings: function() {
            const modal = document.getElementById('languageSettingsModal');
            if (modal) {
                modal.style.opacity = '1';
                modal.style.visibility = 'visible';
                modal.classList.add('modal-show');
                modal.classList.remove('modal-hide');
            }
        },
        
        // 多言語設定を閉じる
        closeLanguageSettings: function() {
            const modal = document.getElementById('languageSettingsModal');
            if (modal) {
                modal.classList.add('modal-hide');
                modal.classList.remove('modal-show');
                setTimeout(() => {
                    modal.style.opacity = '0';
                    modal.style.visibility = 'hidden';
                }, 300);
            }
        },
        
        // 多言語設定を保存
        saveLanguageSettings: function() {
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.success('言語設定を保存しました');
            }
            this.closeLanguageSettings();
        },
        
        // 翻訳編集
        editTranslation: function(faqId, language) {
            console.log('Edit translation:', faqId, language);
        },
        
        // 自動翻訳
        autoTranslate: function(faqId, language) {
            const langName = this.getLanguageName(language);
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.info(`FAQ #${faqId} を${langName}に自動翻訳中...`);
            }
        },
        
        // 一括翻訳
        bulkTranslate: function() {
            if (window.KAGAMI && window.KAGAMI.notification) {
                window.KAGAMI.notification.info('未翻訳のFAQを一括翻訳中...');
            }
        },
        
        // 言語名取得
        getLanguageName: function(langCode) {
            const langNames = {
                'ja': '日本語',
                'en': '英語',
                'zh': '中国語',
                'ko': '韓国語'
            };
            return langNames[langCode] || langCode;
        },
        
        // カテゴリ名取得
        getCategoryName: function(value) {
            const categories = {
                'financial': '財務・業績',
                'strategy': '経営戦略',
                'esg': 'ESG・サステナビリティ',
                'governance': 'ガバナンス',
                'other': 'その他'
            };
            return categories[value] || value;
        },
        
        // ステータス名取得
        getStatusName: function(value) {
            const statuses = {
                'published': '公開中',
                'draft': '下書き',
                'review': 'レビュー中',
                'archived': 'アーカイブ'
            };
            return statuses[value] || value;
        },
        
        // テキストフォーマット
        formatText: function(format) {
            console.log('Format text:', format);
        },
        
        // リンク挿入
        insertLink: function() {
            console.log('Insert link');
        },
        
        // AI改善（エディタ内）
        aiImprove: function() {
            console.log('AI Improve');
        },
        
        // ソース追加
        addSource: function() {
            const sourceList = document.getElementById('sourceList');
            const newSource = document.createElement('div');
            newSource.className = 'source-item';
            newSource.innerHTML = `
                <input type="text" class="form-input" placeholder="例：2024年3月期決算説明会資料 P.12">
                <button type="button" class="btn btn-sm btn-outline" onclick="KAGAMI.faq.removeSource(this)">削除</button>
            `;
            sourceList.appendChild(newSource);
        },
        
        // ソース削除
        removeSource: function(button) {
            button.closest('.source-item').remove();
        },
        
        // 類似FAQ表示
        showSimilar: function() {
            const modal = document.getElementById('similarFAQModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        },
        
        // 類似FAQモーダルを閉じる
        closeSimilarModal: function() {
            const modal = document.getElementById('similarFAQModal');
            if (modal) {
                modal.style.display = 'none';
            }
        },
        
        // FAQ詳細表示
        viewFAQ: function(id) {
            console.log('View FAQ:', id);
        },
        
        // FAQ統合
        mergeFAQ: function(id) {
            console.log('Merge FAQ:', id);
        },
        
        // 編集を続行
        continueEditing: function() {
            this.closeSimilarModal();
        }
    };
    
    // DOMContentLoadedで初期化
    document.addEventListener('DOMContentLoaded', function() {
        console.log('FAQ page initialization started');
        
        // KAGAMIオブジェクトが存在するまで待つ
        function initializeWhenReady() {
            if (window.KAGAMI) {
                // FAQモジュールをKAGAMIに追加
                window.KAGAMI.faq = FAQModule;
                console.log('FAQ module added to KAGAMI:', window.KAGAMI.faq);
                
                // イベントリスナーの設定
                setupEventListeners();
                
                // 初期化完了を通知
                console.log('FAQ module initialization completed');
            } else {
                // 50ms後に再試行
                setTimeout(initializeWhenReady, 50);
            }
        }
        
        // イベントリスナーの設定
        function setupEventListeners() {
            // アコーディオンボタンのイベントリスナー
            const toggleButtons = document.querySelectorAll('.faq-toggle-btn');
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (window.KAGAMI && window.KAGAMI.faq) {
                        window.KAGAMI.faq.toggleExpand(this);
                    } else {
                        console.error('KAGAMI.faq is not initialized');
                    }
                });
            });
            
            // ヘッダーボタンのイベントリスナー
            const languageSettingsBtn = document.getElementById('languageSettingsBtn');
            if (languageSettingsBtn) {
                languageSettingsBtn.addEventListener('click', function() {
                    if (window.KAGAMI && window.KAGAMI.faq) {
                        window.KAGAMI.faq.showLanguageSettings();
                    }
                });
            }
            
            const trainModelBtn = document.getElementById('trainModelBtn');
            if (trainModelBtn) {
                trainModelBtn.addEventListener('click', function() {
                    if (window.KAGAMI && window.KAGAMI.faq) {
                        window.KAGAMI.faq.trainModel();
                    }
                });
            }
            
            const showAddModalBtn = document.getElementById('showAddModalBtn');
            if (showAddModalBtn) {
                showAddModalBtn.addEventListener('click', function() {
                    if (window.KAGAMI && window.KAGAMI.faq) {
                        window.KAGAMI.faq.showAddModal();
                    }
                });
            }
            
            // 言語タブの切り替え
            const languageTabs = document.querySelectorAll('.language-tab');
            languageTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    languageTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const selectedLang = this.dataset.lang;
                    if (window.KAGAMI && window.KAGAMI.notification) {
                        window.KAGAMI.notification.show(`${FAQModule.getLanguageName(selectedLang)}版のFAQを表示中`, 'info');
                    }
                    
                    filterFAQsByLanguage(selectedLang);
                });
            });
            
            // FAQカテゴリタブの切り替え
            const faqTabs = document.querySelectorAll('.faq-tab');
            faqTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    faqTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.dataset.category;
                    filterFAQsByCategory(category);
                });
            });
            
            // AI改善モーダルのタブ切り替え
            const suggestionTabs = document.querySelectorAll('.suggestion-tab');
            suggestionTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    suggestionTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.dataset.type;
                    if (window.KAGAMI && window.KAGAMI.faq) {
                        window.KAGAMI.faq.showAISuggestions(type);
                    }
                });
            });
            
            console.log('Event listeners setup completed');
        }
        
        // 初期化開始
        initializeWhenReady();
    });
    
    // グローバル関数（互換性のため）
    window.filterFAQsByLanguage = function(language) {
        console.log('Filtering FAQs by language:', language);
    };
    
    window.filterFAQsByCategory = function(category) {
        console.log('Filtering FAQs by category:', category);
    };
})();

// ミニチャートの描画
(function() {
    document.addEventListener('DOMContentLoaded', function() {
        // Chart.jsが読み込まれるまで待つ
        function initChart() {
            const canvas = document.getElementById('aiGeneratedChart');
            if (canvas && typeof Chart !== 'undefined') {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['', '', '', '', '', '', ''],
                        datasets: [{
                            data: [65, 72, 78, 85, 92, 98, 105],
                            borderColor: '#14b8a6',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        }
                    }
                });
            } else {
                // Chart.jsがまだ読み込まれていない場合は再試行
                setTimeout(initChart, 100);
            }
        }
        
        initChart();
    });
})();
</script>
{% endblock %}
