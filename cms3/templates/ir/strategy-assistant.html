{% extends 'base/base.html' %}

{% block title %}‰∏≠ÊúüË®àÁîª„ÉªÊäïË≥áÂÆ∂ÂØæÂøúÁÆ°ÁêÜ - Êà¶Áï•„Ç¢„Ç∑„Çπ„Çø„É≥„Éà{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/pages/strategy-assistant.css">
<style>
    /* ‰∏≠ÊúüË®àÁîªË°®Á§∫„Ç®„É™„Ç¢ */
    .midterm-plan-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        margin-bottom: 24px;
    }
    
    .plan-header {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px 12px 0 0;
    }
    
    .plan-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .plan-period {
        font-size: 1.125rem;
        opacity: 0.9;
        margin-bottom: 1rem;
    }
    
    .plan-source {
        display: flex;
        gap: 16px;
        font-size: 0.875rem;
        flex-wrap: wrap;
    }
    
    .source-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 4px 12px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
    }
    
    /* Ë®àÁîªË©≥Á¥∞ */
    .plan-content {
        padding: 24px;
    }
    
    .plan-section {
        margin-bottom: 32px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .section-actions {
        display: flex;
        gap: 8px;
    }
    
    /* ÁõÆÊ®ô„Ç´„Éº„Éâ */
    .target-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .target-card {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        position: relative;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .target-card:hover {
        border-color: #14b8a6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }
    
    .target-indicator {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
    }
    
    .target-indicator.has-questions {
        background: #f59e0b;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.2); }
        100% { opacity: 1; transform: scale(1); }
    }
    
    .target-name {
        font-weight: 600;
        color: #111827;
        margin-bottom: 8px;
    }
    
    .target-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a365d;
        margin-bottom: 4px;
    }
    
    .target-baseline {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 8px;
    }
    
    .target-questions {
        font-size: 0.75rem;
        color: #f59e0b;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .target-questions.all-answered {
        color: #10b981;
    }
    
    /* Ë≥™ÂïèÁÆ°ÁêÜ„Ç®„É™„Ç¢ */
    .question-management {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .question-tabs {
        display: flex;
        gap: 4px;
        background: #f3f4f6;
        padding: 4px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .question-tab {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        background: transparent;
        border: none;
    }
    
    .question-tab.active {
        background: white;
        color: #111827;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .question-badge {
        position: absolute;
        top: -4px;
        right: -4px;
        background: #ef4444;
        color: white;
        font-size: 0.625rem;
        padding: 2px 6px;
        border-radius: 10px;
        font-weight: 600;
    }
    
    /* Ë≥™Âïè„É™„Çπ„Éà */
    .question-list {
        space-y: 12px;
    }
    
    .question-item {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        transition: all 0.2s;
        cursor: pointer;
        margin-bottom: 12px;
    }
    
    .question-item:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .question-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.75rem;
        color: #6b7280;
    }
    
    .question-status {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.625rem;
        font-weight: 600;
    }
    
    .status-new {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-answered {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-faq {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .question-text {
        font-weight: 500;
        color: #111827;
        margin-bottom: 8px;
    }
    
    .question-context {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 12px;
    }
    
    .question-actions {
        display: flex;
        gap: 8px;
    }
    
    .action-button {
        padding: 6px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .action-button:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }
    
    .action-button.primary {
        background: #14b8a6;
        border-color: #14b8a6;
        color: white;
    }
    
    .action-button.primary:hover {
        background: #0d9488;
        border-color: #0d9488;
    }
    
    /* FAQ‰ΩúÊàê„Ç®„É™„Ç¢ */
    .faq-editor {
        background: linear-gradient(135deg, #f0fdfa, #e0f2fe);
        border: 1px solid #14b8a6;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }
    
    .faq-editor::before {
        content: 'ü§ñ';
        position: absolute;
        top: 24px;
        right: 24px;
        font-size: 32px;
        opacity: 0.2;
    }
    
    .faq-editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .faq-editor-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f766e;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .ai-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 12px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        font-size: 0.75rem;
        color: #0f766e;
    }
    
    .ai-indicator.active {
        animation: ai-pulse 1.5s infinite;
    }
    
    @keyframes ai-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    
    /* FAQÁ∑®ÈõÜ„Éï„Ç©„Éº„É† */
    .faq-form {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .form-section {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 0.875rem;
    }
    
    .form-input, .form-textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.875rem;
        transition: all 0.2s;
    }
    
    .form-input:focus, .form-textarea:focus {
        outline: none;
        border-color: #14b8a6;
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }
    
    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }
    
    /* AIÊèêÊ°à */
    .ai-suggestions {
        background: #f0fdfa;
        border: 1px solid #14b8a6;
        border-radius: 8px;
        padding: 16px;
        margin-top: 12px;
    }
    
    .ai-suggestion-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
        background: white;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .ai-suggestion-item:hover {
        transform: translateX(4px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .suggestion-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #d1fae5;
        border-radius: 50%;
        flex-shrink: 0;
    }
    
    .suggestion-content {
        flex: 1;
    }
    
    .suggestion-title {
        font-weight: 500;
        color: #111827;
        margin-bottom: 4px;
        font-size: 0.875rem;
    }
    
    .suggestion-text {
        font-size: 0.75rem;
        color: #6b7280;
        line-height: 1.5;
    }
    
    .suggestion-action {
        color: #14b8a6;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    /* AIÂàÜÊûêÁµêÊûú„Éë„Éç„É´ */
    .ai-analysis-results {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 24px;
    }
    
    .ai-analysis-header {
        background: linear-gradient(135deg, #3b82f6 0%, #14b8a6 100%);
        color: white;
        padding: 24px;
    }
    
    .ai-analysis-content {
        padding: 24px;
    }
    
    /* „Ç§„É≥„Çµ„Ç§„Éà„Éë„Éç„É´ */
    .insights-panel {
        background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .insight-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: white;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .insight-item:hover {
        transform: translateX(8px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .insight-icon {
        width: 40px;
        height: 40px;
        background: #dbeafe;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #2563eb;
    }
    
    .insight-icon.warning {
        background: #fef3c7;
        color: #d97706;
    }
    
    .insight-icon.success {
        background: #d1fae5;
        color: #059669;
    }
    
    /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
    .progress-bar {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
        margin: 8px 0;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: #10b981;
        border-radius: 2px;
        transition: width 0.3s ease;
    }
    
    .progress-bar-fill.warning {
        background: #f59e0b;
    }
    
    .progress-bar-fill.danger {
        background: #ef4444;
    }
    
    /* „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¢„ÇØ„Ç∑„Éß„É≥ */
    .floating-actions {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 50;
    }
    
    .ai-assist-button {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 10px 25px -5px rgba(20, 184, 166, 0.5);
        cursor: pointer;
        transition: all 0.3s;
        border: none;
    }
    
    .ai-assist-button:hover {
        transform: scale(1.1);
        box-shadow: 0 15px 35px -5px rgba(20, 184, 166, 0.7);
    }
    
    /* „É¢„Éº„ÉÄ„É´ */
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }
    
    .modal-backdrop.active {
        opacity: 1;
        visibility: visible;
    }
    
    .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        transform: scale(0.9);
        transition: transform 0.3s;
    }
    
    .modal-backdrop.active .modal-content {
        transform: scale(1);
    }
    
    .modal-header {
        padding: 24px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .modal-body {
        padding: 24px;
    }
    
    .modal-footer {
        padding: 16px 24px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }
    
    /* „É≠„Éº„Éâ‰∏≠Ë°®Á§∫ */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
    @media (max-width: 768px) {
        .target-grid {
            grid-template-columns: 1fr;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        
        .question-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .question-actions {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- AIÂàÜÊûê„Ç¢„É©„Éº„Éà -->
    <div id="ai-analysis-alert" class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-teal-50 border border-blue-200 rounded-lg" style="display: none;">
        <div class="flex items-start gap-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <div class="flex-1">
                <h3 class="text-sm font-semibold text-blue-900">Êñ∞„Åó„ÅÑÈñãÁ§∫Ë≥áÊñô„ÇíÊ§úÂá∫„Åó„Åæ„Åó„Åü</h3>
                <p class="text-sm text-blue-700 mt-1">2024Âπ¥1Êúà22Êó•‰ªò„ÅÆÊ±∫ÁÆóÁü≠‰ø°„Åã„ÇâÊà¶Áï•„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÇíÊäΩÂá∫„Åß„Åç„Åæ„Åô„ÄÇ</p>
                <button onclick="startAIAnalysis()" class="mt-2 inline-block px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors">
                    AIÂàÜÊûê„ÇíÈñãÂßã
                </button>
            </div>
            <button onclick="dismissAlert()" class="text-blue-400 hover:text-blue-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- ‰∏≠ÊúüÁµåÂñ∂Ë®àÁîªË°®Á§∫„Ç®„É™„Ç¢ -->
    <div class="midterm-plan-container">
        <div class="plan-header">
            <h1 class="plan-title" id="plan-title">Ë™≠„ÅøËæº„Åø‰∏≠...</h1>
            <p class="plan-period" id="plan-subtitle">...</p>
            <div class="plan-source" id="plan-sources">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
            </div>
        </div>
        
        <div class="plan-content">
            <!-- ÂÆöÈáèÁõÆÊ®ô„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="plan-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span>üìä</span>
                        ÂÆöÈáèÁõÆÊ®ôÔºà2026Âπ¥Â∫¶Ôºâ
                    </h2>
                    <div class="section-actions">
                        <button onclick="showAllQuestions('quantitative')" class="action-button">
                            Èñ¢ÈÄ£Ë≥™Âïè„ÇíË¶ã„Çã (<span id="quantitative-question-count">0</span>‰ª∂)
                        </button>
                        <button onclick="editTargets('quantitative')" class="action-button">
                            Á∑®ÈõÜ
                        </button>
                    </div>
                </div>
                
                <div class="target-grid" id="quantitative-targets">
                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
            <!-- ÈáçÁÇπÊñΩÁ≠ñ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="plan-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span>üéØ</span>
                        ÈáçÁÇπÊñΩÁ≠ñ
                    </h2>
                    <div class="section-actions">
                        <button onclick="showAllQuestions('strategies')" class="action-button">
                            Èñ¢ÈÄ£Ë≥™Âïè„ÇíË¶ã„Çã (<span id="strategies-question-count">0</span>‰ª∂)
                        </button>
                        <button onclick="editTargets('strategies')" class="action-button">
                            Á∑®ÈõÜ
                        </button>
                    </div>
                </div>
                
                <div class="target-grid" id="key-strategies">
                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ë≥™ÂïèÁÆ°ÁêÜ„Ç®„É™„Ç¢ -->
    <div class="question-management">
        <div class="section-header">
            <h2 class="section-title">
                <span>üí¨</span>
                ÊäïË≥áÂÆ∂„Åã„Çâ„ÅÆË≥™ÂïèÁÆ°ÁêÜ
            </h2>
            <div class="section-actions">
                <button onclick="importQuestions()" class="action-button">
                    Ë≥™Âïè„Çí„Ç§„É≥„Éù„Éº„Éà
                </button>
                <button onclick="showAIAssistant()" class="action-button primary">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    AIÂõûÁ≠îÊîØÊè¥
                </button>
                <a href="/ir/strategy-assistant/timeline-analysis" class="action-button">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    ÊôÇÁ≥ªÂàóÂàÜÊûê
                </a>
            </div>
        </div>
        
        <div class="question-tabs">
            <button class="question-tab active" onclick="switchQuestionTab('unanswered')">
                Êú™ÂõûÁ≠î
                <span class="question-badge" id="unanswered-count">0</span>
            </button>
            <button class="question-tab" onclick="switchQuestionTab('draft')">
                ‰∏ãÊõ∏„Åç
                <span class="question-badge" id="draft-count">0</span>
            </button>
            <button class="question-tab" onclick="switchQuestionTab('answered')">
                ÂõûÁ≠îÊ∏à„Åø
            </button>
            <button class="question-tab" onclick="switchQuestionTab('faq')">
                FAQÂåñÊ∏à„Åø
            </button>
        </div>
        
        <div id="question-list" class="question-list">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
        </div>
    </div>

    <!-- FAQ‰ΩúÊàê„Ç®„É™„Ç¢ -->
    <div id="faq-editor" class="faq-editor" style="display: none;">
        <div class="faq-editor-header">
            <h3 class="faq-editor-title">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                AIÊîØÊè¥FAQ‰ΩúÊàê
            </h3>
            <div class="ai-indicator active">
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                AI„ÅåÂàÜÊûê‰∏≠...
            </div>
        </div>
        
        <div class="faq-form">
            <div class="form-section">
                <label class="form-label">ÂÖÉ„ÅÆË≥™Âïè</label>
                <div class="p-3 bg-gray-50 rounded-lg text-sm" id="original-question">
                    <!-- ÂãïÁöÑ„Å´ÊåøÂÖ• -->
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">„Ç´„ÉÜ„Ç¥„É™„Éº</label>
                <select class="form-input" id="faq-category">
                    <option>Ë≤°Âãô„ÉªÊ•≠Á∏æ</option>
                    <option>ÁµåÂñ∂Êà¶Áï•</option>
                    <option>ESG„Éª„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£</option>
                    <option>„Ç¨„Éê„Éä„É≥„Çπ</option>
                    <option>‰∫ãÊ•≠Â±ïÈñã</option>
                    <option>ÊäÄË°ì„ÉªÁ†îÁ©∂ÈñãÁô∫</option>
                </select>
            </div>
            
            <div class="form-section">
                <label class="form-label">FAQÁî®„ÅÆË≥™ÂïèÊñá</label>
                <input type="text" class="form-input" id="faq-question" 
                    placeholder="ÊäïË≥áÂÆ∂„Å´„Å®„Å£„Å¶„Çè„Åã„Çä„ÇÑ„Åô„ÅÑË≥™ÂïèÊñá„Å´Á∑®ÈõÜ">
                
                <div class="ai-suggestions">
                    <div class="text-xs font-semibold text-teal-700 mb-2">AIÊèêÊ°à</div>
                    <div class="ai-suggestion-item" onclick="applyAISuggestion('question', 1)">
                        <div class="suggestion-icon">üí°</div>
                        <div class="suggestion-content">
                            <div class="suggestion-title">„Çà„ÇäÊ±éÁî®ÁöÑ„Å™Ë°®Áèæ</div>
                            <div class="suggestion-text">
                                „ÄåÊµ∑Â§ñÂ±ïÈñã„Å´„Åä„Åë„ÇãÂú∞ÂüüÂà•„ÅÆÂ£≤‰∏äÁõÆÊ®ô„Å®ÊäïË≥áË®àÁîª„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ„Äç
                            </div>
                        </div>
                        <span class="suggestion-action">ÈÅ©Áî®</span>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ÂõûÁ≠î</label>
                <textarea class="form-textarea" id="faq-answer" 
                    placeholder="ÊòéÁ¢∫„ÅßÂåÖÊã¨ÁöÑ„Å™ÂõûÁ≠î„ÇíË®òËºâ"></textarea>
                
                <div class="ai-suggestions">
                    <div class="text-xs font-semibold text-teal-700 mb-2">AIÊèêÊ°àÔºàÈñãÁ§∫Ê∏à„ÅøÊÉÖÂ†±„Åã„ÇâÁîüÊàêÔºâ</div>
                    <div class="ai-suggestion-item" onclick="applyAISuggestion('answer', 1)">
                        <div class="suggestion-icon">üìä</div>
                        <div class="suggestion-content">
                            <div class="suggestion-title">Êï∞ÂÄ§„ÇíÂê´„ÇÄÂÖ∑‰ΩìÁöÑÂõûÁ≠î</div>
                            <div class="suggestion-text">
                                „Äå2026Âπ¥Â∫¶„ÅÆÊµ∑Â§ñÂ£≤‰∏äÊØîÁéá35%ÈÅîÊàê„Å´Âêë„Åë„Å¶„ÄÅ„Ç¢„Ç∏„Ç¢Âú∞Âüü„Åß200ÂÑÑÂÜÜÔºàÂÖ®‰Ωì„ÅÆ60%Ôºâ„ÄÅ
                                ÂåóÁ±≥„Åß100ÂÑÑÂÜÜÔºà30%Ôºâ„ÄÅÊ¨ßÂ∑û„Åß30ÂÑÑÂÜÜÔºà10%Ôºâ„ÅÆÂ£≤‰∏ä„ÇíË®àÁîª„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Äç
                            </div>
                        </div>
                        <span class="suggestion-action">ÈÅ©Áî®</span>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveFAQ()" class="btn btn-primary">‰øùÂ≠ò„Åó„Å¶FAQÂÖ¨Èñã</button>
                <button onclick="saveDraft()" class="btn btn-secondary">‰∏ãÊõ∏„Åç‰øùÂ≠ò</button>
                <button onclick="closeFAQEditor()" class="btn btn-secondary">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>

    <!-- „Ç§„É≥„Çµ„Ç§„Éà„Éë„Éç„É´ -->
    <div class="insights-panel" id="insightsPanel">
        <h3 class="text-lg font-semibold mb-4">AI„Å´„Çà„ÇãÂàÜÊûê„Å®Êé®Â•®‰∫ãÈ†Ö</h3>
        <div class="space-y-3" id="insights-list">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
        </div>
        
        <!-- ÊôÇÁ≥ªÂàóÂàÜÊûê„Å∏„ÅÆ„É™„É≥„ÇØ -->
        <div class="mt-4 pt-4 border-t border-gray-200">
            <a href="/ir/strategy-assistant/timeline-analysis" class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">ÊôÇÁ≥ªÂàóÂàÜÊûê</h4>
                        <p class="text-sm text-gray-600">ÊäïË≥áÂÆ∂„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅÆ„Éà„É¨„É≥„Éâ„Å®Ê†™‰æ°Áõ∏Èñ¢„ÇíÂàÜÊûê</p>
                    </div>
                </div>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>

    <!-- „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¢„ÇØ„Ç∑„Éß„É≥ -->
    <div class="floating-actions">
        <button class="ai-assist-button" onclick="toggleAIAssist()">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        </button>
    </div>
</div>

<!-- „É¢„Éº„ÉÄ„É´ -->
<div id="modal-backdrop" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title" class="text-xl font-semibold"></h3>
        </div>
        <div class="modal-body" id="modal-body">
            <!-- ÂãïÁöÑ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        </div>
        <div class="modal-footer">
            <button onclick="closeModal()" class="btn btn-secondary">Èñâ„Åò„Çã</button>
            <button id="modal-confirm" class="btn btn-primary">Á¢∫Ë™ç</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- „Éö„Éº„Ç∏Âõ∫Êúâ„ÅÆJavaScript -->
<script src="/static/js/pages/strategy-assistant.js"></script>
<script>
// „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
let strategyData = null;
let currentQuestionTab = 'unanswered';
let currentEditingQuestion = null;

// „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
document.addEventListener('DOMContentLoaded', async function() {
    try {
        // „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
        const response = await fetch('/static/data/strategy-planning.json');
        strategyData = await response.json();
        
        // ÁîªÈù¢„ÅÆÂàùÊúüÂåñ
        initializePlan();
        loadQuestions();
        loadInsights();
        
        // Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
        checkForNewData();
    } catch (error) {
        console.error('Error loading strategy data:', error);
        showNotification('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
    }
});

// ‰∏≠ÊúüÁµåÂñ∂Ë®àÁîª„ÅÆÂàùÊúüÂåñ
function initializePlan() {
    if (!strategyData || !strategyData.midtermPlan) return;
    
    const plan = strategyData.midtermPlan;
    
    // „Éò„ÉÉ„ÉÄ„ÉºÊÉÖÂ†±
    document.getElementById('plan-title').textContent = plan.title;
    document.getElementById('plan-subtitle').textContent = plan.subtitle;
    
    // „Éá„Éº„Çø„ÇΩ„Éº„Çπ
    const sourcesContainer = document.getElementById('plan-sources');
    sourcesContainer.innerHTML = plan.dataSources.map(source => 
        `<span class="source-badge">${source.icon} ${source.type} - ${source.date}</span>`
    ).join('');
    
    // ÂÆöÈáèÁõÆÊ®ô
    renderTargets('quantitative-targets', plan.quantitativeTargets);
    const quantitativeQuestionCount = plan.quantitativeTargets.reduce((sum, target) => sum + (target.questionCount || 0), 0);
    document.getElementById('quantitative-question-count').textContent = quantitativeQuestionCount;
    
    // ÈáçÁÇπÊñΩÁ≠ñ
    renderTargets('key-strategies', plan.keyStrategies);
    const strategiesQuestionCount = plan.keyStrategies.reduce((sum, target) => sum + (target.questionCount || 0), 0);
    document.getElementById('strategies-question-count').textContent = strategiesQuestionCount;
}

// ÁõÆÊ®ô„Ç´„Éº„Éâ„ÅÆÊèèÁîª
function renderTargets(containerId, targets) {
    const container = document.getElementById(containerId);
    container.innerHTML = targets.map(target => `
        <div class="target-card" onclick="showTargetDetail('${target.id}')">
            <div class="target-indicator ${target.hasQuestions ? 'has-questions' : ''}"></div>
            <div class="target-name">${target.name}</div>
            <div class="target-value">${target.value}</div>
            <div class="target-baseline">${target.baseline}</div>
            <div class="target-questions ${target.questionCount === 0 ? 'all-answered' : ''}" onclick="event.stopPropagation(); showTargetQuestions('${target.id}')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    ${target.questionCount > 0 ? 
                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' :
                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />'
                    }
                </svg>
                <span>${target.questionCount > 0 ? `${target.questionCount}‰ª∂„ÅÆÊú™ÂõûÁ≠îË≥™Âïè` : '„Åô„Åπ„Å¶ÂõûÁ≠îÊ∏à„Åø'}</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill ${getProgressClass(target.progress)}" style="width: ${target.progress || 0}%"></div>
            </div>
        </div>
    `).join('');
}

// ÈÄ≤ÊçóÁéá„Å´Âøú„Åò„Åü„ÇØ„É©„Çπ
function getProgressClass(progress) {
    if (progress >= 70) return '';
    if (progress >= 40) return 'warning';
    return 'danger';
}

// Ë≥™Âïè„ÅÆË™≠„ÅøËæº„Åø
function loadQuestions() {
    if (!strategyData || !strategyData.questions) return;
    
    const questions = strategyData.questions;
    
    // „Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
    document.getElementById('unanswered-count').textContent = questions.summary.unanswered;
    document.getElementById('draft-count').textContent = questions.summary.draft;
    
    // Ë≥™Âïè„É™„Çπ„ÉàË°®Á§∫
    renderQuestions(questions.recentQuestions);
}

// Ë≥™Âïè„ÅÆÊèèÁîª
function renderQuestions(questions) {
    const container = document.getElementById('question-list');
    container.innerHTML = questions.map(q => `
        <div class="question-item" onclick="openQuestionDetail('${q.id}')">
            <div class="question-header">
                <div class="question-meta">
                    <span>üè¢ ${q.investor}</span>
                    <span>‚Ä¢</span>
                    <span>${q.date} ${q.type}</span>
                    <span>‚Ä¢</span>
                    <span>${q.category}</span>
                </div>
                <div class="question-status">
                    <span class="status-badge status-${q.status}">${getStatusLabel(q.status)}</span>
                </div>
            </div>
            <p class="question-text">${q.question}</p>
            <p class="question-context">
                Èñ¢ÈÄ£Ôºö${q.relatedTo.join(', ')}
            </p>
            <div class="question-actions">
                <button class="action-button primary" onclick="event.stopPropagation(); answerQuestion('${q.id}')">ÂõûÁ≠î‰ΩúÊàê</button>
                <button class="action-button" onclick="event.stopPropagation(); createFAQ('${q.id}')">FAQÂåñ</button>
                <button class="action-button" onclick="event.stopPropagation(); assignQuestion('${q.id}')">ÊãÖÂΩìËÄÖÂâ≤ÂΩì</button>
                <button class="action-button" onclick="event.stopPropagation(); relateQuestion('${q.id}')">È°û‰ººË≥™Âïè„ÇíË¶ã„Çã</button>
            </div>
        </div>
    `).join('');
}

// „Çπ„ÉÜ„Éº„Çø„Çπ„É©„Éô„É´„ÅÆÂèñÂæó
function getStatusLabel(status) {
    const labels = {
        'new': 'Êñ∞Ë¶è',
        'draft': '‰∏ãÊõ∏„Åç',
        'answered': 'ÂõûÁ≠îÊ∏à„Åø',
        'faq': 'FAQÂåñÊ∏à„Åø'
    };
    return labels[status] || status;
}

// „Ç§„É≥„Çµ„Ç§„Éà„ÅÆË™≠„ÅøËæº„Åø
function loadInsights() {
    if (!strategyData || !strategyData.insights) return;
    
    const container = document.getElementById('insights-list');
    container.innerHTML = strategyData.insights.current.map(insight => `
        <div class="insight-item" onclick="applyInsight('${insight.type}')">
            <div class="insight-icon ${insight.type}">
                ${insight.icon}
            </div>
            <div class="flex-1">
                <h4 class="font-medium text-sm">${insight.title}</h4>
                <p class="text-xs text-gray-600 mt-1">${insight.description}</p>
            </div>
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
        </div>
    `).join('');
}

// Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
function checkForNewData() {
    // „Éá„É¢Áî®ÔºöÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åì„Å®„ÇíÈÄöÁü•
    setTimeout(() => {
        document.getElementById('ai-analysis-alert').style.display = 'block';
    }, 2000);
}

// „Ç¢„É©„Éº„Éà„ÇíÈñâ„Åò„Çã
function dismissAlert() {
    document.getElementById('ai-analysis-alert').style.display = 'none';
}

// AIÂàÜÊûêÈñãÂßã
function startAIAnalysis() {
    dismissAlert();
    showModal({
        title: 'AIÊà¶Áï•ÂàÜÊûê',
        content: `
            <div class="space-y-4">
                <p>ÊúÄÊñ∞„ÅÆÈñãÁ§∫Ë≥áÊñô„Åã„ÇâAIÂàÜÊûê„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ</p>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-medium mb-2">ÂàÜÊûêÂØæË±°</h4>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ 2024Âπ¥1Êúà22Êó• Ê±∫ÁÆóÁü≠‰ø°</li>
                        <li>‚Ä¢ 2024Âπ¥1Êúà15Êó• ‰∏≠ÊúüÁµåÂñ∂Ë®àÁîªÈÄ≤Êçó</li>
                    </ul>
                </div>
                <p class="text-sm text-gray-600">Âá¶ÁêÜÊôÇÈñì„ÅÆÁõÆÂÆâÔºö1-2ÂàÜ</p>
            </div>
        `,
        onConfirm: () => {
            showNotification('AIÂàÜÊûê„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü', 'info');
            // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆÂàÜÊûêÂá¶ÁêÜ„ÇíÂÆüË°å
            simulateAIAnalysis();
        }
    });
}

// ÁõÆÊ®ôË©≥Á¥∞Ë°®Á§∫
function showTargetDetail(targetId) {
    const allTargets = [...strategyData.midtermPlan.quantitativeTargets, ...strategyData.midtermPlan.keyStrategies];
    const target = allTargets.find(t => t.id === targetId);
    
    if (!target) return;
    
    showModal({
        title: target.name,
        content: `
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-2xl font-bold mb-2">${target.value}</p>
                    <p class="text-sm text-gray-600">${target.baseline}</p>
                </div>
                
                <div>
                    <h4 class="font-medium mb-2">ÈÄ≤ÊçóÁä∂Ê≥Å</h4>
                    <div class="progress-bar">
                        <div class="progress-bar-fill ${getProgressClass(target.progress)}" style="width: ${target.progress}%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">${target.progress}% ÈÅîÊàê</p>
                </div>
                
                ${target.details ? `
                    <div>
                        <h4 class="font-medium mb-2">Ë©≥Á¥∞</h4>
                        <p class="text-sm text-gray-600">${target.details.description}</p>
                    </div>
                ` : ''}
                
                <div class="flex gap-2">
                    <button onclick="editTarget('${targetId}')" class="btn btn-primary btn-sm">Á∑®ÈõÜ</button>
                    <button onclick="showTargetQuestions('${targetId}')" class="btn btn-secondary btn-sm">Èñ¢ÈÄ£Ë≥™Âïè„ÇíË¶ã„Çã</button>
                </div>
            </div>
        `,
        showConfirm: false
    });
}

// Ë≥™Âïè„Çø„ÉñÂàá„ÇäÊõø„Åà
function switchQuestionTab(tab) {
    currentQuestionTab = tab;
    
    // „Çø„Éñ„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
    document.querySelectorAll('.question-tab').forEach(t => {
        t.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Ë≥™Âïè„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
    // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆ„Çø„Éñ„Å´Âøú„Åò„ÅüË≥™Âïè„ÇíË°®Á§∫
    loadQuestions();
}

// FAQ‰ΩúÊàê
function createFAQ(questionId) {
    const question = strategyData.questions.recentQuestions.find(q => q.id === questionId);
    if (!question) return;
    
    currentEditingQuestion = question;
    
    document.getElementById('original-question').textContent = question.question;
    document.getElementById('faq-question').value = '';
    document.getElementById('faq-answer').value = '';
    document.getElementById('faq-editor').style.display = 'block';
    document.getElementById('faq-editor').scrollIntoView({ behavior: 'smooth' });
}

// FAQ„Ç®„Éá„Ç£„Çø„ÇíÈñâ„Åò„Çã
function closeFAQEditor() {
    document.getElementById('faq-editor').style.display = 'none';
    currentEditingQuestion = null;
}

// FAQ‰øùÂ≠ò
function saveFAQ() {
    const faqData = {
        question: document.getElementById('faq-question').value,
        answer: document.getElementById('faq-answer').value,
        category: document.getElementById('faq-category').value,
        originalQuestionId: currentEditingQuestion?.id
    };
    
    // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆ‰øùÂ≠òÂá¶ÁêÜ
    showNotification('FAQ„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
    closeFAQEditor();
}

// AIÊèêÊ°à„ÅÆÈÅ©Áî®
function applyAISuggestion(type, index) {
    if (type === 'question') {
        document.getElementById('faq-question').value = "Êµ∑Â§ñÂ±ïÈñã„Å´„Åä„Åë„ÇãÂú∞ÂüüÂà•„ÅÆÂ£≤‰∏äÁõÆÊ®ô„Å®ÊäïË≥áË®àÁîª„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ";
    } else if (type === 'answer') {
        document.getElementById('faq-answer').value = "2026Âπ¥Â∫¶„ÅÆÊµ∑Â§ñÂ£≤‰∏äÊØîÁéá35%ÈÅîÊàê„Å´Âêë„Åë„Å¶„ÄÅ„Ç¢„Ç∏„Ç¢Âú∞Âüü„Åß200ÂÑÑÂÜÜÔºàÂÖ®‰Ωì„ÅÆ60%Ôºâ„ÄÅÂåóÁ±≥„Åß100ÂÑÑÂÜÜÔºà30%Ôºâ„ÄÅÊ¨ßÂ∑û„Åß30ÂÑÑÂÜÜÔºà10%Ôºâ„ÅÆÂ£≤‰∏ä„ÇíË®àÁîª„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊäïË≥áÈ°ç„ÅØ3Âπ¥Èñì„ÅßÁ∑èÈ°ç150ÂÑÑÂÜÜ„Çí‰∫àÂÆö„Åó„ÄÅÁèæÂú∞Ê≥ï‰∫∫Ë®≠Á´ã„ÄÅÁâ©ÊµÅÊã†ÁÇπÊßãÁØâ„ÄÅ„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Âº∑Âåñ„Å´ÂÖÖÂΩì„Åó„Åæ„Åô„ÄÇ";
    }
}

// „É¢„Éº„ÉÄ„É´Ë°®Á§∫
function showModal(options) {
    const backdrop = document.getElementById('modal-backdrop');
    const title = document.getElementById('modal-title');
    const body = document.getElementById('modal-body');
    const confirmBtn = document.getElementById('modal-confirm');
    
    title.textContent = options.title;
    body.innerHTML = options.content;
    
    if (options.showConfirm !== false) {
        confirmBtn.style.display = 'block';
        confirmBtn.onclick = () => {
            closeModal();
            if (options.onConfirm) options.onConfirm();
        };
    } else {
        confirmBtn.style.display = 'none';
    }
    
    backdrop.classList.add('active');
}

// „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
function closeModal() {
    document.getElementById('modal-backdrop').classList.remove('active');
}

// ÈÄöÁü•Ë°®Á§∫
function showNotification(message, type = 'info') {
    // Tailwind„ÅÆtoast„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Çí‰ΩøÁî®
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 
        'bg-blue-600'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// AIÂàÜÊûê„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
function simulateAIAnalysis() {
    setTimeout(() => {
        showNotification('AIÂàÜÊûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü', 'success');
        
        // ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫
        showModal({
            title: 'AIÂàÜÊûêÁµêÊûú',
            content: `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">ÈáçË¶Å„Å™Áô∫Ë¶ã</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Êµ∑Â§ñÂ£≤‰∏äÊØîÁéáÁõÆÊ®ô„Çí35%‚Üí38%„Å´‰∏äÊñπ‰øÆÊ≠£„ÇíÊé®Â•®</li>
                            <li>‚Ä¢ DXÊäïË≥áÈ°ç„Çí300ÂÑÑÂÜÜ‚Üí320ÂÑÑÂÜÜ„Å´Â¢óÈ°ç„ÅÆÂøÖË¶ÅÊÄß</li>
                            <li>‚Ä¢ Êñ∞Ë¶èÊñΩÁ≠ñÔºöAIÈúÄË¶Å‰∫àÊ∏¨„Ç∑„Çπ„ÉÜ„É†„ÅÆËøΩÂä†</li>
                        </ul>
                    </div>
                    <p class="text-sm text-gray-600">„Åì„Çå„Çâ„ÅÆÂ§âÊõ¥„Çí‰∏≠ÊúüÁµåÂñ∂Ë®àÁîª„Å´ÂèçÊò†„Åó„Åæ„Åô„ÅãÔºü</p>
                </div>
            `,
            onConfirm: () => {
                showNotification('‰∏≠ÊúüÁµåÂñ∂Ë®àÁîª„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
                // ÁîªÈù¢„ÅÆÊõ¥Êñ∞
                updatePlanWithAIResults();
            }
        });
    }, 2000);
}

// AIÂàÜÊûêÁµêÊûú„ÅÆÂèçÊò†
function updatePlanWithAIResults() {
    // Êµ∑Â§ñÂ£≤‰∏äÊØîÁéá„ÇíÊõ¥Êñ∞
    const overseasTarget = strategyData.midtermPlan.quantitativeTargets.find(t => t.id === 'overseas-ratio');
    if (overseasTarget) {
        overseasTarget.value = '38%';
        overseasTarget.baseline = '2023Âπ¥Â∫¶ÂÆüÁ∏æ: 22%Ôºà+16ptÔºâ';
    }
    
    // DXÊäïË≥á„ÇíÊõ¥Êñ∞
    const dxStrategy = strategyData.midtermPlan.keyStrategies.find(s => s.id === 'dx-investment');
    if (dxStrategy) {
        dxStrategy.value = '3Âπ¥Èñì„Åß320ÂÑÑÂÜÜ';
    }
    
    // ÁîªÈù¢„ÇíÂÜçÊèèÁîª
    initializePlan();
}

// „Åù„ÅÆ‰ªñ„ÅÆÊ©üËÉΩ
function toggleAIAssist() {
    showNotification('AI „Ç¢„Ç∑„Çπ„Çø„É≥„Éà„ÅåËµ∑Âãï„Åó„Åæ„Åó„Åü', 'info');
}

function answerQuestion(questionId) {
    showNotification(`Ë≥™Âïè ${questionId} „ÅÆÂõûÁ≠î‰ΩúÊàêÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô`, 'info');
}

function assignQuestion(questionId) {
    showNotification(`Ë≥™Âïè ${questionId} „ÅÆÊãÖÂΩìËÄÖÂâ≤ÂΩìÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô`, 'info');
}

function relateQuestion(questionId) {
    showNotification(`Ë≥™Âïè ${questionId} „ÅÆÈ°û‰ººË≥™Âïè„ÇíÊ§úÁ¥¢„Åó„Åæ„Åô`, 'info');
}

function showTargetQuestions(targetId) {
    showNotification(`${targetId} „Å´Èñ¢ÈÄ£„Åô„ÇãË≥™Âïè„ÇíË°®Á§∫„Åó„Åæ„Åô`, 'info');
}

function showAllQuestions(type) {
    showNotification(`${type} „Å´Èñ¢ÈÄ£„Åô„Çã„Åô„Åπ„Å¶„ÅÆË≥™Âïè„ÇíË°®Á§∫„Åó„Åæ„Åô`, 'info');
}

function editTargets(type) {
    showNotification(`${type} „ÅÆÁ∑®ÈõÜÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô`, 'info');
}

function importQuestions() {
    showNotification('Ë≥™Âïè„ÅÆ„Ç§„É≥„Éù„Éº„ÉàÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô', 'info');
}

function showAIAssistant() {
    showNotification('AIÂõûÁ≠îÊîØÊè¥„ÇíËµ∑Âãï„Åó„Åæ„Åô', 'info');
}

function applyInsight(type) {
    showNotification(`„Ç§„É≥„Çµ„Ç§„Éà ${type} „ÇíÈÅ©Áî®„Åó„Åæ„Åô`, 'info');
}

function openQuestionDetail(questionId) {
    showNotification(`Ë≥™Âïè ${questionId} „ÅÆË©≥Á¥∞„ÇíË°®Á§∫„Åó„Åæ„Åô`, 'info');
}

function editTarget(targetId) {
    showNotification(`ÁõÆÊ®ô ${targetId} „ÅÆÁ∑®ÈõÜÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô`, 'info');
}

// „É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
document.getElementById('modal-backdrop').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>
{% endblock %}