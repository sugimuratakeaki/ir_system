{% extends 'base/base.html' %}

{% block title %}ä¸­æœŸè¨ˆç”»ãƒ»æŠ•è³‡å®¶å¯¾å¿œç®¡ç† - æˆ¦ç•¥ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/pages/strategy-assistant.css">
<style>
    /* ä¸­æœŸè¨ˆç”»è¡¨ç¤ºã‚¨ãƒªã‚¢ */
    .midterm-plan-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        margin-bottom: 24px;
    }
    
    .plan-header {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px 12px 0 0;
    }
    
    .plan-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .plan-period {
        font-size: 1.125rem;
        opacity: 0.9;
        margin-bottom: 1rem;
    }
    
    .plan-source {
        display: flex;
        gap: 16px;
        font-size: 0.875rem;
        flex-wrap: wrap;
    }
    
    .source-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 4px 12px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
    }
    
    /* è¨ˆç”»è©³ç´° */
    .plan-content {
        padding: 24px;
    }
    
    .plan-section {
        margin-bottom: 32px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .section-actions {
        display: flex;
        gap: 8px;
    }
    
    /* ç›®æ¨™ã‚«ãƒ¼ãƒ‰ */
    .target-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .target-card {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        position: relative;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .target-card:hover {
        border-color: #14b8a6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }
    
    .target-indicator {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
    }
    
    .target-indicator.has-questions {
        background: #f59e0b;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.2); }
        100% { opacity: 1; transform: scale(1); }
    }
    
    .target-name {
        font-weight: 600;
        color: #111827;
        margin-bottom: 8px;
    }
    
    .target-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a365d;
        margin-bottom: 4px;
    }
    
    .target-baseline {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 8px;
    }
    
    .target-questions {
        font-size: 0.75rem;
        color: #f59e0b;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .target-questions.all-answered {
        color: #10b981;
    }
    
    /* è³ªå•ç®¡ç†ã‚¨ãƒªã‚¢ */
    .question-management {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .question-tabs {
        display: flex;
        gap: 4px;
        background: #f3f4f6;
        padding: 4px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .question-tab {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        background: transparent;
        border: none;
    }
    
    .question-tab.active {
        background: white;
        color: #111827;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .question-badge {
        position: absolute;
        top: -4px;
        right: -4px;
        background: #ef4444;
        color: white;
        font-size: 0.625rem;
        padding: 2px 6px;
        border-radius: 10px;
        font-weight: 600;
    }
    
    /* è³ªå•ãƒªã‚¹ãƒˆ */
    .question-list {
        space-y: 12px;
    }
    
    .question-item {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        transition: all 0.2s;
        cursor: pointer;
        margin-bottom: 12px;
    }
    
    .question-item:hover {
        border-color: #14b8a6;
        background: #f0fdfa;
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .question-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.75rem;
        color: #6b7280;
    }
    
    .question-status {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.625rem;
        font-weight: 600;
    }
    
    .status-new {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-answered {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-faq {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .question-text {
        font-weight: 500;
        color: #111827;
        margin-bottom: 8px;
    }
    
    .question-context {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 12px;
    }
    
    .question-actions {
        display: flex;
        gap: 8px;
    }
    
    .action-button {
        padding: 6px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .action-button:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }
    
    .action-button.primary {
        background: #14b8a6;
        border-color: #14b8a6;
        color: white;
    }
    
    .action-button.primary:hover {
        background: #0d9488;
        border-color: #0d9488;
    }
    
    /* FAQä½œæˆã‚¨ãƒªã‚¢ */
    .faq-editor {
        background: linear-gradient(135deg, #f0fdfa, #e0f2fe);
        border: 1px solid #14b8a6;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }
    
    .faq-editor::before {
        content: 'ğŸ¤–';
        position: absolute;
        top: 24px;
        right: 24px;
        font-size: 32px;
        opacity: 0.2;
    }
    
    .faq-editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .faq-editor-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f766e;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .ai-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 12px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        font-size: 0.75rem;
        color: #0f766e;
    }
    
    .ai-indicator.active {
        animation: ai-pulse 1.5s infinite;
    }
    
    @keyframes ai-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    
    /* FAQç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  */
    .faq-form {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .form-section {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 0.875rem;
    }
    
    .form-input, .form-textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.875rem;
        transition: all 0.2s;
    }
    
    .form-input:focus, .form-textarea:focus {
        outline: none;
        border-color: #14b8a6;
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }
    
    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }
    
    /* AIææ¡ˆ */
    .ai-suggestions {
        background: #f0fdfa;
        border: 1px solid #14b8a6;
        border-radius: 8px;
        padding: 16px;
        margin-top: 12px;
    }
    
    .ai-suggestion-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
        background: white;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .ai-suggestion-item:hover {
        transform: translateX(4px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .suggestion-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #d1fae5;
        border-radius: 50%;
        flex-shrink: 0;
    }
    
    .suggestion-content {
        flex: 1;
    }
    
    .suggestion-title {
        font-weight: 500;
        color: #111827;
        margin-bottom: 4px;
        font-size: 0.875rem;
    }
    
    .suggestion-text {
        font-size: 0.75rem;
        color: #6b7280;
        line-height: 1.5;
    }
    
    .suggestion-action {
        color: #14b8a6;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    /* AIåˆ†æçµæœãƒ‘ãƒãƒ« */
    .ai-analysis-results {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 24px;
    }
    
    .ai-analysis-header {
        background: linear-gradient(135deg, #3b82f6 0%, #14b8a6 100%);
        color: white;
        padding: 24px;
    }
    
    .ai-analysis-content {
        padding: 24px;
    }
    
    /* ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ‘ãƒãƒ« */
    .insights-panel {
        background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .insight-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: white;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .insight-item:hover {
        transform: translateX(8px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .insight-icon {
        width: 40px;
        height: 40px;
        background: #dbeafe;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #2563eb;
    }
    
    .insight-icon.warning {
        background: #fef3c7;
        color: #d97706;
    }
    
    .insight-icon.success {
        background: #d1fae5;
        color: #059669;
    }
    
    /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    .progress-bar {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
        margin: 8px 0;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: #10b981;
        border-radius: 2px;
        transition: width 0.3s ease;
    }
    
    .progress-bar-fill.warning {
        background: #f59e0b;
    }
    
    .progress-bar-fill.danger {
        background: #ef4444;
    }
    
    /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
    .floating-actions {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 50;
    }
    
    .ai-assist-button {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 10px 25px -5px rgba(20, 184, 166, 0.5);
        cursor: pointer;
        transition: all 0.3s;
        border: none;
    }
    
    .ai-assist-button:hover {
        transform: scale(1.1);
        box-shadow: 0 15px 35px -5px rgba(20, 184, 166, 0.7);
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }
    
    .modal-backdrop.active {
        opacity: 1;
        visibility: visible;
    }
    
    .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        transform: scale(0.9);
        transition: transform 0.3s;
    }
    
    .modal-backdrop.active .modal-content {
        transform: scale(1);
    }
    
    .modal-header {
        padding: 24px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .modal-body {
        padding: 24px;
    }
    
    .modal-footer {
        padding: 16px 24px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }
    
    /* ãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤º */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
        .target-grid {
            grid-template-columns: 1fr;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        
        .question-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .question-actions {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- AIåˆ†æã‚¢ãƒ©ãƒ¼ãƒˆ -->
    <div id="ai-analysis-alert" class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-teal-50 border border-blue-200 rounded-lg" style="display: none;">
        <div class="flex items-start gap-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <div class="flex-1">
                <h3 class="text-sm font-semibold text-blue-900">æ–°ã—ã„é–‹ç¤ºè³‡æ–™ã‚’æ¤œå‡ºã—ã¾ã—ãŸ</h3>
                <p class="text-sm text-blue-700 mt-1">2024å¹´1æœˆ22æ—¥ä»˜ã®æ±ºç®—çŸ­ä¿¡ã‹ã‚‰æˆ¦ç•¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’æŠ½å‡ºã§ãã¾ã™ã€‚</p>
                <button onclick="startAIAnalysis()" class="mt-2 inline-block px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors">
                    AIåˆ†æã‚’é–‹å§‹
                </button>
            </div>
            <button onclick="dismissAlert()" class="text-blue-400 hover:text-blue-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- ä¸­æœŸçµŒå–¶è¨ˆç”»è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="midterm-plan-container">
        <div class="plan-header">
            <h1 class="plan-title" id="plan-title">èª­ã¿è¾¼ã¿ä¸­...</h1>
            <p class="plan-period" id="plan-subtitle">...</p>
            <div class="plan-source" id="plan-sources">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="plan-content">
            <!-- å®šé‡ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="plan-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span>ğŸ“Š</span>
                        å®šé‡ç›®æ¨™ï¼ˆ2026å¹´åº¦ï¼‰
                    </h2>
                    <div class="section-actions">
                        <button onclick="showAllQuestions('quantitative')" class="action-button">
                            é–¢é€£è³ªå•ã‚’è¦‹ã‚‹ (<span id="quantitative-question-count">0</span>ä»¶)
                        </button>
                        <button onclick="editTargets('quantitative')" class="action-button">
                            ç·¨é›†
                        </button>
                    </div>
                </div>
                
                <div class="target-grid" id="quantitative-targets">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- é‡ç‚¹æ–½ç­–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="plan-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span>ğŸ¯</span>
                        é‡ç‚¹æ–½ç­–
                    </h2>
                    <div class="section-actions">
                        <button onclick="showAllQuestions('strategies')" class="action-button">
                            é–¢é€£è³ªå•ã‚’è¦‹ã‚‹ (<span id="strategies-question-count">0</span>ä»¶)
                        </button>
                        <button onclick="editTargets('strategies')" class="action-button">
                            ç·¨é›†
                        </button>
                    </div>
                </div>
                
                <div class="target-grid" id="key-strategies">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- è³ªå•ç®¡ç†ã‚¨ãƒªã‚¢ -->
    <div class="question-management">
        <div class="section-header">
            <h2 class="section-title">
                <span>ğŸ’¬</span>
                æŠ•è³‡å®¶ã‹ã‚‰ã®è³ªå•ç®¡ç†
            </h2>
            <div class="section-actions">
                <button onclick="importQuestions()" class="action-button">
                    è³ªå•ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                </button>
                <button onclick="showAIAssistant()" class="action-button primary">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    AIå›ç­”æ”¯æ´
                </button>
                <a href="/ir/strategy-assistant/timeline-analysis" class="action-button">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    æ™‚ç³»åˆ—åˆ†æ
                </a>
            </div>
        </div>
        
        <div class="question-tabs">
            <button class="question-tab active" onclick="switchQuestionTab('unanswered')">
                æœªå›ç­”
                <span class="question-badge" id="unanswered-count">0</span>
            </button>
            <button class="question-tab" onclick="switchQuestionTab('draft')">
                ä¸‹æ›¸ã
                <span class="question-badge" id="draft-count">0</span>
            </button>
            <button class="question-tab" onclick="switchQuestionTab('answered')">
                å›ç­”æ¸ˆã¿
            </button>
            <button class="question-tab" onclick="switchQuestionTab('faq')">
                FAQåŒ–æ¸ˆã¿
            </button>
        </div>
        
        <div id="question-list" class="question-list">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>

    <!-- FAQä½œæˆã‚¨ãƒªã‚¢ -->
    <div id="faq-editor" class="faq-editor" style="display: none;">
        <div class="faq-editor-header">
            <h3 class="faq-editor-title">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                AIæ”¯æ´FAQä½œæˆ
            </h3>
            <div class="ai-indicator active">
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                AIãŒåˆ†æä¸­...
            </div>
        </div>
        
        <div class="faq-form">
            <div class="form-section">
                <label class="form-label">å…ƒã®è³ªå•</label>
                <div class="p-3 bg-gray-50 rounded-lg text-sm" id="original-question">
                    <!-- å‹•çš„ã«æŒ¿å…¥ -->
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                <select class="form-input" id="faq-category">
                    <option>è²¡å‹™ãƒ»æ¥­ç¸¾</option>
                    <option>çµŒå–¶æˆ¦ç•¥</option>
                    <option>ESGãƒ»ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£</option>
                    <option>ã‚¬ãƒãƒŠãƒ³ã‚¹</option>
                    <option>äº‹æ¥­å±•é–‹</option>
                    <option>æŠ€è¡“ãƒ»ç ”ç©¶é–‹ç™º</option>
                </select>
            </div>
            
            <div class="form-section">
                <label class="form-label">FAQç”¨ã®è³ªå•æ–‡</label>
                <input type="text" class="form-input" id="faq-question" 
                    placeholder="æŠ•è³‡å®¶ã«ã¨ã£ã¦ã‚ã‹ã‚Šã‚„ã™ã„è³ªå•æ–‡ã«ç·¨é›†">
                
                <div class="ai-suggestions">
                    <div class="text-xs font-semibold text-teal-700 mb-2">AIææ¡ˆ</div>
                    <div class="ai-suggestion-item" onclick="applyAISuggestion('question', 1)">
                        <div class="suggestion-icon">ğŸ’¡</div>
                        <div class="suggestion-content">
                            <div class="suggestion-title">ã‚ˆã‚Šæ±ç”¨çš„ãªè¡¨ç¾</div>
                            <div class="suggestion-text">
                                ã€Œæµ·å¤–å±•é–‹ã«ãŠã‘ã‚‹åœ°åŸŸåˆ¥ã®å£²ä¸Šç›®æ¨™ã¨æŠ•è³‡è¨ˆç”»ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€
                            </div>
                        </div>
                        <span class="suggestion-action">é©ç”¨</span>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">å›ç­”</label>
                <textarea class="form-textarea" id="faq-answer" 
                    placeholder="æ˜ç¢ºã§åŒ…æ‹¬çš„ãªå›ç­”ã‚’è¨˜è¼‰"></textarea>
                
                <div class="ai-suggestions">
                    <div class="text-xs font-semibold text-teal-700 mb-2">AIææ¡ˆï¼ˆé–‹ç¤ºæ¸ˆã¿æƒ…å ±ã‹ã‚‰ç”Ÿæˆï¼‰</div>
                    <div class="ai-suggestion-item" onclick="applyAISuggestion('answer', 1)">
                        <div class="suggestion-icon">ğŸ“Š</div>
                        <div class="suggestion-content">
                            <div class="suggestion-title">æ•°å€¤ã‚’å«ã‚€å…·ä½“çš„å›ç­”</div>
                            <div class="suggestion-text">
                                ã€Œ2026å¹´åº¦ã®æµ·å¤–å£²ä¸Šæ¯”ç‡35%é”æˆã«å‘ã‘ã¦ã€ã‚¢ã‚¸ã‚¢åœ°åŸŸã§200å„„å††ï¼ˆå…¨ä½“ã®60%ï¼‰ã€
                                åŒ—ç±³ã§100å„„å††ï¼ˆ30%ï¼‰ã€æ¬§å·ã§30å„„å††ï¼ˆ10%ï¼‰ã®å£²ä¸Šã‚’è¨ˆç”»ã—ã¦ã„ã¾ã™ã€‚ã€
                            </div>
                        </div>
                        <span class="suggestion-action">é©ç”¨</span>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveFAQ()" class="btn btn-primary">ä¿å­˜ã—ã¦FAQå…¬é–‹</button>
                <button onclick="saveDraft()" class="btn btn-secondary">ä¸‹æ›¸ãä¿å­˜</button>
                <button onclick="closeFAQEditor()" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- ã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ‘ãƒãƒ« -->
    <div class="insights-panel" id="insightsPanel">
        <h3 class="text-lg font-semibold mb-4">AIã«ã‚ˆã‚‹åˆ†æã¨æ¨å¥¨äº‹é …</h3>
        <div class="space-y-3" id="insights-list">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        
        <!-- æ™‚ç³»åˆ—åˆ†æã¸ã®ãƒªãƒ³ã‚¯ -->
        <div class="mt-4 pt-4 border-t border-gray-200">
            <a href="/ir/strategy-assistant/timeline-analysis" class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">æ™‚ç³»åˆ—åˆ†æ</h4>
                        <p class="text-sm text-gray-600">æŠ•è³‡å®¶ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã¨æ ªä¾¡ç›¸é–¢ã‚’åˆ†æ</p>
                    </div>
                </div>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>

    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="floating-actions">
        <button class="ai-assist-button" onclick="toggleAIAssist()">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        </button>
    </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="modal-backdrop" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title" class="text-xl font-semibold"></h3>
        </div>
        <div class="modal-body" id="modal-body">
            <!-- å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        </div>
        <div class="modal-footer">
            <button onclick="closeModal()" class="btn btn-secondary">é–‰ã˜ã‚‹</button>
            <button id="modal-confirm" class="btn btn-primary">ç¢ºèª</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- ãƒšãƒ¼ã‚¸å›ºæœ‰ã®JavaScript -->
<script src="/static/js/pages/strategy-assistant.js"></script>
<script>
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let strategyData = null;
let currentQuestionTab = 'unanswered';
let currentEditingQuestion = null;

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', async function() {
    try {
        // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        const response = await fetch('/static/data/strategy-planning.json');
        strategyData = await response.json();
        
        // ç”»é¢ã®åˆæœŸåŒ–
        initializePlan();
        loadQuestions();
        loadInsights();
        
        // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯
        checkForNewData();
    } catch (error) {
        console.error('Error loading strategy data:', error);
        showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
});

// ä¸­æœŸçµŒå–¶è¨ˆç”»ã®åˆæœŸåŒ–
function initializePlan() {
    if (!strategyData || !strategyData.midtermPlan) return;
    
    const plan = strategyData.midtermPlan;
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
    document.getElementById('plan-title').textContent = plan.title;
    document.getElementById('plan-subtitle').textContent = plan.subtitle;
    
    // ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
    const sourcesContainer = document.getElementById('plan-sources');
    sourcesContainer.innerHTML = plan.dataSources.map(source => 
        `<span class="source-badge">${source.icon} ${source.type} - ${source.date}</span>`
    ).join('');
    
    // å®šé‡ç›®æ¨™
    renderTargets('quantitative-targets', plan.quantitativeTargets);
    const quantitativeQuestionCount = plan.quantitativeTargets.reduce((sum, target) => sum + (target.questionCount || 0), 0);
    document.getElementById('quantitative-question-count').textContent = quantitativeQuestionCount;
    
    // é‡ç‚¹æ–½ç­–
    renderTargets('key-strategies', plan.keyStrategies);
    const strategiesQuestionCount = plan.keyStrategies.reduce((sum, target) => sum + (target.questionCount || 0), 0);
    document.getElementById('strategies-question-count').textContent = strategiesQuestionCount;
}

// ç›®æ¨™ã‚«ãƒ¼ãƒ‰ã®æç”»
function renderTargets(containerId, targets) {
    const container = document.getElementById(containerId);
    container.innerHTML = targets.map(target => `
        <div class="target-card" onclick="showTargetDetail('${target.id}')">
            <div class="target-indicator ${target.hasQuestions ? 'has-questions' : ''}"></div>
            <div class="target-name">${target.name}</div>
            <div class="target-value">${target.value}</div>
            <div class="target-baseline">${target.baseline}</div>
            <div class="target-questions ${target.questionCount === 0 ? 'all-answered' : ''}" onclick="event.stopPropagation(); showTargetQuestions('${target.id}')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    ${target.questionCount > 0 ? 
                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' :
                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />'
                    }
                </svg>
                <span>${target.questionCount > 0 ? `${target.questionCount}ä»¶ã®æœªå›ç­”è³ªå•` : 'ã™ã¹ã¦å›ç­”æ¸ˆã¿'}</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill ${getProgressClass(target.progress)}" style="width: ${target.progress || 0}%"></div>
            </div>
        </div>
    `).join('');
}

// é€²æ—ç‡ã«å¿œã˜ãŸã‚¯ãƒ©ã‚¹
function getProgressClass(progress) {
    if (progress >= 70) return '';
    if (progress >= 40) return 'warning';
    return 'danger';
}

// è³ªå•ã®èª­ã¿è¾¼ã¿
function loadQuestions() {
    if (!strategyData || !strategyData.questions) return;
    
    const questions = strategyData.questions;
    
    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
    document.getElementById('unanswered-count').textContent = questions.summary.unanswered;
    document.getElementById('draft-count').textContent = questions.summary.draft;
    
    // è³ªå•ãƒªã‚¹ãƒˆè¡¨ç¤º
    renderQuestions(questions.recentQuestions);
}

// è³ªå•ã®æç”»
function renderQuestions(questions) {
    const container = document.getElementById('question-list');
    container.innerHTML = questions.map(q => `
        <div class="question-item" onclick="openQuestionDetail('${q.id}')">
            <div class="question-header">
                <div class="question-meta">
                    <span>ğŸ¢ ${q.investor}</span>
                    <span>â€¢</span>
                    <span>${q.date} ${q.type}</span>
                    <span>â€¢</span>
                    <span>${q.category}</span>
                </div>
                <div class="question-status">
                    <span class="status-badge status-${q.status}">${getStatusLabel(q.status)}</span>
                </div>
            </div>
            <p class="question-text">${q.question}</p>
            <p class="question-context">
                é–¢é€£ï¼š${q.relatedTo.join(', ')}
            </p>
            <div class="question-actions">
                <button class="action-button primary" onclick="event.stopPropagation(); answerQuestion('${q.id}')">å›ç­”ä½œæˆ</button>
                <button class="action-button" onclick="event.stopPropagation(); createFAQ('${q.id}')">FAQåŒ–</button>
                <button class="action-button" onclick="event.stopPropagation(); assignQuestion('${q.id}')">æ‹…å½“è€…å‰²å½“</button>
                <button class="action-button" onclick="event.stopPropagation(); relateQuestion('${q.id}')">é¡ä¼¼è³ªå•ã‚’è¦‹ã‚‹</button>
            </div>
        </div>
    `).join('');
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ãƒ™ãƒ«ã®å–å¾—
function getStatusLabel(status) {
    const labels = {
        'new': 'æ–°è¦',
        'draft': 'ä¸‹æ›¸ã',
        'answered': 'å›ç­”æ¸ˆã¿',
        'faq': 'FAQåŒ–æ¸ˆã¿'
    };
    return labels[status] || status;
}

// ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®èª­ã¿è¾¼ã¿
function loadInsights() {
    if (!strategyData || !strategyData.insights) return;
    
    const container = document.getElementById('insights-list');
    container.innerHTML = strategyData.insights.current.map(insight => `
        <div class="insight-item" onclick="applyInsight('${insight.type}')">
            <div class="insight-icon ${insight.type}">
                ${insight.icon}
            </div>
            <div class="flex-1">
                <h4 class="font-medium text-sm">${insight.title}</h4>
                <p class="text-xs text-gray-600 mt-1">${insight.description}</p>
            </div>
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
        </div>
    `).join('');
}

// æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯
function checkForNewData() {
    // ãƒ‡ãƒ¢ç”¨ï¼šæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã“ã¨ã‚’é€šçŸ¥
    setTimeout(() => {
        document.getElementById('ai-analysis-alert').style.display = 'block';
    }, 2000);
}

// ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹
function dismissAlert() {
    document.getElementById('ai-analysis-alert').style.display = 'none';
}

// AIåˆ†æé–‹å§‹
function startAIAnalysis() {
    dismissAlert();
    showModal({
        title: 'AIæˆ¦ç•¥åˆ†æ',
        content: `
            <div class="space-y-4">
                <p>æœ€æ–°ã®é–‹ç¤ºè³‡æ–™ã‹ã‚‰AIåˆ†æã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-medium mb-2">åˆ†æå¯¾è±¡</h4>
                    <ul class="text-sm space-y-1">
                        <li>â€¢ 2024å¹´1æœˆ22æ—¥ æ±ºç®—çŸ­ä¿¡</li>
                        <li>â€¢ 2024å¹´1æœˆ15æ—¥ ä¸­æœŸçµŒå–¶è¨ˆç”»é€²æ—</li>
                    </ul>
                </div>
                <p class="text-sm text-gray-600">å‡¦ç†æ™‚é–“ã®ç›®å®‰ï¼š1-2åˆ†</p>
            </div>
        `,
        onConfirm: () => {
            showNotification('AIåˆ†æã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');
            // ã“ã“ã§å®Ÿéš›ã®åˆ†æå‡¦ç†ã‚’å®Ÿè¡Œ
            simulateAIAnalysis();
        }
    });
}

// ç›®æ¨™è©³ç´°è¡¨ç¤º
function showTargetDetail(targetId) {
    const allTargets = [...strategyData.midtermPlan.quantitativeTargets, ...strategyData.midtermPlan.keyStrategies];
    const target = allTargets.find(t => t.id === targetId);
    
    if (!target) return;
    
    showModal({
        title: target.name,
        content: `
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-2xl font-bold mb-2">${target.value}</p>
                    <p class="text-sm text-gray-600">${target.baseline}</p>
                </div>
                
                <div>
                    <h4 class="font-medium mb-2">é€²æ—çŠ¶æ³</h4>
                    <div class="progress-bar">
                        <div class="progress-bar-fill ${getProgressClass(target.progress)}" style="width: ${target.progress}%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">${target.progress}% é”æˆ</p>
                </div>
                
                ${target.details ? `
                    <div>
                        <h4 class="font-medium mb-2">è©³ç´°</h4>
                        <p class="text-sm text-gray-600">${target.details.description}</p>
                    </div>
                ` : ''}
                
                <div class="flex gap-2">
                    <button onclick="editTarget('${targetId}')" class="btn btn-primary btn-sm">ç·¨é›†</button>
                    <button onclick="showTargetQuestions('${targetId}')" class="btn btn-secondary btn-sm">é–¢é€£è³ªå•ã‚’è¦‹ã‚‹</button>
                </div>
            </div>
        `,
        showConfirm: false
    });
}

// è³ªå•ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
function switchQuestionTab(tab) {
    currentQuestionTab = tab;
    
    // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
    document.querySelectorAll('.question-tab').forEach(t => {
        t.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // è³ªå•ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    // ã“ã“ã§å®Ÿéš›ã®ã‚¿ãƒ–ã«å¿œã˜ãŸè³ªå•ã‚’è¡¨ç¤º
    loadQuestions();
}

// FAQä½œæˆ
function createFAQ(questionId) {
    const question = strategyData.questions.recentQuestions.find(q => q.id === questionId);
    if (!question) return;
    
    currentEditingQuestion = question;
    
    document.getElementById('original-question').textContent = question.question;
    document.getElementById('faq-question').value = '';
    document.getElementById('faq-answer').value = '';
    document.getElementById('faq-editor').style.display = 'block';
    document.getElementById('faq-editor').scrollIntoView({ behavior: 'smooth' });
}

// FAQã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‰ã˜ã‚‹
function closeFAQEditor() {
    document.getElementById('faq-editor').style.display = 'none';
    currentEditingQuestion = null;
}

// FAQä¿å­˜
function saveFAQ() {
    const faqData = {
        question: document.getElementById('faq-question').value,
        answer: document.getElementById('faq-answer').value,
        category: document.getElementById('faq-category').value,
        originalQuestionId: currentEditingQuestion?.id
    };
    
    // ã“ã“ã§å®Ÿéš›ã®ä¿å­˜å‡¦ç†
    showNotification('FAQã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
    closeFAQEditor();
}

// AIææ¡ˆã®é©ç”¨
function applyAISuggestion(type, index) {
    if (type === 'question') {
        document.getElementById('faq-question').value = "æµ·å¤–å±•é–‹ã«ãŠã‘ã‚‹åœ°åŸŸåˆ¥ã®å£²ä¸Šç›®æ¨™ã¨æŠ•è³‡è¨ˆç”»ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„";
    } else if (type === 'answer') {
        document.getElementById('faq-answer').value = "2026å¹´åº¦ã®æµ·å¤–å£²ä¸Šæ¯”ç‡35%é”æˆã«å‘ã‘ã¦ã€ã‚¢ã‚¸ã‚¢åœ°åŸŸã§200å„„å††ï¼ˆå…¨ä½“ã®60%ï¼‰ã€åŒ—ç±³ã§100å„„å††ï¼ˆ30%ï¼‰ã€æ¬§å·ã§30å„„å††ï¼ˆ10%ï¼‰ã®å£²ä¸Šã‚’è¨ˆç”»ã—ã¦ã„ã¾ã™ã€‚æŠ•è³‡é¡ã¯3å¹´é–“ã§ç·é¡150å„„å††ã‚’äºˆå®šã—ã€ç¾åœ°æ³•äººè¨­ç«‹ã€ç‰©æµæ‹ ç‚¹æ§‹ç¯‰ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å¼·åŒ–ã«å……å½“ã—ã¾ã™ã€‚";
    }
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showModal(options) {
    const backdrop = document.getElementById('modal-backdrop');
    const title = document.getElementById('modal-title');
    const body = document.getElementById('modal-body');
    const confirmBtn = document.getElementById('modal-confirm');
    
    title.textContent = options.title;
    body.innerHTML = options.content;
    
    if (options.showConfirm !== false) {
        confirmBtn.style.display = 'block';
        confirmBtn.onclick = () => {
            closeModal();
            if (options.onConfirm) options.onConfirm();
        };
    } else {
        confirmBtn.style.display = 'none';
    }
    
    backdrop.classList.add('active');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeModal() {
    document.getElementById('modal-backdrop').classList.remove('active');
}

// é€šçŸ¥è¡¨ç¤º
function showNotification(message, type = 'info') {
    // Tailwindã®toastã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 
        'bg-blue-600'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// AIåˆ†æã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
function simulateAIAnalysis() {
    setTimeout(() => {
        showNotification('AIåˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
        
        // åˆ†æçµæœã®è¡¨ç¤º
        showModal({
            title: 'AIåˆ†æçµæœ',
            content: `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">é‡è¦ãªç™ºè¦‹</h4>
                        <ul class="text-sm space-y-1">
                            <li>â€¢ æµ·å¤–å£²ä¸Šæ¯”ç‡ç›®æ¨™ã‚’35%â†’38%ã«ä¸Šæ–¹ä¿®æ­£ã‚’æ¨å¥¨</li>
                            <li>â€¢ DXæŠ•è³‡é¡ã‚’300å„„å††â†’320å„„å††ã«å¢—é¡ã®å¿…è¦æ€§</li>
                            <li>â€¢ æ–°è¦æ–½ç­–ï¼šAIéœ€è¦äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã®è¿½åŠ </li>
                        </ul>
                    </div>
                    <p class="text-sm text-gray-600">ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚’ä¸­æœŸçµŒå–¶è¨ˆç”»ã«åæ˜ ã—ã¾ã™ã‹ï¼Ÿ</p>
                </div>
            `,
            onConfirm: () => {
                showNotification('ä¸­æœŸçµŒå–¶è¨ˆç”»ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
                // ç”»é¢ã®æ›´æ–°
                updatePlanWithAIResults();
            }
        });
    }, 2000);
}

// AIåˆ†æçµæœã®åæ˜ 
function updatePlanWithAIResults() {
    // æµ·å¤–å£²ä¸Šæ¯”ç‡ã‚’æ›´æ–°
    const overseasTarget = strategyData.midtermPlan.quantitativeTargets.find(t => t.id === 'overseas-ratio');
    if (overseasTarget) {
        overseasTarget.value = '38%';
        overseasTarget.baseline = '2023å¹´åº¦å®Ÿç¸¾: 22%ï¼ˆ+16ptï¼‰';
    }
    
    // DXæŠ•è³‡ã‚’æ›´æ–°
    const dxStrategy = strategyData.midtermPlan.keyStrategies.find(s => s.id === 'dx-investment');
    if (dxStrategy) {
        dxStrategy.value = '3å¹´é–“ã§320å„„å††';
    }
    
    // ç”»é¢ã‚’å†æç”»
    initializePlan();
}

// ãã®ä»–ã®æ©Ÿèƒ½
function toggleAIAssist() {
    showNotification('AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒèµ·å‹•ã—ã¾ã—ãŸ', 'info');
}

function answerQuestion(questionId) {
    showNotification(`è³ªå• ${questionId} ã®å›ç­”ä½œæˆç”»é¢ã‚’é–‹ãã¾ã™`, 'info');
}

function assignQuestion(questionId) {
    showNotification(`è³ªå• ${questionId} ã®æ‹…å½“è€…å‰²å½“ç”»é¢ã‚’é–‹ãã¾ã™`, 'info');
}

function relateQuestion(questionId) {
    showNotification(`è³ªå• ${questionId} ã®é¡ä¼¼è³ªå•ã‚’æ¤œç´¢ã—ã¾ã™`, 'info');
}

function showTargetQuestions(targetId) {
    showNotification(`${targetId} ã«é–¢é€£ã™ã‚‹è³ªå•ã‚’è¡¨ç¤ºã—ã¾ã™`, 'info');
}

function showAllQuestions(type) {
    showNotification(`${type} ã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®è³ªå•ã‚’è¡¨ç¤ºã—ã¾ã™`, 'info');
}

function editTargets(type) {
    showNotification(`${type} ã®ç·¨é›†ç”»é¢ã‚’é–‹ãã¾ã™`, 'info');
}

function importQuestions() {
    showNotification('è³ªå•ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆç”»é¢ã‚’é–‹ãã¾ã™', 'info');
}

function showAIAssistant() {
    showNotification('AIå›ç­”æ”¯æ´ã‚’èµ·å‹•ã—ã¾ã™', 'info');
}

function applyInsight(type) {
    showNotification(`ã‚¤ãƒ³ã‚µã‚¤ãƒˆ ${type} ã‚’é©ç”¨ã—ã¾ã™`, 'info');
}

function openQuestionDetail(questionId) {
    showNotification(`è³ªå• ${questionId} ã®è©³ç´°ã‚’è¡¨ç¤ºã—ã¾ã™`, 'info');
}

function editTarget(targetId) {
    showNotification(`ç›®æ¨™ ${targetId} ã®ç·¨é›†ç”»é¢ã‚’é–‹ãã¾ã™`, 'info');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã®ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.getElementById('modal-backdrop').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>
{% endblock %}